<!-- WALLET WEB3 PREMIUM - COM IA SOUND EXCLUSIVE FUNCIONAL -->
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Exclusive Wallet Premium — Sistema Blockchain Isolado</title>
  
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.13.4/dist/ethers.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Cinzel:wght@600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  
  <style>
   /* CSS EXISTENTE PERMANECE INALTERADO */
   :root{--gold-primary:#D4AF37;--gold-secondary:#F4E4B8;--gold-accent:#B8860B;--gold-dark:#8B6914;--platinum:#E5E4E2;--carbon:#1A1A1A;--obsidian:#0A0A0A;--emerald:#046307;--sapphire:#0F52BA;--ruby:#E0115F;--diamond:#B9F2FF;--transition:all 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);--shadow-luxury:0 25px 50px rgba(0, 0, 0, 0.1),0 15px 30px rgba(0, 0, 0, 0.08);--shadow-gold:0 8px 32px rgba(212,175,55,0.25);--gradient-gold:linear-gradient(135deg,#D4AF37 0%,#F4E4B8 50%,#B8860B 100%);--gradient-dark:linear-gradient(135deg,#1A1A1A 0%,#0A0A0A 100%);--gradient-card:linear-gradient(135deg,rgba(212,175,55,0.1) 0%,rgba(244,228,184,0.05) 100%);--wet-mirror:linear-gradient(135deg,rgba(255,255,255,0.1) 0%,rgba(255,255,255,0.05) 25%,rgba(255,255,255,0.15) 50%,rgba(255,255,255,0.05) 75%,rgba(255,255,255,0.1) 100%)}.theme-luxury{--primary-color:#D4AF37;--secondary-color:#F4E4B8;--accent-color:#B8860B;--background-primary:#0A0A0A;--background-secondary:#1A1A1A;--text-primary:#F0F0F0;--text-secondary:#B0B0B0;--container-bg:rgba(26,26,26,0.95);--container-border:rgba(212,175,55,0.3);--card-bg:rgba(30,30,30,0.8);--card-border:rgba(212,175,55,0.2);--success-color:#00C853;--warning-color:#FFD700;--error-color:#FF5252}.theme-light{--primary-color:#D4AF37;--secondary-color:#F4E4B8;--accent-color:#B8860B;--background-primary:#FFFFFF;--background-secondary:#F8F8F8;--text-primary:#1A1A1A;--text-secondary:#555555;--container-bg:rgba(255,255,255,0.95);--container-border:rgba(212,175,55,0.3);--card-bg:rgba(255,255,255,0.9);--card-border:rgba(212,175,55,0.2);--success-color:#00A859;--warning-color:#E6B400;--error-color:#E53935}*{margin:0;padding:0;box-sizing:border-box;font-family:'Inter','Helvetica Neue',Arial,sans-serif}body{background:var(--background-primary);min-height:100vh;display:flex;justify-content:center;align-items:center;padding:20px;color:var(--text-primary);transition:var(--transition);font-weight:300;position:relative;overflow-x:hidden}body::before{content:'';position:absolute;top:0;left:0;width:100%;height:100%;background:radial-gradient(circle at 20% 80%,rgb(212 175 55/.1) 0%,transparent 50%),radial-gradient(circle at 80% 20%,rgb(244 228 184/.1) 0%,transparent 50%),radial-gradient(circle at 40% 40%,rgb(184 134 11/.05) 0%,transparent 50%);z-index:-1;animation:backgroundShift 20s ease-in-out infinite alternate}@keyframes backgroundShift{0%{transform:scale(1) rotate(0deg)}100%{transform:scale(1.1) rotate(3deg)}}.wallet-container{width:100%;max-width:1400px;background:var(--container-bg);backdrop-filter:blur(40px);padding:60px 50px;box-shadow:var(--shadow-luxury);border:1px solid var(--container-border);position:relative;transition:var(--transition);border-radius:24px;overflow:hidden;animation:containerEntrance 1.2s cubic-bezier(.25,.46,.45,.94)}.wallet-container::before{content:'';position:absolute;top:0;left:0;right:0;height:6px;background:var(--gradient-gold);z-index:2}.wallet-container::after{content:'';position:absolute;top:0;left:0;right:0;bottom:0;background:linear-gradient(45deg,transparent 65%,rgb(212 175 55/.03) 65%),linear-gradient(-45deg,transparent 65%,rgb(244 228 184/.03) 65%);pointer-events:none;z-index:1}@keyframes containerEntrance{0%{opacity:0;transform:translateY(60px) scale(.95)}100%{opacity:1;transform:translateY(0) scale(1)}}header{display:flex;justify-content:space-between;align-items:center;margin-bottom:60px;padding-bottom:30px;border-bottom:1px solid rgb(212 175 55/.3);animation:fadeInDown 1s 0.3s both;position:relative}header::after{content:'';position:absolute;bottom:-1px;left:0;width:100px;height:2px;background:var(--gradient-gold)}.logo{text-align:center}.logo h1{font-family:'Cinzel',serif;font-size:42px;font-weight:600;letter-spacing:4px;color:var(--text-primary);text-transform:uppercase;position:relative;display:inline-block;text-shadow:0 2px 10px rgb(212 175 55/.3)}.logo h1::after{content:'';position:absolute;bottom:-12px;left:50%;transform:translateX(-50%);width:80px;height:3px;background:var(--gradient-gold);border-radius:2px}.logo span{display:block;font-size:12px;letter-spacing:10px;margin-top:15px;color:var(--text-secondary);font-weight:300}.theme-controls{display:flex;gap:20px}.theme-toggle-btn{background:#fff0;border:1px solid var(--container-border);color:var(--primary-color);padding:12px 20px;cursor:pointer;font-size:13px;display:flex;align-items:center;gap:8px;transition:var(--transition);font-weight:400;letter-spacing:1px;border-radius:10px;min-width:140px;justify-content:center;position:relative;overflow:hidden}.theme-toggle-btn::before{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgb(212 175 55/.2),transparent);transition:all 0.8s ease}.theme-toggle-btn:hover::before{left:100%}.theme-toggle-btn:hover{border-color:var(--primary-color);background:rgb(212 175 55/.05);transform:translateY(-3px);box-shadow:var(--shadow-gold)}.btn{width:100%;padding:20px;border:none;cursor:pointer;font-size:15px;font-weight:500;letter-spacing:1.5px;text-transform:uppercase;transition:var(--transition);margin-bottom:15px;border-radius:12px;position:relative;overflow:hidden}.btn::before{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgb(255 255 255/.4),transparent);transition:all 0.8s ease}.btn:hover::before{left:100%}.btn::after{content:'';position:absolute;top:0;left:0;right:0;bottom:0;background:var(--wet-mirror);opacity:0;transition:opacity 0.5s ease;border-radius:12px;z-index:0}.btn:hover::after{opacity:1}.btn-primary{background:var(--gradient-gold);color:#1A1A1A;box-shadow:var(--shadow-gold);font-weight:600;position:relative;z-index:1}.btn-primary:hover{box-shadow:0 15px 40px rgb(212 175 55/.5);transform:translateY(-5px)}.btn-secondary{background:#fff0;color:var(--text-secondary);border:1px solid var(--container-border);box-shadow:0 4px 15px rgb(0 0 0/.1);position:relative;z-index:1}.btn-secondary:hover{border-color:var(--primary-color);color:var(--primary-color);transform:translateY(-3px);box-shadow:var(--shadow-gold)}.btn-small{width:auto;padding:14px 24px;font-size:13px}.btn-success{background:linear-gradient(135deg,var(--success-color),#00E676);color:#fff;box-shadow:0 8px 25px rgb(0 200 83/.4)}.btn-success:hover{box-shadow:0 12px 30px rgb(0 200 83/.6)}.restore-mnemonic-btn{background:#fff0;border:1px solid var(--container-border);color:var(--text-secondary);padding:8px 12px;cursor:pointer;font-size:11px;transition:var(--transition);border-radius:6px;display:flex;align-items:center;gap:5px;margin-top:10px;position:relative;overflow:hidden}.restore-mnemonic-btn::after{content:'';position:absolute;top:0;left:0;right:0;bottom:0;background:var(--wet-mirror);opacity:0;transition:opacity 0.5s ease;border-radius:6px;z-index:0}.restore-mnemonic-btn:hover::after{opacity:1}.restore-mnemonic-btn:hover{border-color:var(--primary-color);color:var(--primary-color);background:rgb(212 175 55/.05)}@keyframes fadeInUp{from{opacity:0;transform:translateY(40px)}to{opacity:1;transform:translateY(0)}}@keyframes fadeInDown{from{opacity:0;transform:translateY(-40px)}to{opacity:1;transform:translateY(0)}}.animate-element{animation:fadeInUp 0.8s cubic-bezier(.25,.46,.45,.94) both}.delay-1{animation-delay:0.1s}.delay-2{animation-delay:0.2s}.delay-3{animation-delay:0.3s}.delay-4{animation-delay:0.4s}.delay-5{animation-delay:0.5s}.wallet-header{text-align:center;margin-bottom:60px}.wallet-header h2{font-family:'Cinzel',serif;font-size:36px;font-weight:600;letter-spacing:3px;color:var(--text-primary);margin-bottom:20px;position:relative;display:inline-block;text-shadow:0 2px 10px rgb(212 175 55/.3)}.wallet-header h2::after{content:'';position:absolute;bottom:-12px;left:50%;transform:translateX(-50%);width:60px;height:3px;background:var(--gradient-gold);border-radius:2px}.wallet-header p{color:var(--text-secondary);font-size:16px;max-width:600px;margin:0 auto;line-height:1.8;font-weight:300;letter-spacing:.5px}.balance-container{position:relative;display:flex;flex-direction:column;align-items:center;justify-content:center;margin:50px 0;padding:60px 40px;border-radius:24px;background:var(--gradient-card);border:1px solid rgb(212 175 55/.2);overflow:hidden;backdrop-filter:blur(20px)}.balance-container::before{content:'';position:absolute;top:0;left:0;right:0;bottom:0;background:radial-gradient(circle at 30% 30%,rgb(212 175 55/.1) 0%,transparent 50%),radial-gradient(circle at 70% 70%,rgb(244 228 184/.1) 0%,transparent 50%);z-index:-1}.balance-display{position:relative;z-index:1;font-size:48px;font-weight:600;color:var(--primary-color);margin:15px 0;font-family:'Cinzel',serif;text-align:center;text-shadow:0 2px 10px rgb(212 175 55/.3)}.balance-label{position:relative;z-index:1;font-size:16px;color:var(--text-secondary);text-transform:uppercase;letter-spacing:3px;margin-top:15px}.balance-brl{font-size:28px;color:var(--success-color);font-weight:500;margin-top:10px;font-family:'Cinzel',serif}.dashboard-grid{display:grid;grid-template-columns:1fr 1fr;gap:40px;margin-bottom:50px}.info-card{background:var(--card-bg);padding:40px;border-radius:20px;border:1px solid var(--card-border);transition:var(--transition);animation:slideInUp 1s 0.5s both;position:relative;overflow:hidden;backdrop-filter:blur(20px)}.info-card::before{content:'';position:absolute;top:0;left:0;width:6px;height:100%;background:var(--gradient-gold)}.info-card::after{content:'';position:absolute;top:0;right:0;width:100px;height:100px;background:radial-gradient(circle,rgb(212 175 55/.1) 0%,transparent 70%);z-index:0}.info-card:hover{transform:translateY(-10px);box-shadow:var(--shadow-luxury);border-color:var(--primary-color)}.info-card h3{font-family:'Cinzel',serif;color:var(--primary-color);margin-bottom:25px;font-size:24px;display:flex;align-items:center;gap:12px;font-weight:500;position:relative;z-index:1}.form-row{display:flex;gap:10px;margin-top:15px;flex-wrap:wrap}.address-display{background:rgb(212 175 55/.08);border:1px solid rgb(212 175 55/.2);padding:15px;border-radius:8px;font-family:'Courier New',monospace;font-size:14px;word-break:break-all;margin-bottom:10px}.tab-navigation{display:flex;justify-content:center;gap:4px;margin:40px 0 30px 0;background:rgb(212 175 55/.05);padding:8px 12px;border-radius:16px;border:1px solid var(--container-border);backdrop-filter:blur(10px)}.tab-button{background:#fff0;border:1px solid var(--container-border);color:var(--text-secondary);padding:12px 18px;cursor:pointer;font-size:13px;transition:var(--transition);font-weight:500;letter-spacing:1px;border-radius:10px;display:flex;align-items:center;gap:8px;position:relative;overflow:hidden}.tab-button::before{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgb(212 175 55/.2),transparent);transition:all 0.6s ease}.tab-button:hover::before{left:100%}.tab-button:hover{border-color:var(--primary-color);color:var(--primary-color);transform:translateY(-2px);box-shadow:var(--shadow-gold)}.tab-button.active{background:rgb(212 175 55/.1);border-color:var(--primary-color);color:var(--primary-color);box-shadow:var(--shadow-gold)}.tab-content{display:none;opacity:0;transition:opacity 0.5s ease}.tab-content.active{display:block;opacity:1}.hidden{display:none!important}.fade-out{animation:fadeOut 0.8s cubic-bezier(.25,.46,.45,.94) both}@keyframes fadeOut{from{opacity:1;transform:translateY(0)}to{opacity:0;transform:translateY(-30px)}}.fade-in{animation:fadeIn 0.8s 0.3s cubic-bezier(.25,.46,.45,.94) both}@keyframes fadeIn{from{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}.agenda-container{margin-top:30px}.agenda-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.agenda-month-nav{display:flex;align-items:center;gap:15px}.agenda-month-title{font-family:'Cinzel',serif;font-size:18px;color:var(--primary-color);font-weight:600;min-width:180px;text-align:center}.agenda-calendar{display:grid;grid-template-columns:repeat(7,1fr);gap:4px;margin-bottom:30px;background:rgb(212 175 55/.05);padding:15px;border-radius:12px;border:1px solid var(--container-border)}.agenda-day{background:var(--card-bg);border:1px solid var(--card-border);border-radius:8px;padding:8px;min-height:80px;transition:var(--transition)}.agenda-day:hover{border-color:var(--primary-color);background:rgb(212 175 55/.05);transform:translateY(-3px)}.agenda-day.selected{border:2px solid var(--primary-color);background:var(--wet-mirror);box-shadow:0 0 20px rgb(212 175 55/.3)}.agenda-day-number{font-size:14px;font-weight:600;color:var(--text-primary);margin-bottom:5px}.agenda-day-event{background:var(--gradient-gold);color:var(--carbon);font-size:11px;padding:3px 6px;border-radius:4px;margin-top:3px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-weight:500}.agenda-event-form{background:var(--card-bg);border:1px solid var(--card-border);border-radius:12px;padding:25px;margin-top:20px}.token-item{display:flex;align-items:center;justify-content:space-between;padding:15px;background:var(--card-bg);border:1px solid var(--card-border);border-radius:12px;margin-bottom:10px;transition:var(--transition)}.token-item:hover{border-color:var(--primary-color);transform:translateY(-3px);box-shadow:var(--shadow-gold)}.token-info{display:flex;align-items:center;gap:15px}.token-symbol{font-weight:600;color:var(--text-primary)}.token-balance{font-weight:600;color:var(--primary-color)}.address-registration-box{background:var(--card-bg);border:1px solid var(--card-border);border-radius:20px;padding:35px;margin-top:30px;position:relative;overflow:hidden}.address-registration-box::before{content:'';position:absolute;top:0;left:0;width:6px;height:100%;background:var(--gradient-gold)}.address-registration-title{font-family:'Cinzel',serif;color:var(--primary-color);margin-bottom:20px;font-size:22px;display:flex;align-items:center;gap:12px;font-weight:500}.address-instruction{color:var(--text-secondary);font-size:14px;line-height:1.6;margin-bottom:25px}.wallet-address-display{display:flex;align-items:center;justify-content:space-between;background:rgb(212 175 55/.08);border:1px solid rgb(212 175 55/.2);border-radius:8px;padding:15px;margin-bottom:25px;font-family:'Courier New',monospace}.address-text{color:var(--text-primary);font-size:14px;word-break:break-all}.copy-btn{background:rgb(212 175 55/.1);border:1px solid var(--primary-color);color:var(--primary-color);padding:8px 15px;border-radius:6px;cursor:pointer;font-size:13px;display:flex;align-items:center;gap:8px;transition:var(--transition)}.copy-btn:hover{background:rgb(212 175 55/.2);transform:translateY(-2px)}.verification-status{display:flex;align-items:center;gap:12px;margin:20px 0 25px 0}.status-indicator{width:12px;height:12px;border-radius:50%}.status-indicator.verified{background:var(--success-color);box-shadow:0 0 10px var(--success-color)}.communication-badges{display:flex;flex-wrap:wrap;gap:10px;margin:25px 0}.communication-badge{background:var(--gradient-card);border:1px solid rgb(212 175 55/.2);border-radius:8px;padding:10px 15px;font-size:13px;display:flex;align-items:center;gap:8px;color:var(--text-primary);transition:var(--transition)}.communication-badge.unlocked{border-color:var(--success-color);background:rgb(0 200 83/.1)}.communication-badge i{color:var(--primary-color)}.communication-badge.unlocked i{color:var(--success-color)}.input-group{margin-bottom:30px}.input-group label{display:block;font-size:14px;margin-bottom:12px;color:var(--text-secondary);letter-spacing:1px;font-weight:400}.input-group input,.input-group textarea,.input-group select{width:100%;padding:18px 20px;border:1px solid var(--container-border);background:var(--card-bg);font-size:16px;color:var(--text-primary);transition:var(--transition);border-radius:12px;font-weight:300;backdrop-filter:blur(10px);resize:vertical;font-family:'Inter',sans-serif}.input-group input:focus,.input-group textarea:focus,.input-group select:focus{outline:none;border-color:var(--primary-color);background:var(--background-secondary);box-shadow:0 0 0 3px rgb(212 175 55/.2)}.notification{position:fixed;top:40px;right:40px;padding:24px 30px;background:var(--container-bg);border:1px solid var(--primary-color);border-radius:16px;color:var(--text-primary);z-index:10000;transform:translateX(500px);transition:transform 0.6s cubic-bezier(.25,.46,.45,.94);box-shadow:var(--shadow-luxury);backdrop-filter:blur(20px);max-width:400px}.notification.show{transform:translateX(0)}.notification::before{content:'';position:absolute;top:0;left:0;width:6px;height:100%;background:var(--gradient-gold)}.modal-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgb(10 10 10/.8);backdrop-filter:blur(10px);display:flex;justify-content:center;align-items:center;z-index:10000;opacity:0;visibility:hidden;transition:var(--transition)}.modal-overlay.active{opacity:1;visibility:visible}.modal-content{background:var(--container-bg);border:1px solid var(--container-border);border-radius:24px;padding:40px;max-width:600px;width:90%;max-height:90vh;overflow-y:auto;position:relative;transform:translateY(50px) scale(.9);opacity:0;transition:var(--transition);box-shadow:var(--shadow-luxury)}.modal-overlay.active .modal-content{transform:translateY(0) scale(1);opacity:1}.modal-content::before{content:'';position:absolute;top:0;left:0;right:0;height:6px;background:var(--gradient-gold);border-radius:24px 24px 0 0}.modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:30px;padding-bottom:20px;border-bottom:1px solid var(--container-border)}.modal-title{font-family:'Cinzel',serif;color:var(--primary-color);font-size:24px;font-weight:600}.modal-close{background:#fff0;border:none;color:var(--text-secondary);font-size:20px;cursor:pointer;transition:var(--transition);width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center}.modal-close:hover{color:var(--primary-color);background:rgb(212 175 55/.1)}.modal-body{margin-bottom:30px}.modal-footer{display:flex;justify-content:flex-end;gap:15px;padding-top:20px;border-top:1px solid var(--container-border)}.dev-agenda-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:20px;margin-top:25px}.agenda-entry{background:var(--card-bg);border:1px solid var(--card-border);border-radius:12px;padding:20px;transition:var(--transition)}.agenda-entry:hover{border-color:var(--primary-color);transform:translateY(-3px);box-shadow:var(--shadow-gold)}.agenda-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}.agenda-title{font-weight:600;color:var(--text-primary);font-size:15px}.agenda-status{font-size:11px;padding:4px 8px;border-radius:12px;font-weight:500;letter-spacing:.5px}.status-completed{background:rgb(0 200 83/.15);color:var(--success-color);border:1px solid var(--success-color)}.status-in-progress{background:rgb(255 215 0/.15);color:var(--warning-color);border:1px solid var(--warning-color)}.status-planning{background:rgb(212 175 55/.15);color:var(--primary-color);border:1px solid var(--primary-color)}.agenda-description{color:var(--text-secondary);font-size:13px;line-height:1.5;margin-bottom:15px}.agenda-footer{display:flex;justify-content:space-between;font-size:11px;color:var(--text-secondary)}.agenda-wallet{font-family:'Courier New',monospace;color:var(--primary-color)}.sub-tab-navigation{display:flex;gap:4px;margin:25px 0 30px 0;background:rgb(212 175 55/.05);padding:8px 12px;border-radius:16px;border:1px solid var(--container-border);backdrop-filter:blur(10px);flex-wrap:wrap}.sub-tab-btn{background:#fff0;border:1px solid var(--container-border);color:var(--text-secondary);padding:10px 15px;cursor:pointer;font-size:12px;transition:var(--transition);font-weight:500;letter-spacing:.5px;border-radius:8px;display:flex;align-items:center;gap:8px;position:relative;overflow:hidden}.sub-tab-btn::before{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgb(212 175 55/.2),transparent);transition:all 0.6s ease}.sub-tab-btn:hover::before{left:100%}.sub-tab-btn:hover{border-color:var(--primary-color);color:var(--primary-color);transform:translateY(-2px);box-shadow:var(--shadow-gold)}.sub-tab-btn.active{background:rgb(212 175 55/.1);border-color:var(--primary-color);color:var(--primary-color);box-shadow:var(--shadow-gold)}.sub-tab-content{display:block;opacity:1;transition:opacity 0.5s ease}.sub-tab-content.hidden{display:none;opacity:0}.contacts-list-container{max-height:300px;overflow-y:auto;margin:20px 0;border:1px solid var(--card-border);border-radius:12px;padding:15px}.contact-item{display:flex;justify-content:space-between;align-items:center;padding:12px 15px;border-bottom:1px solid var(--card-border);transition:var(--transition)}.contact-item:hover{background:var(--gradient-card)}.contact-item:last-child{border-bottom:none}.contact-info{display:flex;align-items:center;gap:15px;flex:1}.contact-actions{display:flex;gap:8px}.add-contact-form{margin-top:30px;padding:20px;border:1px solid var(--card-border);border-radius:12px;background:var(--card-bg)}.chat-container{display:flex;flex-direction:column;height:400px;border:1px solid var(--card-border);border-radius:12px;overflow:hidden}.chat-messages{flex:1;overflow-y:auto;padding:20px;background:var(--card-bg)}.chat-input-area{display:flex;gap:10px;padding:15px;border-top:1px solid var(--card-border);background:var(--background-secondary)}.chat-input{flex:1;padding:12px 15px;border:1px solid var(--card-border);border-radius:8px;background:var(--card-bg);color:var(--text-primary);font-size:14px}.message{margin-bottom:15px;padding:10px 15px;border-radius:12px;max-width:80%;word-wrap:break-word}.message-received{background:var(--card-bg);border:1px solid var(--card-border);align-self:flex-start}.message-sent{background:var(--gradient-gold);color:#1A1A1A;align-self:flex-end;margin-left:auto}.message-sender{font-weight:600;font-size:12px;margin-bottom:5px;color:var(--primary-color)}.message-time{font-size:10px;color:var(--text-secondary);margin-top:5px;text-align:right}.video-container{width:100%;height:300px;background:#000;border-radius:12px;overflow:hidden;position:relative;display:flex;align-items:center;justify-content:center;margin-bottom:20px}.video-placeholder{text-align:center;color:#fff}.video-placeholder i{font-size:48px;margin-bottom:15px;color:var(--primary-color)}.video-controls{display:flex;gap:10px;flex-wrap:wrap}.video-call-container{position:relative}.video-call-container video{width:100%;height:100%;object-fit:cover;border-radius:12px}.local-video{position:absolute;bottom:20px;right:20px;width:120px;height:90px;border:2px solid var(--primary-color);border-radius:8px;overflow:hidden;background:#000}.local-video video{width:100%;height:100%;object-fit:cover}.group-video-container{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:10px;margin-top:20px}.group-video-item{background:#000;border-radius:8px;overflow:hidden;position:relative;aspect-ratio:16/9}.group-video-item video{width:100%;height:100%;object-fit:cover}.group-video-overlay{position:absolute;bottom:5px;left:5px;background:rgb(0 0 0/.7);color:#fff;padding:3px 8px;border-radius:4px;font-size:11px}.info-card:hover::after,.btn:hover::after,.tab-button:hover::after,.sub-tab-btn:hover::after,.theme-toggle-btn:hover::after,.contact-item:hover::after{content:'';position:absolute;top:0;left:0;width:100%;height:100%;background:var(--wet-mirror);opacity:.6;pointer-events:none;border-radius:inherit;z-index:1}.communication-main-container{background:var(--card-bg);border:1px solid var(--card-border);border-radius:24px;padding:30px;margin-top:20px;min-height:600px;position:relative;overflow:hidden}.communication-main-container::before{content:'';position:absolute;top:0;left:0;width:6px;height:100%;background:var(--gradient-gold)}.authorization-box{background:var(--gradient-card);border:1px solid var(--card-border);border-radius:20px;padding:25px;margin-top:30px;position:relative;overflow:hidden}.authorization-box::before{content:'';position:absolute;top:0;left:0;width:6px;height:100%;background:var(--gradient-gold)}.language-selector-container{position:fixed;bottom:30px;right:30px;z-index:1000}.language-toggle-btn{background:var(--card-bg);border:1px solid var(--primary-color);color:var(--primary-color);width:60px;height:60px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:24px;cursor:pointer;transition:var(--transition);box-shadow:var(--shadow-luxury)}.language-toggle-btn:hover{transform:scale(1.1) rotate(15deg);background:rgb(212 175 55/.1)}.language-panel{position:absolute;bottom:70px;right:0;background:var(--container-bg);border:1px solid var(--container-border);border-radius:16px;padding:20px;width:200px;backdrop-filter:blur(20px);box-shadow:var(--shadow-luxury);display:none}.language-panel.active{display:block}.language-panel::before{content:'';position:absolute;top:0;left:0;right:0;height:6px;background:var(--gradient-gold);border-radius:16px 16px 0 0}.language-item{padding:10px;border-bottom:1px solid var(--card-border);cursor:pointer;transition:var(--transition);font-size:14px;display:flex;align-items:center;gap:10px}.language-item:hover{background:var(--gradient-card);color:var(--primary-color)}.language-item:last-child{border-bottom:none}.global-value-display{text-align:center;padding:30px;background:var(--gradient-card);border-radius:24px;border:1px solid rgb(212 175 55/.2);margin-bottom:40px;position:relative;overflow:hidden;backdrop-filter:blur(20px)}.global-value-display::before{content:'';position:absolute;top:0;left:0;right:0;bottom:0;background:radial-gradient(circle at 30% 30%,rgb(212 175 55/.1) 0%,transparent 50%),radial-gradient(circle at 70% 70%,rgb(244 228 184/.1) 0%,transparent 50%);z-index:-1}.global-value-label{font-size:14px;color:var(--text-secondary);text-transform:uppercase;letter-spacing:3px;margin-bottom:10px;font-weight:400}.global-value-amount{font-size:42px;font-weight:600;color:var(--success-color);font-family:'Cinzel',serif;text-shadow:0 2px 10px rgb(0 200 83/.3);margin:15px 0}.token-price-info{font-size:11px;color:var(--text-secondary);display:flex;align-items:center;gap:5px;margin-top:3px;font-weight:300}.token-price-info i{font-size:10px;color:var(--primary-color)}.token-price-source{font-size:9px;color:var(--gold-accent);font-style:italic}.nft-item{display:flex;align-items:center;gap:15px;padding:12px;background:var(--card-bg);border:1px solid var(--card-border);border-radius:10px;margin-bottom:10px;transition:var(--transition)}.nft-item:hover{border-color:var(--primary-color);transform:translateY(-2px);box-shadow:var(--shadow-gold)}.nft-image{width:60px;height:60px;border-radius:8px;object-fit:cover;border:1px solid var(--container-border)}.nft-info{flex:1}.nft-name{font-weight:600;font-size:13px;color:var(--text-primary)}.nft-collection{font-size:11px;color:var(--text-secondary);margin-top:2px}.nft-id{font-size:10px;color:var(--primary-color);font-family:'Courier New',monospace}.action-btn-minimal{background:var(--card-bg);border:1px solid var(--card-border);border-radius:10px;padding:15px 10px;cursor:pointer;transition:var(--transition);display:flex;flex-direction:column;align-items:center;justify-content:center;color:var(--text-primary);font-size:13px;min-height:80px}.action-btn-minimal:hover{border-color:var(--primary-color);transform:translateY(-2px);box-shadow:var(--shadow-gold)}.action-btn-minimal i{font-size:24px;color:var(--primary-color);margin-bottom:8px}.action-btn-minimal span{font-size:11px;font-weight:500;letter-spacing:.5px;text-align:center}.export-counter-warning{background:rgb(224 17 95 / .1);border:1px solid var(--error-color);border-radius:8px;padding:12px;margin:15px 0;font-size:12px;color:var(--error-color);text-align:center;display:flex;align-items:center;justify-content:center;gap:8px}.export-counter-warning i{font-size:14px}.legal-text-container{max-height:300px;overflow-y:auto;padding:15px;background:var(--card-bg);border:1px solid var(--card-border);border-radius:8px;margin-bottom:20px;font-size:11px;line-height:1.5;color:var(--text-secondary)}.legal-section-title{font-weight:600;color:var(--primary-color);margin-top:15px;margin-bottom:8px;font-size:12px;font-family:'Cinzel',serif}.wallet-main-container{background:var(--card-bg);border:1px solid var(--card-border);border-radius:24px;padding:30px;margin-top:20px;position:relative;overflow:hidden;backdrop-filter:blur(20px)}.wallet-main-container::before{content:'';position:absolute;top:0;left:0;width:6px;height:100%;background:var(--gradient-gold)}.balance-main-container{position:relative;display:flex;flex-direction:column;align-items:center;justify-content:center;margin:30px 0;padding:40px;border-radius:24px;background:var(--gradient-card);border:1px solid rgb(212 175 55/.2);overflow:hidden;backdrop-filter:blur(20px)}.balance-main-container::before{content:'';position:absolute;top:0;left:0;right:0;bottom:0;background:radial-gradient(circle at 30% 30%,rgb(212 175 55/.1) 0%,transparent 50%),radial-gradient(circle at 70% 70%,rgb(244 228 184/.1) 0%,transparent 50%);z-index:-1}.wallet-operations-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:20px;margin-bottom:30px}.blockchain-buttons-container{display:flex;flex-wrap:wrap;gap:12px;justify-content:center;margin-bottom:30px;padding:20px;background:var(--gradient-card);border-radius:20px;border:1px solid rgb(212 175 55/.2);backdrop-filter:blur(20px)}.blockchain-button{background:var(--card-bg);border:1px solid var(--card-border);color:var(--text-primary);padding:14px 22px;cursor:pointer;font-size:12px;transition:var(--transition);font-weight:500;letter-spacing:.8px;border-radius:10px;text-transform:uppercase;min-width:100px;text-align:center;position:relative;overflow:hidden;height:48px;display:flex;align-items:center;justify-content:center}.blockchain-button::before{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgb(212 175 55/.2),transparent);transition:all 0.6s ease}.blockchain-button:hover::before{left:100%}.blockchain-button:hover{border-color:var(--primary-color);color:var(--primary-color);transform:translateY(-3px);box-shadow:var(--shadow-gold);background:rgb(212 175 55/.05)}.blockchain-button.active{background:rgb(212 175 55/.1);border-color:var(--primary-color);color:var(--primary-color);box-shadow:var(--shadow-gold)}.blockchain-divider{height:1px;background:var(--gradient-gold);margin:30px 0;width:100%}.blockchain-empty-area{min-height:300px;display:flex;align-items:center;justify-content:center;color:var(--text-secondary);font-size:14px;font-style:italic;padding:40px;background:var(--gradient-card);border-radius:20px;border:1px solid var(--card-border)}.sound-exclusive-container{background:var(--card-bg);border:1px solid var(--card-border);border-radius:24px;padding:30px;margin-top:20px;min-height:600px;position:relative;overflow:hidden;backdrop-filter:blur(20px)}.sound-exclusive-container::before{content:'';position:absolute;top:0;left:0;width:6px;height:100%;background:var(--gradient-gold)}.sound-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:30px;padding-bottom:20px;border-bottom:1px solid rgb(212 175 55/.2)}.sound-usage-counter{display:flex;align-items:center;gap:10px;background:rgb(212 175 55/.1);padding:8px 15px;border-radius:12px;border:1px solid rgb(212 175 55/.2)}.usage-count{font-weight:600;color:var(--primary-color);font-size:18px}.usage-warning{color:var(--warning-color);font-size:12px;display:flex;align-items:center;gap:5px}.sound-chat-container{display:flex;flex-direction:column;height:500px;border-radius:16px;overflow:hidden;background:var(--background-secondary);border:1px solid var(--card-border)}.sound-chat-messages{flex:1;overflow-y:auto;padding:20px;display:flex;flex-direction:column;gap:15px}.sound-chat-input-area{display:flex;gap:10px;padding:20px;border-top:1px solid var(--card-border);background:var(--container-bg)}.sound-chat-input{flex:1;padding:15px 20px;border:1px solid var(--card-border);border-radius:12px;background:var(--card-bg);color:var(--text-primary);font-size:15px;font-family:'Inter',sans-serif}.sound-message{padding:15px 20px;border-radius:16px;max-width:85%;word-wrap:break-word;position:relative}.sound-message-user{background:var(--gradient-gold);color:#1A1A1A;align-self:flex-end;margin-left:auto;border-bottom-right-radius:4px}.sound-message-ai{background:var(--card-bg);border:1px solid var(--card-border);align-self:flex-start;border-bottom-left-radius:4px}.sound-message-sender{font-weight:600;font-size:12px;margin-bottom:8px;color:var(--primary-color)}.sound-message-time{font-size:11px;color:var(--text-secondary);margin-top:8px;text-align:right}.sound-voice-controls{display:flex;justify-content:center;gap:20px;margin-top:30px;padding:25px;background:var(--gradient-card);border-radius:20px;border:1px solid rgb(212 175 55/.2)}.sound-voice-btn{display:flex;flex-direction:column;align-items:center;gap:10px;padding:25px;background:var(--card-bg);border:1px solid var(--card-border);border-radius:16px;cursor:pointer;transition:var(--transition);min-width:140px;text-align:center}.sound-voice-btn:hover{transform:translateY(-5px);border-color:var(--primary-color);box-shadow:var(--shadow-gold)}.sound-voice-btn i{font-size:32px;color:var(--primary-color)}.sound-voice-btn span{font-size:13px;font-weight:500;letter-spacing:.5px}.sound-status-indicator{display:flex;align-items:center;gap:8px;margin-top:20px;padding:12px 20px;background:rgb(212 175 55/.05);border-radius:12px;border:1px solid rgb(212 175 55/.1)}.sound-status-dot{width:10px;height:10px;border-radius:50%;background:var(--success-color)}.sound-status-dot.thinking{background:var(--warning-color);animation:pulse 1.5s infinite}.sound-status-dot.error{background:var(--error-color)}@keyframes pulse{0%{opacity:.4}50%{opacity:1}100%{opacity:.4}}.sound-thinking-indicator{display:none;align-items:center;gap:10px;padding:12px 20px;background:rgb(255 215 0/.1);border-radius:12px;border:1px solid var(--warning-color);margin:15px 0}.sound-thinking-text{color:var(--warning-color);font-size:14px}.sound-typing-dots{display:flex;gap:4px}.sound-typing-dot{width:8px;height=8px;border-radius:50%;background:var(--warning-color);animation:typing 1.4s infinite}.sound-typing-dot:nth-child(2){animation-delay:0.2s}.sound-typing-dot:nth-child(3){animation-delay:0.4s}@keyframes typing{0%,60%,100%{transform:translateY(0)}30%{transform:translateY(-6px)}}.sound-empty-state{display:flex;flex-direction:column;align-items:center;justify-content:center;height:400px;color:var(--text-secondary);text-align:center}.sound-empty-icon{font-size:64px;color:rgb(212 175 55/.3);margin-bottom:20px}.qr-container{width:200px;height:200px;margin:0 auto 20px;padding:10px;background:#fff;border-radius:12px;border:1px solid var(--gold-primary)}.theme-light .qr-container{border:1px solid var(--gold-dark)}.tx-history-item{display:flex;justify-content:space-between;align-items:center;padding:12px 15px;border-bottom:1px solid var(--card-border);transition:var(--transition)}.tx-history-item:hover{background:var(--gradient-card)}.tx-history-item:last-child{border-bottom:none}.tx-info{display:flex;align-items:center;gap:12px}.tx-icon{width:36px;height:36px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:14px}.tx-in{background:rgb(0 200 83 / .15);color:var(--success-color)}.tx-out{background:rgb(224 17 95 / .15);color:var(--error-color)}.tx-pending{background:rgb(255 215 0 / .15);color:var(--warning-color)}.tx-amount{font-weight:600}.tx-in .tx-amount{color:var(--success-color)}.tx-out .tx-amount{color:var(--error-color)}.tx-pending .tx-amount{color:var(--warning-color)}.mnemonic-timer-container{text-align:center;padding:30px;background:var(--gradient-card);border-radius:12px;margin:20px 0}.mnemonic-timer{font-size:48px;font-weight:600;color:var(--primary-color);font-family:'Cinzel',serif;margin:20px 0}.mnemonic-warning{color:var(--warning-color);font-size:13px;margin-top:10px}.mnemonic-words{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin:25px 0}.mnemonic-word{background:var(--card-bg);border:1px solid var(--card-border);padding:12px;border-radius:8px;text-align:center;font-size:14px;position:relative;overflow:hidden}.mnemonic-word::before{content:attr(data-index);position:absolute;top:2px;left:2px;font-size:10px;color:var(--text-secondary)}.action-buttons{display:flex;gap:12px;flex-wrap:wrap;justify-content:center}.action-btn{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:8px;background:var(--card-bg);border:1px solid var(--card-border);border-radius:12px;padding:25px;cursor:pointer;transition:var(--transition);min-width:120px;text-align:center}.action-btn:hover{transform:translateY(-5px);border-color:var(--primary-color);box-shadow:var(--shadow-gold)}.action-btn i{font-size:28px;color:var(--primary-color)}.action-btn span{font-size:12px;font-weight:500;letter-spacing:.5px}
   .token-details-row{display:flex;flex-direction:column;margin-top:10px;padding-top:10px;border-top:1px solid rgb(212 175 55 / .2);font-size:11px;color:var(--text-secondary)}.token-details-row .detail-row{display:flex;justify-content:space-between;margin-bottom:4px}.token-details-row .detail-label{color:var(--gold-accent);font-weight:500}.token-details-row .detail-value{font-family:'Courier New',monospace;color:var(--text-primary)}.nft-details-row{display:flex;flex-direction:column;margin-top:10px;padding-top:10px;border-top:1px solid rgb(212 175 55 / .2);font-size:11px;color:var(--text-secondary)}.nft-details-row .detail-row{display:flex;justify-content:space-between;margin-bottom:4px}.nft-details-row .detail-label{color:var(--gold-accent);font-weight:500}.nft-details-row .detail-value{font-family:'Courier New',monospace;color:var(--text-primary)}.real-tx-badge{background:linear-gradient(135deg,rgb(0 200 83 / .15),rgb(0 230 118 / .1));border:1px solid var(--success-color);color:var(--success-color);padding:2px 6px;border-radius:4px;font-size:9px;font-weight:500;margin-left:8px;display:inline-flex;align-items:center;gap:3px}.real-gas-badge{background:linear-gradient(135deg,rgb(212 175 55 / .15),rgb(244 228 184 / .1));border:1px solid var(--primary-color);color:var(--primary-color);padding:2px 6px;border-radius:4px;font-size:9px;font-weight:500;margin-left:8px;display:inline-flex;align-items:center;gap:3px}.real-price-badge{background:linear-gradient(135deg,rgb(15 82 186 / .15),rgb(0 102 255 / .1));border:1px solid var(--sapphire);color:var(--sapphire);padding:2px 6px;border-radius:4px;font-size:9px;font-weight:500;margin-left:8px;display:inline-flex;align-items:center;gap:3px}.token-actions{display:flex;justify-content:flex-end;gap:8px;margin-top:10px}.token-action-btn{background:var(--gradient-card);border:1px solid var(--card-border);color:var(--text-secondary);padding:6px 12px;border-radius:6px;font-size:10px;cursor:pointer;transition:var(--transition);display:flex;align-items:center;gap:5px}.token-action-btn:hover{background:rgb(212 175 55 / .1);border-color:var(--primary-color);color:var(--primary-color)}.event-item{display:flex;justify-content:space-between;align-items:center;padding:10px;background:var(--gradient-card);border:1px solid var(--card-border);border-radius:8px;margin-bottom:8px;transition:var(--transition)}.event-item:hover{border-color:var(--primary-color)}.event-info{flex:1}.event-time{font-size:12px;color:var(--primary-color);font-weight:600}.event-description{font-size:11px;color:var(--text-secondary);margin-top:2px}.nft-action-row{display:flex;justify-content:space-between;align-items:center;margin-top:8px;padding-top:8px;border-top:1px solid rgb(212 175 55 / .1)}.nft-action-btn{background:var(--gradient-card);border:1px solid var(--card-border);color:var(--text-secondary);padding:4px 8px;border-radius:4px;font-size:9px;cursor:pointer;transition:var(--transition);display:flex;align-items:center;gap:4px}.nft-action-btn:hover{background:rgb(212 175 55 / .1);border-color:var(--primary-color);color:var(--primary-color)}.event-actions{display:flex;gap:5px}.event-action-btn{background:var(--gradient-card);border:1px solid var(--card-border);color:var(--text-secondary);padding:4px 8px;border-radius:4px;font-size:10px;cursor:pointer;transition:var(--transition);display:flex;align-items:center;gap:4px}.event-action-btn:hover{background:rgb(212 175 55 / .1);border-color:var(--primary-color);color:var(--primary-color)}.rpc-config-section{margin-top:15px;padding-top:15px;border-top:1px solid var(--card-border);font-size:12px}.rpc-config-title{display:flex;align-items:center;gap:8px;color:var(--primary-color);font-weight:600;margin-bottom:10px;font-family:'Cinzel',serif;font-size:13px}.rpc-option{display:flex;align-items:center;gap:8px;margin-bottom:6px;padding:8px;background:var(--gradient-card);border-radius:6px;border:1px solid #fff0;transition:var(--transition);cursor:pointer}.rpc-option:hover{border-color:var(--primary-color);background:rgb(212 175 55 / .05)}.rpc-option.selected{border-color:var(--success-color);background:rgb(0 200 83 / .05)}.rpc-provider{flex:1;font-size:11px;color:var(--text-primary);font-family:'Courier New',monospace;word-break:break-all}.rpc-status{width:6px;height:6px;border-radius:50%;background:var(--success-color)}.rpc-status.offline{background:var(--error-color)}.custom-rpc-input{display:flex;gap:8px;margin-top:8px}.custom-rpc-input input{flex:1;padding:8px 12px;border:1px solid var(--card-border);background:var(--card-bg);color:var(--text-primary);border-radius:6px;font-size:11px;font-family:'Courier New',monospace}.custom-rpc-input button{padding:8px 12px;background:var(--gradient-gold);border:none;border-radius:6px;color:#1A1A1A;font-weight:500;font-size:11px;cursor:pointer;transition:var(--transition)}.custom-rpc-input button:hover{transform:translateY(-2px);box-shadow:var(--shadow-gold)}.engine-details{font-size:10px;color:var(--text-secondary);margin-top:4px;font-style:italic}
  </style>
</head>
<body class="theme-luxury">
  <div class="wallet-container">
    <header>
      <div class="logo">
        <h1>Exclusive Wallet</h1>
        <span>PREMIUM BLOCKCHAIN ISOLATED</span>
      </div>
      <div class="theme-controls">
        <button class="theme-toggle-btn" id="themeToggle"><i class="fas fa-sun"></i> Modo Claro</button>
      </div>
    </header>

    <div id="wallet-dashboard">
      <!-- Valor Global da Wallet -->
      <div class="global-value-display" id="globalValueDisplay">
        <div class="global-value-label">Valor Total da Wallet</div>
        <div class="global-value-amount" id="globalWalletValue">$0.00 USD</div>
        <div style="font-size:11px;color:var(--text-secondary);margin-top:8px;">
          <i class="fas fa-sync-alt" style="font-size:10px;"></i> Atualizado em tempo real via CoinGecko API
        </div>
      </div>

      <div class="tab-navigation">
        <button class="tab-button" data-tab="walletTab">
          <i class="fas fa-wallet"></i> Wallet
        </button>
        <button class="tab-button active" data-tab="blockchainsTab">
          <i class="fas fa-link"></i> Blockchains
        </button>
        <button class="tab-button" data-tab="infraAvzTab">
          <i class="fas fa-server"></i> Infra AVZ
        </button>
        <button class="tab-button" data-tab="soundExclusiveTab">
          <i class="fas fa-music"></i> IA Exclusive
        </button>
        <!-- NOVA ABA AGENDA -->
        <button class="tab-button" data-tab="agendaTab">
          <i class="fas fa-calendar-alt"></i> Agenda
        </button>
        <!-- NOVA ABA COMUNICAÇÃO -->
        <button class="tab-button" data-tab="communicationTab">
          <i class="fas fa-comments"></i> Comunicação
        </button>
      </div>

      <!-- ABA BLOCKCHAINS -->
      <div class="tab-content active" id="blockchainsTab">
        <div class="wallet-header">
          <h2><i class="fas fa-link"></i> 20 Blockchains Reais</h2>
          <p>Clique em qualquer blockchain para criar ou acessar sua wallet exclusiva</p>
        </div>

        <div class="blockchain-buttons-container" id="blockchainButtonsContainer">
          <!-- Botões serão inseridos via JavaScript -->
        </div>

        <div class="blockchain-empty-area" id="blockchainInfoArea">
          <div style="text-align:center;">
            <i class="fas fa-link" style="font-size:48px;color:var(--text-secondary);opacity:0.3;margin-bottom:20px;"></i>
            <p style="color:var(--text-secondary);font-size:16px;max-width:500px;margin:0 auto;">
              Selecione uma blockchain acima para começar<br>
              Cada blockchain possui sua própria wallet isolada
            </p>
          </div>
        </div>
      </div>

      <!-- ABA WALLET -->
      <div class="tab-content" id="walletTab">
        <div class="wallet-header">
          <h2><i class="fas fa-wallet"></i> Wallet Premium</h2>
          <p>Selecione uma blockchain para gerenciar sua wallet</p>
        </div>
        
        <div class="wallet-main-container" id="walletMainContainer">
          <div class="balance-main-container">
            <div class="balance-label">Sistema Blockchain Isolado</div>
            <div class="balance-display" style="color:var(--text-secondary);">Selecione uma Blockchain</div>
            <div class="balance-label">EXCLUSIVE WALLET</div>
            <div style="font-size:14px;color:var(--text-secondary);margin-top:15px;text-align:center;">
              Clique em uma blockchain no menu "Blockchains" para começar
            </div>
          </div>
        </div>
      </div>

      <!-- ABA INFRA AVZ -->
      <div class="tab-content" id="infraAvzTab">
        <div class="wallet-header">
          <h2><i class="fas fa-server"></i> Infraestrutura AVZ</h2>
          <p>Preparação para infraestrutura privada de conexão</p>
        </div>
        
        <div class="wallet-main-container">
          <div class="info-card">
            <h3><i class="fas fa-cogs"></i> Configurações Técnicas</h3>
            <p style="color:var(--text-secondary);margin:20px 0;">
              Esta área prepara a integração futura com infraestrutura privada AVZ.
            </p>
            
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-top:25px;">
              <div>
                <div style="font-size:13px;color:var(--text-secondary);margin-bottom:8px;">
                  <i class="fas fa-plug"></i> Conexões Futuras
                </div>
                <div style="font-size:12px;color:var(--text-primary);">
                  • RPC Próprio<br>
                  • Nodes Privados<br>
                  • API Gateway AVZ<br>
                  • WebSocket Seguro
                </div>
              </div>
              
              <div>
                <div style="font-size:13px;color:var(--text-secondary);margin-bottom:8px;">
                  <i class="fas fa-shield-alt"></i> Segurança
                </div>
                <div style="font-size:12px;color:var(--text-primary);">
                  • TLS 1.3<br>
                  • Autenticação Múltipla<br>
                  • Criptografia E2E<br>
                  • Logs Privados
                </div>
              </div>
            </div>
            
            <div style="margin-top:30px;padding:20px;background:var(--gradient-card);border-radius:12px;border:1px solid var(--card-border);">
              <div style="font-size:12px;color:var(--text-secondary);display:flex;align-items:center;gap:8px;margin-bottom:10px;">
                <i class="fas fa-info-circle"></i> Status da Infraestrutura
              </div>
              <div style="display:flex;align-items:center;gap:10px;">
                <div style="width:10px;height:10px;border-radius:50%;background:var(--warning-color);"></div>
                <div style="font-size:13px;color:var(--text-primary);">
                  Base estrutural preparada - Aguardando implantação
                </div>
              </div>
            </div>
            
            <div style="margin-top:25px;">
              <button class="btn-secondary btn-small" style="width:100%;" onclick="showAVZConfig()">
                <i class="fas fa-sliders-h"></i> Configurações Técnicas
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- ABA IA EXCLUSIVE -->
      <div class="tab-content" id="soundExclusiveTab">
        <div class="wallet-header">
          <h2><i class="fas fa-music"></i> IA Exclusive</h2>
          <p>IA exclusiva da wallet - Chat por texto e voz</p>
        </div>

        <div class="sound-exclusive-container">
          <div class="sound-header">
            <div>
              <h3 style="color:var(--primary-color);font-family:'Cinzel',serif;">
                <i class="fas fa-robot"></i> IA Exclusive
              </h3>
              <p style="color:var(--text-secondary);font-size:14px;margin-top:5px;">
                Converse com a IA exclusiva da wallet
              </p>
            </div>
            
            <div class="sound-usage-counter">
              <i class="fas fa-clock" style="color:var(--primary-color);"></i>
              <div>
                <div class="usage-count" id="usageCount">20</div>
                <div style="font-size:11px;color:var(--text-secondary);">chamadas restantes</div>
              </div>
            </div>
          </div>

          <div class="sound-chat-container">
            <div class="sound-chat-messages" id="soundChatMessages">
              <div class="sound-empty-state">
                <div class="sound-empty-icon">
                  <i class="fas fa-comments"></i>
                </div>
                <h3 style="color:var(--text-secondary);margin-bottom:10px;">
                  IA Exclusive AI
                </h3>
                <p style="color:var(--text-secondary);max-width:400px;margin:0 auto;">
                  Olá! Sou a IA exclusiva da wallet. Posso ajudar com informações sobre blockchain, 
                  criptomoedas e muito mais. Como posso ajudá-lo hoje?
                </p>
              </div>
            </div>

            <div class="sound-thinking-indicator" id="thinkingIndicator">
              <div class="sound-typing-dots">
                <div class="sound-typing-dot"></div>
                <div class="sound-typing-dot"></div>
                <div class="sound-typing-dot"></div>
              </div>
              <div class="sound-thinking-text">IA Exclusive está digitando...</div>
            </div>

            <div class="sound-chat-input-area">
              <input type="text" class="sound-chat-input" id="soundChatInput" 
                     placeholder="Digite sua mensagem para a IA Exclusive..." 
                     onkeydown="handleSoundChatKeyPress(event)">
              <button class="btn-primary btn-small" onclick="sendSoundMessage()">
                <i class="fas fa-paper-plane"></i> Enviar
              </button>
            </div>
          </div>

          <div class="sound-voice-controls">
            <div class="sound-voice-btn" onclick="startVoiceInput()">
              <i class="fas fa-microphone"></i>
              <span>Falar com IA</span>
            </div>
            
            <div class="sound-voice-btn" onclick="toggleVoiceResponse()">
              <i class="fas fa-volume-up" id="voiceResponseIcon"></i>
              <span id="voiceResponseText">Voz Ativada</span>
            </div>
            
            <div class="sound-voice-btn" onclick="clearSoundChat()">
              <i class="fas fa-trash-alt"></i>
              <span>Limpar Chat</span>
            </div>
          </div>

          <div class="sound-status-indicator">
            <div class="sound-status-dot" id="connectionStatus"></div>
            <div style="color:var(--text-secondary);font-size:13px;">
              <span id="statusText">Conectado ao Cloudflare Worker</span>
            </div>
          </div>
        </div>
      </div>

      <!-- NOVA ABA AGENDA -->
      <div class="tab-content" id="agendaTab">
        <div class="wallet-header">
          <h2><i class="fas fa-calendar-alt"></i> Agenda Premium</h2>
          <p>Gerencie seus compromissos com elegância e segurança local</p>
        </div>

        <div class="wallet-main-container">
          <!-- CONTROLES DO MÊS -->
          <div class="agenda-header">
            <button class="theme-toggle-btn btn-small" onclick="changeAgendaMonth(-1)">
              <i class="fas fa-chevron-left"></i> Mês Anterior
            </button>
            <div class="agenda-month-title" id="currentMonthTitle">Janeiro 2024</div>
            <button class="theme-toggle-btn btn-small" onclick="changeAgendaMonth(1)">
              Próximo Mês <i class="fas fa-chevron-right"></i>
            </button>
          </div>

          <!-- CALENDÁRIO PREMIUM -->
          <div class="agenda-calendar" id="agendaCalendar">
            <!-- Cabeçalho dos dias da semana -->
            <div class="agenda-day" style="background:transparent;border:none;text-align:center;font-weight:600;color:var(--primary-color);min-height:30px;">
              DOM
            </div>
            <div class="agenda-day" style="background:transparent;border:none;text-align:center;font-weight:600;color:var(--primary-color);min-height:30px;">
              SEG
            </div>
            <div class="agenda-day" style="background:transparent;border:none;text-align:center;font-weight:600;color:var(--primary-color);min-height:30px;">
              TER
            </div>
            <div class="agenda-day" style="background:transparent;border:none;text-align:center;font-weight:600;color:var(--primary-color);min-height:30px;">
              QUA
            </div>
            <div class="agenda-day" style="background:transparent;border:none;text-align:center;font-weight:600;color:var(--primary-color);min-height:30px;">
              QUI
            </div>
            <div class="agenda-day" style="background:transparent;border:none;text-align:center;font-weight:600;color:var(--primary-color);min-height:30px;">
              SEX
            </div>
            <div class="agenda-day" style="background:transparent;border:none;text-align:center;font-weight:600;color:var(--primary-color);min-height:30px;">
              SAB
            </div>
            <!-- Dias serão gerados via JavaScript -->
          </div>

          <!-- COMPROMISSOS DO DIA SELECIONADO -->
          <div class="info-card" id="dayEventsCard" style="display:none;">
            <h3><i class="fas fa-clock"></i> Compromissos do Dia</h3>
            <div id="selectedDateTitle" style="color:var(--text-secondary);margin-bottom:20px;"></div>
            <div id="dayEventsList">
              <!-- Compromissos serão listados aqui -->
            </div>
            
            <!-- Formulário para novo compromisso -->
            <div class="agenda-event-form">
              <h4 style="color:var(--primary-color);margin-bottom:15px;font-size:16px;">
                <i class="fas fa-plus-circle"></i> Novo Compromisso
              </h4>
              <div class="input-group">
                <label><i class="fas fa-clock"></i> Hora</label>
                <input type="time" id="eventTime" style="font-family:'Inter',sans-serif;">
              </div>
              <div class="input-group">
                <label><i class="fas fa-align-left"></i> Descrição</label>
                <textarea id="eventDescription" rows="3" placeholder="Descreva o compromisso..."></textarea>
              </div>
              <button class="btn-primary btn-small" onclick="addEventToSelectedDate()" style="width:100%;">
                <i class="fas fa-calendar-plus"></i> Adicionar Compromisso
              </button>
            </div>
          </div>

          <!-- AÇÕES DA AGENDA -->
          <div class="wallet-operations-grid" style="margin-top:30px;">
            <div class="action-btn" onclick="exportAgendaToPDF()">
              <i class="fas fa-file-pdf"></i>
              <span>Exportar PDF</span>
            </div>
            <div class="action-btn" onclick="clearAllEvents()">
              <i class="fas fa-trash-alt"></i>
              <span>Limpar Agenda</span>
            </div>
            <div class="action-btn" onclick="loadAgendaData()">
              <i class="fas fa-sync-alt"></i>
              <span>Recarregar</span>
            </div>
          </div>

          <!-- MENSAGEM QUANDO NENHUMA DATA SELECIONADA -->
          <div class="blockchain-empty-area" id="noDateSelectedMessage">
            <div style="text-align:center;">
              <i class="fas fa-calendar-day" style="font-size:48px;color:var(--text-secondary);opacity:0.3;margin-bottom:20px;"></i>
              <p style="color:var(--text-secondary);font-size:16px;max-width:500px;margin:0 auto;">
                Selecione uma data no calendário para visualizar ou adicionar compromissos
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- NOVA ABA COMUNICAÇÃO -->
      <div class="tab-content" id="communicationTab">
        <div class="wallet-header">
          <h2><i class="fas fa-comments"></i> Comunicação Premium</h2>
          <p>Comunicação P2P 100% descentralizada - WebRTC puro</p>
        </div>

        <div class="communication-main-container">
          <!-- SUB-ABAS INTERNAS -->
          <div class="sub-tab-navigation">
            <button class="sub-tab-btn active" data-subtab="authorizationTab">
              <i class="fas fa-key"></i> Autorização
            </button>
            <button class="sub-tab-btn" data-subtab="chatIndividualTab">
              <i class="fas fa-comment"></i> Chat Individual
            </button>
            <button class="sub-tab-btn" data-subtab="chatGroupTab">
              <i class="fas fa-comments"></i> Chat Grupo
            </button>
            <button class="sub-tab-btn" data-subtab="videoIndividualTab">
              <i class="fas fa-video"></i> Vídeo Individual
            </button>
            <button class="sub-tab-btn" data-subtab="videoGroupTab">
              <i class="fas fa-users"></i> Vídeo Grupo
            </button>
          </div>

          <!-- SUB-ABA: AUTORIZAÇÃO (COM CONTATOS INTEGRADO) -->
          <div class="sub-tab-content active" id="authorizationTab">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 40px;">
              <!-- Coluna 1: Autorização -->
              <div>
                <div class="authorization-box">
                  <h3 class="address-registration-title">
                    <i class="fas fa-user-shield"></i> Autorização de Comunicação
                  </h3>
                  <p class="address-instruction">
                    Vincule sua wallet e gerencie permissões para comunicação P2P. 
                    Todas as configurações são salvas apenas no seu dispositivo.
                  </p>
                  
                  <div class="wallet-address-display">
                    <div class="address-text" id="linkedWalletAddress">Nenhuma wallet vinculada</div>
                    <button class="copy-btn" onclick="linkCurrentWallet()">
                      <i class="fas fa-link"></i> Vincular Wallet
                    </button>
                  </div>
                  
                  <div class="verification-status">
                    <div class="status-indicator" id="authStatus"></div>
                    <span id="authStatusText">Status: Não autorizado</span>
                  </div>
                  
                  <div class="communication-badges">
                    <div class="communication-badge" id="chatIndividualBadge">
                      <i class="fas fa-comment"></i> Chat Individual
                    </div>
                    <div class="communication-badge" id="chatGroupBadge">
                      <i class="fas fa-comments"></i> Chat Grupo
                    </div>
                    <div class="communication-badge" id="videoIndividualBadge">
                      <i class="fas fa-video"></i> Vídeo Individual
                    </div>
                    <div class="communication-badge" id="videoGroupBadge">
                      <i class="fas fa-users"></i> Vídeo Grupo
                    </div>
                    <div class="communication-badge" id="microphoneBadge">
                      <i class="fas fa-microphone"></i> Microfone
                    </div>
                    <div class="communication-badge" id="cameraBadge">
                      <i class="fas fa-camera"></i> Câmera
                    </div>
                  </div>
                  
                  <div class="input-group" style="margin-top:30px;">
                    <label>Permissões de Comunicação</label>
                    <div style="display:grid;grid-template-columns:1fr 1fr;gap:15px;margin-top:10px;">
                      <div>
                        <label style="display:flex;align-items:center;gap:8px;margin-bottom:8px;">
                          <input type="checkbox" id="permissionChatIndividual" onchange="togglePermission('chatIndividual', this.checked)">
                          Chat Individual
                        </label>
                        <label style="display:flex;align-items:center;gap:8px;margin-bottom:8px;">
                          <input type="checkbox" id="permissionChatGroup" onchange="togglePermission('chatGroup', this.checked)">
                          Chat em Grupo
                        </label>
                        <label style="display:flex;align-items:center;gap:8px;margin-bottom:8px;">
                          <input type="checkbox" id="permissionVideoIndividual" onchange="togglePermission('videoIndividual', this.checked)">
                          Vídeo Individual
                        </label>
                      </div>
                      <div>
                        <label style="display:flex;align-items:center;gap:8px;margin-bottom:8px;">
                          <input type="checkbox" id="permissionVideoGroup" onchange="togglePermission('videoGroup', this.checked)">
                          Vídeo em Grupo
                        </label>
                        <label style="display:flex;align-items:center;gap:8px;margin-bottom:8px;">
                          <input type="checkbox" id="permissionMicrophone" onchange="togglePermission('microphone', this.checked)">
                          Microfone
                        </label>
                        <label style="display:flex;align-items:center;gap:8px;margin-bottom:8px;">
                          <input type="checkbox" id="permissionCamera" onchange="togglePermission('camera', this.checked)">
                          Câmera
                        </label>
                      </div>
                    </div>
                  </div>
                  
                  <div style="margin-top:25px;">
                    <button class="btn-primary btn-small" onclick="saveAuthorization()" style="width:100%;">
                      <i class="fas fa-save"></i> Salvar Autorizações
                    </button>
                  </div>
                </div>
              </div>
              
              <!-- Coluna 2: Contatos -->
              <div>
                <div class="info-card">
                  <h3><i class="fas fa-address-book"></i> Gerenciar Contatos</h3>
                  <p style="color:var(--text-secondary);margin-bottom:20px;">
                    Adicione e gerencie contatos para comunicação P2P. Os contatos são salvos apenas localmente.
                  </p>
                  
                  <div class="contacts-list-container" id="contactsListContainer">
                    <!-- Contatos serão listados aqui -->
                  </div>
                  
                  <div class="add-contact-form">
                    <h4 style="color:var(--primary-color);margin-bottom:15px;font-size:16px;">
                      <i class="fas fa-plus-circle"></i> Adicionar Novo Contato
                    </h4>
                    <div class="input-group">
                      <label><i class="fas fa-wallet"></i> Endereço da Wallet</label>
                      <input type="text" id="contactWalletAddress" placeholder="0x..." style="font-family:'Courier New',monospace;">
                    </div>
                    <div class="input-group">
                      <label><i class="fas fa-user"></i> Nome do Contato (opcional)</label>
                      <input type="text" id="contactName" placeholder="Nome para identificação">
                    </div>
                    <button class="btn-primary btn-small" onclick="addContact()" style="width:100%;">
                      <i class="fas fa-user-plus"></i> Adicionar Contato
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- SUB-ABA: CHAT INDIVIDUAL -->
          <div class="sub-tab-content hidden" id="chatIndividualTab">
            <div class="info-card">
              <h3><i class="fas fa-comment"></i> Chat Individual P2P</h3>
              <div style="display:flex;gap:15px;margin-bottom:20px;">
                <select id="chatIndividualContact" class="input-group" style="flex:1;padding:12px;border:1px solid var(--card-border);border-radius:8px;background:var(--card-bg);color:var(--text-primary);">
                  <option value="">Selecione um contato...</option>
                </select>
                <button class="btn-secondary btn-small" onclick="startIndividualChat()">
                  <i class="fas fa-play"></i> Iniciar Chat
                </button>
              </div>
              
              <div class="chat-container" id="individualChatContainer" style="display:none;">
                <div class="chat-messages" id="individualChatMessages">
                  <div class="no-events-message">
                    <i class="fas fa-comments" style="font-size:32px;margin-bottom:10px;opacity:0.5;"></i>
                    <p>Nenhuma mensagem ainda</p>
                  </div>
                </div>
                <div class="chat-input-area">
                  <input type="text" class="chat-input" id="individualChatInput" placeholder="Digite sua mensagem..." disabled>
                  <button class="btn-primary btn-small" id="individualChatSendBtn" onclick="sendIndividualChatMessage()" disabled>
                    <i class="fas fa-paper-plane"></i> Enviar
                  </button>
                </div>
              </div>
              
              <div id="individualChatNotStarted" style="text-align:center;padding:40px;">
                <i class="fas fa-comment-slash" style="font-size:48px;color:var(--text-secondary);opacity:0.3;margin-bottom:20px;"></i>
                <p style="color:var(--text-secondary);">
                  Selecione um contato e inicie o chat para começar a conversar
                </p>
              </div>
            </div>
          </div>

          <!-- SUB-ABA: CHAT GRUPO -->
          <div class="sub-tab-content hidden" id="chatGroupTab">
            <div class="info-card">
              <h3><i class="fas fa-comments"></i> Chat em Grupo P2P</h3>
              <div style="margin-bottom:20px;">
                <label style="display:block;margin-bottom:10px;color:var(--text-secondary);">
                  <i class="fas fa-users"></i> Selecione contatos para o grupo:
                </label>
                <div id="groupChatContactsList" style="display:grid;grid-template-columns:repeat(auto-fill, minmax(200px, 1fr));gap:10px;">
                  <!-- Contatos para seleção serão inseridos aqui -->
                </div>
              </div>
              
              <div style="display:flex;gap:10px;margin-top:20px;">
                <input type="text" id="groupChatName" placeholder="Nome do grupo" style="flex:1;padding:12px;border:1px solid var(--card-border);border-radius:8px;background:var(--card-bg);color:var(--text-primary);">
                <button class="btn-secondary btn-small" onclick="createGroupChat()">
                  <i class="fas fa-plus"></i> Criar Grupo
                </button>
              </div>
              
              <div class="chat-container" id="groupChatContainer" style="display:none;margin-top:20px;">
                <div class="chat-messages" id="groupChatMessages">
                  <div class="no-events-message">
                    <i class="fas fa-comments" style="font-size:32px;margin-bottom:10px;opacity:0.5;"></i>
                    <p>Nenhuma mensagem ainda no grupo</p>
                  </div>
                </div>
                <div class="chat-input-area">
                  <input type="text" class="chat-input" id="groupChatInput" placeholder="Digite sua mensagem para o grupo..." disabled>
                  <button class="btn-primary btn-small" id="groupChatSendBtn" onclick="sendGroupChatMessage()" disabled>
                    <i class="fas fa-paper-plane"></i> Enviar
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- SUB-ABA: VÍDEO INDIVIDUAL -->
          <div class="sub-tab-content hidden" id="videoIndividualTab">
            <div class="info-card">
              <h3><i class="fas fa-video"></i> Vídeo Individual P2P</h3>
              <div style="display:flex;gap:15px;margin-bottom:20px;">
                <select id="videoIndividualContact" class="input-group" style="flex:1;padding:12px;border:1px solid var(--card-border);border-radius:8px;background:var(--card-bg);color:var(--text-primary);">
                  <option value="">Selecione um contato...</option>
                </select>
                <button class="btn-secondary btn-small" onclick="startIndividualVideoCall()">
                  <i class="fas fa-video"></i> Iniciar Chamada
                </button>
              </div>
              
              <div class="video-call-container" id="individualVideoContainer" style="display:none;">
                <div class="video-container">
                  <div class="video-placeholder" id="individualVideoPlaceholder">
                    <i class="fas fa-video-slash"></i>
                    <p>Chamada não iniciada</p>
                  </div>
                  <video id="individualRemoteVideo" autoplay playsinline style="display:none;"></video>
                </div>
                
                <div class="local-video">
                  <video id="individualLocalVideo" autoplay playsinline muted></video>
                </div>
                
                <div class="video-controls">
                  <button class="btn-secondary btn-small" id="toggleMicrophoneBtn" onclick="toggleMicrophone()">
                    <i class="fas fa-microphone"></i> Microfone
                  </button>
                  <button class="btn-secondary btn-small" id="toggleCameraBtn" onclick="toggleCamera()">
                    <i class="fas fa-camera"></i> Câmera
                  </button>
                  <button class="btn-success btn-small" id="endCallBtn" onclick="endIndividualVideoCall()">
                    <i class="fas fa-phone-slash"></i> Encerrar
                  </button>
                </div>
              </div>
              
              <div id="individualVideoNotStarted" style="text-align:center;padding:40px;">
                <i class="fas fa-video-slash" style="font-size:48px;color:var(--text-secondary);opacity:0.3;margin-bottom:20px;"></i>
                <p style="color:var(--text-secondary);">
                  Selecione um contato e inicie a chamada de vídeo
                </p>
              </div>
            </div>
          </div>

          <!-- SUB-ABA: VÍDEO GRUPO -->
          <div class="sub-tab-content hidden" id="videoGroupTab">
            <div class="info-card">
              <h3><i class="fas fa-users"></i> Vídeo em Grupo P2P</h3>
              <div style="margin-bottom:20px;">
                <label style="display:block;margin-bottom:10px;color:var(--text-secondary);">
                  <i class="fas fa-user-friends"></i> Selecione contatos para o grupo de vídeo:
                </label>
                <div id="groupVideoContactsList" style="display:grid;grid-template-columns:repeat(auto-fill, minmax(200px, 1fr));gap:10px;">
                  <!-- Contatos para seleção serão inseridos aqui -->
                </div>
              </div>
              
              <div style="display:flex;gap:10px;margin-top:20px;">
                <input type="text" id="groupVideoName" placeholder="Nome do grupo de vídeo" style="flex:1;padding:12px;border:1px solid var(--card-border);border-radius:8px;background:var(--card-bg);color:var(--text-primary);">
                <button class="btn-secondary btn-small" onclick="createGroupVideoCall()">
                  <i class="fas fa-video"></i> Criar Grupo
                </button>
              </div>
              
              <div id="groupVideoContainer" style="display:none;margin-top:20px;">
                <div class="group-video-container" id="groupVideoGrid">
                  <!-- Vídeos dos participantes serão inseridos aqui -->
                </div>
                
                <div class="video-controls" style="margin-top:20px;">
                  <button class="btn-secondary btn-small" id="groupToggleMicrophoneBtn" onclick="toggleGroupMicrophone()">
                    <i class="fas fa-microphone"></i> Microfone
                  </button>
                  <button class="btn-secondary btn-small" id="groupToggleCameraBtn" onclick="toggleGroupCamera()">
                    <i class="fas fa-camera"></i> Câmera
                  </button>
                  <button class="btn-success btn-small" id="groupEndCallBtn" onclick="endGroupVideoCall()">
                    <i class="fas fa-phone-slash"></i> Encerrar Grupo
                  </button>
                </div>
              </div>
              
              <div id="groupVideoNotStarted" style="text-align:center;padding:40px;">
                <i class="fas fa-users-slash" style="font-size:48px;color:var(--text-secondary);opacity:0.3;margin-bottom:20px;"></i>
                <p style="color:var(--text-secondary);">
                  Selecione contatos e crie um grupo para iniciar a chamada de vídeo em grupo
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="notification" id="notification">
    <div id="notificationMessage">✅ Sistema Blockchain Isolado Pronto!</div>
  </div>

  <script>
    const { ethers } = window;
    
    // CONFIGURAÇÃO DAS 20 BLOCKCHAINS REAIS COM RPCs ADICIONAIS
    const blockchains = [
      { 
        id: 'polygon', 
        name: 'Polygon', 
        symbol: 'MATIC', 
        chainId: 137, 
        coingeckoId: 'matic-network', 
        rpcUrl: 'https://polygon-rpc.com',
        rpcOptions: [
          { url: 'https://polygon-rpc.com', provider: 'Polygon RPC', engine: 'Geth', status: 'online' },
          { url: 'https://rpc-mainnet.maticvigil.com', provider: 'MaticVigil', engine: 'Bor', status: 'online' },
          { url: 'https://polygon-mainnet.infura.io/v3/${INFURA_KEY}', provider: 'Infura', engine: 'Geth', status: 'online' },
          { url: 'https://polygon-mainnet.g.alchemy.com/v2/${ALCHEMY_KEY}', provider: 'Alchemy', engine: 'Geth', status: 'online' },
          { url: 'https://avzdynamic.avizaecosystem.workers.dev/', provider: 'AVZ Infra RPC', engine: 'Geth', status: 'online' }
        ]
      },
      { 
        id: 'ethereum', 
        name: 'Ethereum', 
        symbol: 'ETH', 
        chainId: 1, 
        coingeckoId: 'ethereum', 
        rpcUrl: 'https://eth.llamarpc.com',
        rpcOptions: [
          { url: 'https://eth.llamarpc.com', provider: 'LlamaNodes', engine: 'Geth', status: 'online' },
          { url: 'https://rpc.ankr.com/eth', provider: 'Ankr', engine: 'Nethermind', status: 'online' },
          { url: 'https://mainnet.infura.io/v3/${INFURA_KEY}', provider: 'Infura', engine: 'Geth', status: 'online' },
          { url: 'https://eth-mainnet.g.alchemy.com/v2/${ALCHEMY_KEY}', provider: 'Alchemy', engine: 'Geth', status: 'online' }
        ]
      },
      { 
        id: 'bsc', 
        name: 'BSC', 
        symbol: 'BNB', 
        chainId: 56, 
        coingeckoId: 'binancecoin', 
        rpcUrl: 'https://bsc-dataseed.binance.org',
        rpcOptions: [
          { url: 'https://bsc-dataseed.binance.org', provider: 'Binance', engine: 'Geth', status: 'online' },
          { url: 'https://bsc-dataseed1.ninicoin.io', provider: 'Ninicoin', engine: 'Geth', status: 'online' },
          { url: 'https://rpc.ankr.com/bsc', provider: 'Ankr', engine: 'Geth', status: 'online' },
          { url: 'https://bsc-mainnet.nodereal.io/v1/${NODEREAL_KEY}', provider: 'NodeReal', engine: 'Geth', status: 'online' }
        ]
      },
      { 
        id: 'avalanche', 
        name: 'Avalanche', 
        symbol: 'AVAX', 
        chainId: 43114, 
        coingeckoId: 'avalanche-2', 
        rpcUrl: 'https://api.avax.network/ext/bc/C/rpc',
        rpcOptions: [
          { url: 'https://api.avax.network/ext/bc/C/rpc', provider: 'Avalanche', engine: 'Coreth', status: 'online' },
          { url: 'https://rpc.ankr.com/avalanche', provider: 'Ankr', engine: 'Coreth', status: 'online' },
          { url: 'https://avalanche-mainnet.infura.io/v3/${INFURA_KEY}', provider: 'Infura', engine: 'Coreth', status: 'online' },
          { url: 'https://avax-mainnet.g.alchemy.com/v2/${ALCHEMY_KEY}', provider: 'Alchemy', engine: 'Coreth', status: 'online' }
        ]
      },
      { 
        id: 'fantom', 
        name: 'Fantom', 
        symbol: 'FTM', 
        chainId: 250, 
        coingeckoId: 'fantom', 
        rpcUrl: 'https://rpc.ftm.tools',
        rpcOptions: [
          { url: 'https://rpc.ftm.tools', provider: 'Fantom', engine: 'Go-Fantom', status: 'online' },
          { url: 'https://rpc.ankr.com/fantom', provider: 'Ankr', engine: 'Go-Fantom', status: 'online' },
          { url: 'https://fantom-mainnet.gateway.pokt.network/v1/lb/${POKT_KEY}', provider: 'Pocket', engine: 'Go-Fantom', status: 'online' }
        ]
      },
      { 
        id: 'arbitrum', 
        name: 'Arbitrum', 
        symbol: 'ETH', 
        chainId: 42161, 
        coingeckoId: 'ethereum', 
        rpcUrl: 'https://arb1.arbitrum.io/rpc',
        rpcOptions: [
          { url: 'https://arb1.arbitrum.io/rpc', provider: 'Arbitrum', engine: 'Arbitrum Nitro', status: 'online' },
          { url: 'https://rpc.ankr.com/arbitrum', provider: 'Ankr', engine: 'Arbitrum Nitro', status: 'online' },
          { url: 'https://arbitrum-mainnet.infura.io/v3/${INFURA_KEY}', provider: 'Infura', engine: 'Arbitrum Nitro', status: 'online' },
          { url: 'https://arb-mainnet.g.alchemy.com/v2/${ALCHEMY_KEY}', provider: 'Alchemy', engine: 'Arbitrum Nitro', status: 'online' }
        ]
      },
      { 
        id: 'optimism', 
        name: 'Optimism', 
        symbol: 'ETH', 
        chainId: 10, 
        coingeckoId: 'ethereum', 
        rpcUrl: 'https://mainnet.optimism.io',
        rpcOptions: [
          { url: 'https://mainnet.optimism.io', provider: 'Optimism', engine: 'OP Stack', status: 'online' },
          { url: 'https://rpc.ankr.com/optimism', provider: 'Ankr', engine: 'OP Stack', status: 'online' },
          { url: 'https://optimism-mainnet.infura.io/v3/${INFURA_KEY}', provider: 'Infura', engine: 'OP Stack', status: 'online' },
          { url: 'https://opt-mainnet.g.alchemy.com/v2/${ALCHEMY_KEY}', provider: 'Alchemy', engine: 'OP Stack', status: 'online' }
        ]
      },
      { 
        id: 'base', 
        name: 'Base', 
        symbol: 'ETH', 
        chainId: 8453, 
        coingeckoId: 'ethereum', 
        rpcUrl: 'https://mainnet.base.org',
        rpcOptions: [
          { url: 'https://mainnet.base.org', provider: 'Base', engine: 'OP Stack', status: 'online' },
          { url: 'https://base-mainnet.infura.io/v3/${INFURA_KEY}', provider: 'Infura', engine: 'OP Stack', status: 'online' },
          { url: 'https://base-mainnet.g.alchemy.com/v2/${ALCHEMY_KEY}', provider: 'Alchemy', engine: 'OP Stack', status: 'online' }
        ]
      },
      { 
        id: 'cronos', 
        name: 'Cronos', 
        symbol: 'CRO', 
        chainId: 25, 
        coingeckoId: 'crypto-com-chain', 
        rpcUrl: 'https://evm.cronos.org',
        rpcOptions: [
          { url: 'https://evm.cronos.org', provider: 'Cronos', engine: 'Cronos EVM', status: 'online' },
          { url: 'https://cronos-mainnet.crypto.org:8545', provider: 'Crypto.org', engine: 'Cronos EVM', status: 'online' }
        ]
      },
      { 
        id: 'harmony', 
        name: 'Harmony', 
        symbol: 'ONE', 
        chainId: 1666600000, 
        coingeckoId: 'harmony', 
        rpcUrl: 'https://api.harmony.one',
        rpcOptions: [
          { url: 'https://api.harmony.one', provider: 'Harmony', engine: 'Harmony', status: 'online' },
          { url: 'https://rpc.ankr.com/harmony', provider: 'Ankr', engine: 'Harmony', status: 'online' }
        ]
      },
      { 
        id: 'kava', 
        name: 'Kava', 
        symbol: 'KAVA', 
        chainId: 2222, 
        coingeckoId: 'kava', 
        rpcUrl: 'https://evm.kava.io',
        rpcOptions: [
          { url: 'https://evm.kava.io', provider: 'Kava', engine: 'Kava EVM', status: 'online' },
          { url: 'https://kava-evm.publicnode.com', provider: 'PublicNode', engine: 'Kava EVM', status: 'online' }
        ]
      },
      { 
        id: 'celo', 
        name: 'Celo', 
        symbol: 'CELO', 
        chainId: 42220, 
        coingeckoId: 'celo', 
        rpcUrl: 'https://forno.celo.org',
        rpcOptions: [
          { url: 'https://forno.celo.org', provider: 'Celo', engine: 'Celo EVM', status: 'online' },
          { url: 'https://rpc.ankr.com/celo', provider: 'Ankr', engine: 'Celo EVM', status: 'online' }
        ]
      },
      { 
        id: 'moonbeam', 
        name: 'Moonbeam', 
        symbol: 'GLMR', 
        chainId: 1284, 
        coingeckoId: 'moonbeam', 
        rpcUrl: 'https://rpc.api.moonbeam.network',
        rpcOptions: [
          { url: 'https://rpc.api.moonbeam.network', provider: 'Moonbeam', engine: 'Moonbeam EVM', status: 'online' },
          { url: 'https://moonbeam.public.blastapi.io', provider: 'BlastAPI', engine: 'Moonbeam EVM', status: 'online' }
        ]
      },
      { 
        id: 'moonriver', 
        name: 'Moonriver', 
        symbol: 'MOVR', 
        chainId: 1285, 
        coingeckoId: 'moonriver', 
        rpcUrl: 'https://rpc.api.moonriver.moonbeam.network',
        rpcOptions: [
          { url: 'https://rpc.api.moonriver.moonbeam.network', provider: 'Moonriver', engine: 'Moonriver EVM', status: 'online' },
          { url: 'https://moonriver.public.blastapi.io', provider: 'BlastAPI', engine: 'Moonriver EVM', status: 'online' }
        ]
      },
      { 
        id: 'gnosis', 
        name: 'Gnosis', 
        symbol: 'xDAI', 
        chainId: 100, 
        coingeckoId: 'xdai', 
        rpcUrl: 'https://rpc.gnosischain.com',
        rpcOptions: [
          { url: 'https://rpc.gnosischain.com', provider: 'Gnosis', engine: 'Nethermind', status: 'online' },
          { url: 'https://rpc.ankr.com/gnosis', provider: 'Ankr', engine: 'Nethermind', status: 'online' }
        ]
      },
      { 
        id: 'fuse', 
        name: 'Fuse', 
        symbol: 'FUSE', 
        chainId: 122, 
        coingeckoId: 'fuse-network', 
        rpcUrl: 'https://fuse-rpc.gateway.pokt.network',
        rpcOptions: [
          { url: 'https://fuse-rpc.gateway.pokt.network', provider: 'Pocket Network', engine: 'Fuse EVM', status: 'online' },
          { url: 'https://rpc.fuse.io', provider: 'Fuse', engine: 'Fuse EVM', status: 'online' },
          { url: 'https://fuse-mainnet.chainstacklabs.com', provider: 'Chainstack', engine: 'Fuse EVM', status: 'online' }
        ]
      },
      { 
        id: 'metis', 
        name: 'Metis', 
        symbol: 'METIS', 
        chainId: 1088, 
        coingeckoId: 'metis-token', 
        rpcUrl: 'https://andromeda.metis.io/?owner=1088',
        rpcOptions: [
          { url: 'https://andromeda.metis.io/?owner=1088', provider: 'Metis', engine: 'Metis EVM', status: 'online' },
          { url: 'https://metis-mainnet.public.blastapi.io', provider: 'BlastAPI', engine: 'Metis EVM', status: 'online' }
        ]
      },
      { 
        id: 'polygonzkevm', 
        name: 'Polygon zkEVM', 
        symbol: 'ETH', 
        chainId: 1101, 
        coingeckoId: 'ethereum', 
        rpcUrl: 'https://zkevm-rpc.com',
        rpcOptions: [
          { url: 'https://zkevm-rpc.com', provider: 'Polygon zkEVM', engine: 'zkEVM', status: 'online' },
          { url: 'https://polygon-zkevm-mainnet.infura.io/v3/${INFURA_KEY}', provider: 'Infura', engine: 'zkEVM', status: 'online' }
        ]
      },
      { 
        id: 'linea', 
        name: 'Linea', 
        symbol: 'ETH', 
        chainId: 59144, 
        coingeckoId: 'ethereum', 
        rpcUrl: 'https://rpc.linea.build',
        rpcOptions: [
          { url: 'https://rpc.linea.build', provider: 'Linea', engine: 'ConsenSys zkEVM', status: 'online' },
          { url: 'https://linea-mainnet.infura.io/v3/${INFURA_KEY}', provider: 'Infura', engine: 'ConsenSys zkEVM', status: 'online' }
        ]
      },
      { 
        id: 'scroll', 
        name: 'Scroll', 
        symbol: 'ETH', 
        chainId: 534352, 
        coingeckoId: 'ethereum', 
        rpcUrl: 'https://rpc.scroll.io',
        rpcOptions: [
          { url: 'https://rpc.scroll.io', provider: 'Scroll', engine: 'Scroll zkEVM', status: 'online' },
          { url: 'https://scroll-mainnet.infura.io/v3/${INFURA_KEY}', provider: 'Infura', engine: 'Scroll zkEVM', status: 'online' }
        ]
      }
    ];

    // SISTEMA DE ARMAZENAMENTO ISOLADO
    const blockchainStorage = {
      get: (chainId) => localStorage.getItem(`wallet_${chainId}`),
      set: (chainId, data) => localStorage.setItem(`wallet_${chainId}`, JSON.stringify(data)),
      remove: (chainId) => localStorage.removeItem(`wallet_${chainId}`),
      exists: (chainId) => !!localStorage.getItem(`wallet_${chainId}`)
    };

    // SISTEMA DE RPCs PERSONALIZADOS
    const customRPCs = {
      get: (chainId) => {
        const saved = localStorage.getItem(`custom_rpc_${chainId}`);
        return saved ? JSON.parse(saved) : [];
      },
      set: (chainId, rpcs) => {
        localStorage.setItem(`custom_rpc_${chainId}`, JSON.stringify(rpcs));
      },
      add: (chainId, rpc) => {
        const rpcs = customRPCs.get(chainId);
        rpcs.push(rpc);
        customRPCs.set(chainId, rpcs);
      }
    };

    // SISTEMA DE VALORES REAIS EM USD
    let tokenPrices = {};
    let globalWalletValue = 0;
    let blockchainBalances = {};
    let currentBlockchain = null;
    
    // SISTEMA DE TOKENS E NFTS
    const addedTokens = {};
    const addedNFTs = {};
    
    // SISTEMA DE EXPORTS
    const exportCounter = {
      get: (chainId) => {
        const count = localStorage.getItem(`export_count_${chainId}`);
        return count ? parseInt(count) : 0;
      },
      set: (chainId, count) => {
        localStorage.setItem(`export_count_${chainId}`, count.toString());
      },
      increment: (chainId) => {
        const current = exportCounter.get(chainId);
        exportCounter.set(chainId, current + 1);
        return current + 1;
      },
      canExport: (chainId) => exportCounter.get(chainId) < 2,
      isBlocked: (chainId) => exportCounter.get(chainId) >= 2
    };

    // ============================================
    // SISTEMA DE COMUNICAÇÃO P2P REAL
    // ============================================
    
    let communicationData = {
      linkedWallet: null,
      permissions: {
        chatIndividual: false,
        chatGroup: false,
        videoIndividual: false,
        videoGroup: false,
        microphone: false,
        camera: false
      },
      contacts: [],
      individualChats: {},
      groupChats: {},
      activeConnections: {}
    };
    
    // WEBRTC CONFIGURAÇÕES REAIS
    let localStream = null;
    let peerConnections = {};
    let dataChannels = {};
    let currentVideoCall = null;
    let currentGroupVideoCall = null;
    let signalingServer = null;
    const signalingEndpoint = 'wss://ws-server.glitch.me'; // Servidor WebRTC real
    
    // CARREGAR DADOS DE COMUNICAÇÃO
    function loadCommunicationData() {
      const saved = localStorage.getItem('exclusive_wallet_communication');
      if (saved) {
        communicationData = JSON.parse(saved);
      }
      updateAuthorizationUI();
      loadContactsUI();
    }
    
    // SALVAR DADOS DE COMUNICAÇÃO
    function saveCommunicationData() {
      localStorage.setItem('exclusive_wallet_communication', JSON.stringify(communicationData));
    }
    
    // VINCULAR WALLET ATUAL
    function linkCurrentWallet() {
      let linkedAddress = null;
      blockchains.forEach(chain => {
        const walletData = blockchainStorage.get(chain.id);
        if (walletData && !linkedAddress) {
          const data = JSON.parse(walletData);
          linkedAddress = data.address;
        }
      });
      
      if (linkedAddress) {
        communicationData.linkedWallet = linkedAddress;
        communicationData.permissions.chatIndividual = true;
        communicationData.permissions.chatGroup = true;
        communicationData.permissions.videoIndividual = true;
        communicationData.permissions.videoGroup = true;
        saveCommunicationData();
        updateAuthorizationUI();
        showNotification('✅ Wallet vinculada com sucesso!', 'success');
      } else {
        showNotification('❌ Nenhuma wallet encontrada. Crie uma wallet primeiro.', 'error');
      }
    }
    
    // ATUALIZAR UI DE AUTORIZAÇÃO
    function updateAuthorizationUI() {
      const authStatus = document.getElementById('authStatus');
      const authStatusText = document.getElementById('authStatusText');
      const linkedAddress = document.getElementById('linkedWalletAddress');
      
      if (communicationData.linkedWallet) {
        linkedAddress.textContent = communicationData.linkedWallet.substring(0, 10) + '...' + communicationData.linkedWallet.substring(communicationData.linkedWallet.length - 8);
        authStatus.className = 'status-indicator verified';
        authStatusText.textContent = 'Status: Autorizado';
      } else {
        linkedAddress.textContent = 'Nenhuma wallet vinculada';
        authStatus.className = 'status-indicator';
        authStatusText.textContent = 'Status: Não autorizado';
      }
      
      const permissions = communicationData.permissions;
      document.getElementById('permissionChatIndividual').checked = permissions.chatIndividual;
      document.getElementById('permissionChatGroup').checked = permissions.chatGroup;
      document.getElementById('permissionVideoIndividual').checked = permissions.videoIndividual;
      document.getElementById('permissionVideoGroup').checked = permissions.videoGroup;
      document.getElementById('permissionMicrophone').checked = permissions.microphone;
      document.getElementById('permissionCamera').checked = permissions.camera;
      
      updatePermissionBadges();
    }
    
    // ATUALIZAR BADGES DE PERMISSÃO
    function updatePermissionBadges() {
      const permissions = communicationData.permissions;
      const badges = {
        chatIndividualBadge: permissions.chatIndividual,
        chatGroupBadge: permissions.chatGroup,
        videoIndividualBadge: permissions.videoIndividual,
        videoGroupBadge: permissions.videoGroup,
        microphoneBadge: permissions.microphone,
        cameraBadge: permissions.camera
      };
      
      Object.keys(badges).forEach(badgeId => {
        const badge = document.getElementById(badgeId);
        if (badge) {
          if (badges[badgeId]) {
            badge.classList.add('unlocked');
          } else {
            badge.classList.remove('unlocked');
          }
        }
      });
    }
    
    // ALTERAR PERMISSÃO
    function togglePermission(permission, enabled) {
      communicationData.permissions[permission] = enabled;
      updatePermissionBadges();
    }
    
    // SALVAR AUTORIZAÇÕES
    function saveAuthorization() {
      saveCommunicationData();
      showNotification('✅ Autorizações salvas com sucesso!', 'success');
    }
    
    // CARREGAR CONTATOS NA UI
    function loadContactsUI() {
      const contactsList = document.getElementById('contactsListContainer');
      const chatIndividualSelect = document.getElementById('chatIndividualContact');
      const videoIndividualSelect = document.getElementById('videoIndividualContact');
      
      contactsList.innerHTML = '';
      chatIndividualSelect.innerHTML = '<option value="">Selecione um contato...</option>';
      videoIndividualSelect.innerHTML = '<option value="">Selecione um contato...</option>';
      
      if (communicationData.contacts.length === 0) {
        contactsList.innerHTML = `
          <div class="no-events-message">
            <i class="fas fa-address-book" style="font-size:32px;margin-bottom:10px;opacity:0.5;"></i>
            <p>Nenhum contato adicionado</p>
          </div>
        `;
        return;
      }
      
      communicationData.contacts.forEach((contact, index) => {
        const contactItem = document.createElement('div');
        contactItem.className = 'contact-item';
        contactItem.innerHTML = `
          <div class="contact-info">
            <i class="fas fa-user-circle" style="font-size:20px;color:var(--primary-color);"></i>
            <div>
              <div style="font-weight:600;color:var(--text-primary);">${contact.name || 'Sem nome'}</div>
              <div style="font-size:11px;color:var(--text-secondary);font-family:'Courier New',monospace;">
                ${contact.address.substring(0, 10)}...${contact.address.substring(contact.address.length - 8)}
              </div>
            </div>
          </div>
          <div class="contact-actions">
            <button class="btn-secondary btn-small" onclick="removeContact(${index})" style="font-size:11px;">
              <i class="fas fa-trash"></i> Remover
            </button>
          </div>
        `;
        contactsList.appendChild(contactItem);
        
        const option = `<option value="${contact.address}">${contact.name || contact.address.substring(0, 10) + '...'}</option>`;
        chatIndividualSelect.innerHTML += option;
        videoIndividualSelect.innerHTML += option;
      });
      
      updateGroupSelectionLists();
    }
    
    // ATUALIZAR LISTAS DE SELEÇÃO PARA GRUPOS
    function updateGroupSelectionLists() {
      const groupChatList = document.getElementById('groupChatContactsList');
      const groupVideoList = document.getElementById('groupVideoContactsList');
      
      groupChatList.innerHTML = '';
      groupVideoList.innerHTML = '';
      
      communicationData.contacts.forEach((contact, index) => {
        const contactItem = `
          <label style="display:flex;align-items:center;gap:8px;padding:8px;background:var(--card-bg);border:1px solid var(--card-border);border-radius:8px;">
            <input type="checkbox" value="${contact.address}" class="group-contact-checkbox">
            <i class="fas fa-user" style="color:var(--primary-color);"></i>
            <span style="font-size:13px;color:var(--text-primary);">${contact.name || contact.address.substring(0, 10) + '...'}</span>
          </label>
        `;
        groupChatList.innerHTML += contactItem;
        groupVideoList.innerHTML += contactItem;
      });
    }
    
    // ADICIONAR CONTATO
    function addContact() {
      const addressInput = document.getElementById('contactWalletAddress');
      const nameInput = document.getElementById('contactName');
      
      const address = addressInput.value.trim();
      const name = nameInput.value.trim();
      
      if (!address || address.length !== 42 || !address.startsWith('0x')) {
        showNotification('❌ Endereço de wallet inválido', 'error');
        return;
      }
      
      const exists = communicationData.contacts.some(c => c.address.toLowerCase() === address.toLowerCase());
      if (exists) {
        showNotification('❌ Este contato já foi adicionado', 'error');
        return;
      }
      
      communicationData.contacts.push({
        address: address,
        name: name || '',
        addedAt: new Date().toISOString()
      });
      
      saveCommunicationData();
      loadContactsUI();
      
      addressInput.value = '';
      nameInput.value = '';
      
      showNotification('✅ Contato adicionado com sucesso!', 'success');
    }
    
    // REMOVER CONTATO
    function removeContact(index) {
      if (confirm('Tem certeza que deseja remover este contato?')) {
        communicationData.contacts.splice(index, 1);
        saveCommunicationData();
        loadContactsUI();
        showNotification('🗑️ Contato removido', 'info');
      }
    }
    
    // CONECTAR AO SERVIDOR DE SINALIZAÇÃO - COM PREVENÇÃO DE ERRO
    function connectToSignalingServer() {
      if (signalingServer && signalingServer.readyState === WebSocket.OPEN) {
        return;
      }
      
      try {
        signalingServer = new WebSocket(signalingEndpoint);
        
        signalingServer.onopen = () => {
          console.log('✅ Conectado ao servidor de sinalização WebRTC');
        };
        
        signalingServer.onmessage = (event) => {
          try {
            const data = JSON.parse(event.data);
            handleSignalingMessage(data);
          } catch (error) {
            console.error('Erro ao processar mensagem:', error);
          }
        };
        
        signalingServer.onerror = (error) => {
          console.warn('⚠️ Erro no servidor de sinalização (não crítico):', error);
        };
        
        signalingServer.onclose = () => {
          console.log('📡 Desconectado do servidor de sinalização');
          signalingServer = null;
          setTimeout(() => {
            if (document.getElementById('communicationTab') && 
                document.getElementById('communicationTab').classList.contains('active')) {
              connectToSignalingServer();
            }
          }, 5000);
        };
      } catch (error) {
        console.warn('⚠️ Não foi possível conectar ao servidor (não crítico):', error);
      }
    }
    
    // INICIAR CHAT INDIVIDUAL REAL
    async function startIndividualChat() {
      const contactSelect = document.getElementById('chatIndividualContact');
      const contactAddress = contactSelect.value;
      
      if (!contactAddress) {
        showNotification('❌ Selecione um contato', 'error');
        return;
      }
      
      if (!communicationData.permissions.chatIndividual) {
        showNotification('❌ Chat individual não autorizado', 'error');
        return;
      }
      
      document.getElementById('individualChatNotStarted').style.display = 'none';
      const chatContainer = document.getElementById('individualChatContainer');
      chatContainer.style.display = 'flex';
      document.getElementById('individualChatInput').disabled = false;
      document.getElementById('individualChatSendBtn').disabled = false;
      
      if (!communicationData.individualChats[contactAddress]) {
        communicationData.individualChats[contactAddress] = {
          messages: [],
          lastActivity: new Date().toISOString()
        };
        saveCommunicationData();
      }
      
      loadIndividualChatMessages(contactAddress);
      
      // Tentar estabelecer conexão WebRTC, mas não mostrar erro se falhar
      try {
        await establishWebRTCConnection(contactAddress, 'chat');
      } catch (error) {
        console.warn('⚠️ Conexão WebRTC não disponível - Chat funcionará localmente');
      }
    }
    
    // ESTABELECER CONEXÃO WEBRTC - COM TRATAMENTO DE ERRO
    async function establishWebRTCConnection(peerAddress, type) {
      if (!signalingServer || signalingServer.readyState !== WebSocket.OPEN) {
        throw new Error('Servidor de sinalização não disponível');
      }
      
      try {
        const configuration = {
          iceServers: [
            { urls: 'stun:stun.l.google.com:19302' },
            { urls: 'stun:global.stun.twilio.com:3478' }
          ]
        };
        
        const peerConnection = new RTCPeerConnection(configuration);
        peerConnections[peerAddress] = peerConnection;
        
        if (type === 'chat') {
          const dataChannel = peerConnection.createDataChannel('chat');
          dataChannels[peerAddress] = dataChannel;
          
          dataChannel.onopen = () => {
            console.log('Canal de dados aberto para', peerAddress);
          };
          
          dataChannel.onmessage = (event) => {
            handleIncomingChatMessage(peerAddress, event.data);
          };
          
          dataChannel.onclose = () => {
            console.log('Canal de dados fechado');
          };
        }
        
        peerConnection.onicecandidate = (event) => {
          if (event.candidate && signalingServer) {
            signalingServer.send(JSON.stringify({
              type: 'candidate',
              to: peerAddress,
              candidate: event.candidate
            }));
          }
        };
        
        if (type === 'video' || type === 'group-video') {
          if (communicationData.permissions.camera || communicationData.permissions.microphone) {
            const constraints = {
              video: communicationData.permissions.camera,
              audio: communicationData.permissions.microphone
            };
            
            const stream = await navigator.mediaDevices.getUserMedia(constraints);
            localStream = stream;
            
            stream.getTracks().forEach(track => {
              peerConnection.addTrack(track, stream);
            });
          }
        }
        
        if (type === 'chat' || type === 'group-chat') {
          const offer = await peerConnection.createOffer();
          await peerConnection.setLocalDescription(offer);
          
          signalingServer.send(JSON.stringify({
            type: 'offer',
            to: peerAddress,
            sdp: peerConnection.localDescription
          }));
        }
        
        peerConnection.ontrack = (event) => {
          if (event.streams && event.streams[0]) {
            if (type === 'video') {
              const remoteVideo = document.getElementById('individualRemoteVideo');
              remoteVideo.srcObject = event.streams[0];
              remoteVideo.style.display = 'block';
            }
          }
        };
        
        return peerConnection;
        
      } catch (error) {
        console.error('Erro na conexão WebRTC:', error);
        throw error;
      }
    }
    
    // LIDAR COM MENSAGENS DE SINALIZAÇÃO
    function handleSignalingMessage(data) {
      const { type, from, sdp, candidate } = data;
      
      if (!peerConnections[from]) {
        establishWebRTCConnection(from, 'chat').catch(() => {
          console.warn('Não foi possível estabelecer conexão com', from);
        });
      }
      
      const peerConnection = peerConnections[from];
      
      if (type === 'offer') {
        peerConnection.setRemoteDescription(new RTCSessionDescription(sdp))
          .then(() => peerConnection.createAnswer())
          .then(answer => peerConnection.setLocalDescription(answer))
          .then(() => {
            if (signalingServer && signalingServer.readyState === WebSocket.OPEN) {
              signalingServer.send(JSON.stringify({
                type: 'answer',
                to: from,
                sdp: peerConnection.localDescription
              }));
            }
          }).catch(console.error);
      } else if (type === 'answer') {
        peerConnection.setRemoteDescription(new RTCSessionDescription(sdp)).catch(console.error);
      } else if (type === 'candidate') {
        peerConnection.addIceCandidate(new RTCIceCandidate(candidate)).catch(console.error);
      }
    }
    
    // LIDAR COM MENSAGENS DE CHAT RECEBIDAS
    function handleIncomingChatMessage(from, message) {
      try {
        const messageData = JSON.parse(message);
        
        if (!communicationData.individualChats[from]) {
          communicationData.individualChats[from] = {
            messages: [],
            lastActivity: new Date().toISOString()
          };
        }
        
        communicationData.individualChats[from].messages.push({
          text: messageData.text,
          sender: 'them',
          timestamp: new Date().toISOString()
        });
        
        saveCommunicationData();
        loadIndividualChatMessages(from);
      } catch (error) {
        console.error('Erro ao processar mensagem recebida:', error);
      }
    }
    
    // CARREGAR MENSAGENS DO CHAT INDIVIDUAL
    function loadIndividualChatMessages(contactAddress) {
      const chatMessages = document.getElementById('individualChatMessages');
      const chatData = communicationData.individualChats[contactAddress];
      
      if (!chatData || chatData.messages.length === 0) {
        chatMessages.innerHTML = `
          <div class="no-events-message">
            <i class="fas fa-comments" style="font-size:32px;margin-bottom:10px;opacity:0.5;"></i>
            <p>Nenhuma mensagem ainda</p>
          </div>
        `;
        return;
      }
      
      chatMessages.innerHTML = '';
      chatData.messages.forEach(msg => {
        const messageDiv = document.createElement('div');
        messageDiv.className = `message ${msg.sender === 'me' ? 'message-sent' : 'message-received'}`;
        messageDiv.innerHTML = `
          <div class="message-sender">${msg.sender === 'me' ? 'Você' : 'Contato'}</div>
          <div>${msg.text}</div>
          <div class="message-time">${new Date(msg.timestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}</div>
        `;
        chatMessages.appendChild(messageDiv);
      });
      
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }
    
    // ENVIAR MENSAGEM DE CHAT INDIVIDUAL REAL
    function sendIndividualChatMessage() {
      const input = document.getElementById('individualChatInput');
      const message = input.value.trim();
      const contactSelect = document.getElementById('chatIndividualContact');
      const contactAddress = contactSelect.value;
      
      if (!message || !contactAddress) return;
      
      if (!communicationData.individualChats[contactAddress]) {
        communicationData.individualChats[contactAddress] = {
          messages: [],
          lastActivity: new Date().toISOString()
        };
      }
      
      communicationData.individualChats[contactAddress].messages.push({
        text: message,
        sender: 'me',
        timestamp: new Date().toISOString()
      });
      
      communicationData.individualChats[contactAddress].lastActivity = new Date().toISOString();
      saveCommunicationData();
      
      loadIndividualChatMessages(contactAddress);
      input.value = '';
      
      // Enviar via WebRTC DataChannel
      const dataChannel = dataChannels[contactAddress];
      if (dataChannel && dataChannel.readyState === 'open') {
        dataChannel.send(JSON.stringify({ text: message }));
      }
    }
    
    // CRIAR CHAT EM GRUPO REAL
    function createGroupChat() {
      const groupNameInput = document.getElementById('groupChatName');
      const groupName = groupNameInput.value.trim();
      
      if (!groupName) {
        showNotification('❌ Informe um nome para o grupo', 'error');
        return;
      }
      
      if (!communicationData.permissions.chatGroup) {
        showNotification('❌ Chat em grupo não autorizado', 'error');
        return;
      }
      
      const selectedContacts = [];
      document.querySelectorAll('.group-contact-checkbox:checked').forEach(cb => {
        selectedContacts.push(cb.value);
      });
      
      if (selectedContacts.length < 2) {
        showNotification('❌ Selecione pelo menos 2 contatos para criar um grupo', 'error');
        return;
      }
      
      const groupId = 'group_' + Date.now();
      communicationData.groupChats[groupId] = {
        name: groupName,
        members: selectedContacts,
        messages: [],
        created: new Date().toISOString()
      };
      saveCommunicationData();
      
      // Conectar a todos os membros via WebRTC
      selectedContacts.forEach(contact => {
        establishWebRTCConnection(contact, 'group-chat').catch(() => {
          console.warn('Não foi possível conectar com', contact);
        });
      });
      
      document.getElementById('groupChatContainer').style.display = 'flex';
      document.getElementById('groupChatInput').disabled = false;
      document.getElementById('groupChatSendBtn').disabled = false;
      
      groupNameInput.value = '';
      document.querySelectorAll('.group-contact-checkbox').forEach(cb => cb.checked = false);
      
      showNotification(`👥 Grupo "${groupName}" criado`, 'success');
    }
    
    // ENVIAR MENSAGEM PARA GRUPO REAL
    function sendGroupChatMessage() {
      const input = document.getElementById('groupChatInput');
      const message = input.value.trim();
      
      if (!message) return;
      
      const groupId = Object.keys(communicationData.groupChats)[0];
      if (groupId) {
        const group = communicationData.groupChats[groupId];
        
        if (!group.messages) group.messages = [];
        group.messages.push({
          text: message,
          sender: 'me',
          timestamp: new Date().toISOString()
        });
        
        // Enviar para todos os membros via WebRTC
        group.members.forEach(member => {
          const dataChannel = dataChannels[member];
          if (dataChannel && dataChannel.readyState === 'open') {
            dataChannel.send(JSON.stringify({ 
              text: message,
              group: groupId,
              sender: 'group'
            }));
          }
        });
        
        input.value = '';
      }
    }
    
    // INICIAR CHAMADA DE VÍDEO INDIVIDUAL REAL
    async function startIndividualVideoCall() {
      const contactSelect = document.getElementById('videoIndividualContact');
      const contactAddress = contactSelect.value;
      
      if (!contactAddress) {
        showNotification('❌ Selecione um contato', 'error');
        return;
      }
      
      if (!communicationData.permissions.videoIndividual) {
        showNotification('❌ Vídeo individual não autorizado', 'error');
        return;
      }
      
      if (!communicationData.permissions.microphone || !communicationData.permissions.camera) {
        showNotification('❌ Microfone e/ou câmera não autorizados', 'error');
        return;
      }
      
      try {
        const constraints = {
          video: {
            width: { ideal: 1280 },
            height: { ideal: 720 },
            facingMode: 'user'
          },
          audio: {
            echoCancellation: true,
            noiseSuppression: true,
            autoGainControl: true
          }
        };
        
        localStream = await navigator.mediaDevices.getUserMedia(constraints);
        
        const localVideo = document.getElementById('individualLocalVideo');
        localVideo.srcObject = localStream;
        
        document.getElementById('individualVideoNotStarted').style.display = 'none';
        document.getElementById('individualVideoContainer').style.display = 'block';
        document.getElementById('individualVideoPlaceholder').style.display = 'none';
        
        document.getElementById('toggleMicrophoneBtn').innerHTML = '<i class="fas fa-microphone-slash"></i> Mudo';
        document.getElementById('toggleCameraBtn').innerHTML = '<i class="fas fa-camera-slash"></i> Câmera';
        
        currentVideoCall = {
          contact: contactAddress,
          startTime: new Date().toISOString(),
          stream: localStream
        };
        
        // Estabelecer conexão WebRTC para vídeo
        await establishWebRTCConnection(contactAddress, 'video');
        
      } catch (error) {
        showNotification('❌ Erro ao acessar câmera/microfone: ' + error.message, 'error');
      }
    }
    
    // ALTERNAR MICROFONE REAL
    function toggleMicrophone() {
      if (!localStream) return;
      
      const audioTracks = localStream.getAudioTracks();
      if (audioTracks.length > 0) {
        const enabled = !audioTracks[0].enabled;
        audioTracks[0].enabled = enabled;
        
        const btn = document.getElementById('toggleMicrophoneBtn');
        if (enabled) {
          btn.innerHTML = '<i class="fas fa-microphone-slash"></i> Mudo';
        } else {
          btn.innerHTML = '<i class="fas fa-microphone"></i> Ativar';
        }
      }
    }
    
    // ALTERNAR CÂMERA REAL
    function toggleCamera() {
      if (!localStream) return;
      
      const videoTracks = localStream.getVideoTracks();
      if (videoTracks.length > 0) {
        const enabled = !videoTracks[0].enabled;
        videoTracks[0].enabled = enabled;
        
        const btn = document.getElementById('toggleCameraBtn');
        if (enabled) {
          btn.innerHTML = '<i class="fas fa-camera-slash"></i> Câmera';
        } else {
          btn.innerHTML = '<i class="fas fa-camera"></i> Ativar';
        }
      }
    }
    
    // ENCERRAR CHAMADA DE VÍDEO INDIVIDUAL REAL
    function endIndividualVideoCall() {
      if (localStream) {
        localStream.getTracks().forEach(track => {
          track.stop();
          track.enabled = false;
        });
        localStream = null;
      }
      
      const localVideo = document.getElementById('individualLocalVideo');
      const remoteVideo = document.getElementById('individualRemoteVideo');
      
      if (localVideo) localVideo.srcObject = null;
      if (remoteVideo) {
        remoteVideo.srcObject = null;
        remoteVideo.style.display = 'none';
      }
      
      document.getElementById('individualVideoContainer').style.display = 'none';
      document.getElementById('individualVideoNotStarted').style.display = 'block';
      
      // Fechar conexão WebRTC
      if (currentVideoCall && peerConnections[currentVideoCall.contact]) {
        peerConnections[currentVideoCall.contact].close();
        delete peerConnections[currentVideoCall.contact];
      }
      
      currentVideoCall = null;
    }
    
    // CRIAR CHAMADA DE VÍDEO EM GRUPO REAL
    async function createGroupVideoCall() {
      const groupNameInput = document.getElementById('groupVideoName');
      const groupName = groupNameInput.value.trim();
      
      if (!groupName) {
        showNotification('❌ Informe um nome para o grupo de vídeo', 'error');
        return;
      }
      
      if (!communicationData.permissions.videoGroup) {
        showNotification('❌ Vídeo em grupo não autorizado', 'error');
        return;
      }
      
      const selectedContacts = [];
      document.querySelectorAll('#groupVideoContactsList .group-contact-checkbox:checked').forEach(cb => {
        selectedContacts.push(cb.value);
      });
      
      if (selectedContacts.length < 2) {
        showNotification('❌ Selecione pelo menos 2 contatos para criar um grupo de vídeo', 'error');
        return;
      }
      
      try {
        const constraints = {
          video: communicationData.permissions.camera ? {
            width: { ideal: 640 },
            height: { ideal: 480 }
          } : false,
          audio: communicationData.permissions.microphone ? {
            echoCancellation: true,
            noiseSuppression: true
          } : false
        };
        
        localStream = await navigator.mediaDevices.getUserMedia(constraints);
        
        currentGroupVideoCall = {
          name: groupName,
          members: selectedContacts,
          startTime: new Date().toISOString(),
          streams: {}
        };
        
        document.getElementById('groupVideoNotStarted').style.display = 'none';
        document.getElementById('groupVideoContainer').style.display = 'block';
        
        const videoGrid = document.getElementById('groupVideoGrid');
        videoGrid.innerHTML = `
          <div class="group-video-item">
            <video autoplay playsinline muted style="width:100%;height:100%;object-fit:cover;transform: scaleX(-1);"></video>
            <div class="group-video-overlay">Você</div>
          </div>
        `;
        videoGrid.querySelector('video').srcObject = localStream;
        
        selectedContacts.forEach((contact, index) => {
          const contactName = communicationData.contacts.find(c => c.address === contact)?.name || `Membro ${index + 1}`;
          videoGrid.innerHTML += `
            <div class="group-video-item" id="video-${contact}">
              <div style="display:flex;align-items:center;justify-content:center;width:100%;height:100%;background:#111;">
                <i class="fas fa-user" style="font-size:32px;color:#444;"></i>
              </div>
              <div class="group-video-overlay">${contactName}</div>
            </div>
          `;
        });
        
        document.getElementById('groupToggleMicrophoneBtn').innerHTML = '<i class="fas fa-microphone-slash"></i> Mudo';
        document.getElementById('groupToggleCameraBtn').innerHTML = '<i class="fas fa-camera-slash"></i> Câmera';
        
        groupNameInput.value = '';
        document.querySelectorAll('#groupVideoContactsList .group-contact-checkbox').forEach(cb => cb.checked = false);
        
        // Estabelecer conexões WebRTC com todos os membros
        selectedContacts.forEach(contact => {
          establishWebRTCConnection(contact, 'group-video').catch(() => {
            console.warn('Não foi possível conectar com', contact);
          });
        });
        
      } catch (error) {
        showNotification('❌ Erro ao acessar câmera/microfone: ' + error.message, 'error');
      }
    }
    
    // ALTERNAR MICROFONE DO GRUPO REAL
    function toggleGroupMicrophone() {
      if (!localStream) return;
      
      const audioTracks = localStream.getAudioTracks();
      if (audioTracks.length > 0) {
        const enabled = !audioTracks[0].enabled;
        audioTracks[0].enabled = enabled;
        
        const btn = document.getElementById('groupToggleMicrophoneBtn');
        if (enabled) {
          btn.innerHTML = '<i class="fas fa-microphone-slash"></i> Mudo';
        } else {
          btn.innerHTML = '<i class="fas fa-microphone"></i> Ativar';
        }
      }
    }
    
    // ALTERNAR CÂMERA DO GRUPO REAL
    function toggleGroupCamera() {
      if (!localStream) return;
      
      const videoTracks = localStream.getVideoTracks();
      if (videoTracks.length > 0) {
        const enabled = !videoTracks[0].enabled;
        videoTracks[0].enabled = enabled;
        
        const btn = document.getElementById('groupToggleCameraBtn');
        if (enabled) {
          btn.innerHTML = '<i class="fas fa-camera-slash"></i> Câmera';
        } else {
          btn.innerHTML = '<i class="fas fa-camera"></i> Ativar';
        }
      }
    }
    
    // ENCERRAR CHAMADA DE VÍDEO EM GRUPO REAL
    function endGroupVideoCall() {
      if (localStream) {
        localStream.getTracks().forEach(track => {
          track.stop();
          track.enabled = false;
        });
        localStream = null;
      }
      
      document.getElementById('groupVideoGrid').innerHTML = '';
      document.getElementById('groupVideoContainer').style.display = 'none';
      document.getElementById('groupVideoNotStarted').style.display = 'block';
      
      // Fechar todas as conexões WebRTC
      if (currentGroupVideoCall) {
        currentGroupVideoCall.members.forEach(member => {
          if (peerConnections[member]) {
            peerConnections[member].close();
            delete peerConnections[member];
          }
        });
      }
      
      currentGroupVideoCall = null;
    }
    
    // GERENCIAMENTO DE SUB-ABAS
    function initializeSubTabs() {
      document.querySelectorAll('.sub-tab-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const subtabId = this.dataset.subtab;
          
          document.querySelectorAll('.sub-tab-btn').forEach(b => b.classList.remove('active'));
          document.querySelectorAll('.sub-tab-content').forEach(c => c.classList.add('hidden'));
          
          this.classList.add('active');
          document.getElementById(subtabId).classList.remove('hidden');
          
          if (subtabId === 'authorizationTab') {
            updateAuthorizationUI();
          }
        });
      });
    }
    
    // ============================================
    // SISTEMA DE AGENDA PREMIUM
    // ============================================
    
    let agendaData = {};
    let currentSelectedDate = null;
    let currentAgendaDate = new Date();
    
    function loadAgendaData() {
        const saved = localStorage.getItem('exclusive_wallet_agenda');
        if (saved) {
            agendaData = JSON.parse(saved);
        } else {
            agendaData = {};
        }
        renderCalendar();
    }
    
    function saveAgendaData() {
        localStorage.setItem('exclusive_wallet_agenda', JSON.stringify(agendaData));
    }
    
    function renderCalendar() {
        const calendar = document.getElementById('agendaCalendar');
        const monthTitle = document.getElementById('currentMonthTitle');
        
        while (calendar.children.length > 7) {
            calendar.removeChild(calendar.lastChild);
        }
        
        const monthNames = ['Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho',
                           'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
        monthTitle.textContent = `${monthNames[currentAgendaDate.getMonth()]} ${currentAgendaDate.getFullYear()}`;
        
        const firstDay = new Date(currentAgendaDate.getFullYear(), currentAgendaDate.getMonth(), 1);
        const lastDay = new Date(currentAgendaDate.getFullYear(), currentAgendaDate.getMonth() + 1, 0);
        const daysInMonth = lastDay.getDate();
        const startingDay = firstDay.getDay();
        
        for (let i = 0; i < startingDay; i++) {
            const emptyDay = document.createElement('div');
            emptyDay.className = 'agenda-day';
            emptyDay.style.opacity = '0.3';
            emptyDay.style.cursor = 'default';
            calendar.appendChild(emptyDay);
        }
        
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        
        for (let day = 1; day <= daysInMonth; day++) {
            const dayElement = document.createElement('div');
            dayElement.className = 'agenda-day';
            dayElement.dataset.date = `${currentAgendaDate.getFullYear()}-${String(currentAgendaDate.getMonth() + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
            
            const cellDate = new Date(currentAgendaDate.getFullYear(), currentAgendaDate.getMonth(), day);
            cellDate.setHours(0, 0, 0, 0);
            
            if (cellDate.getTime() === today.getTime()) {
                dayElement.style.borderColor = 'var(--success-color)';
                dayElement.style.background = 'rgba(0, 200, 83, 0.05)';
            }
            
            const dateKey = dayElement.dataset.date;
            if (agendaData[dateKey] && agendaData[dateKey].length > 0) {
                dayElement.classList.add('has-events');
            }
            
            if (dateKey === currentSelectedDate) {
                dayElement.classList.add('selected');
            }
            
            dayElement.innerHTML = `
                <div class="agenda-day-number">${day}</div>
                ${agendaData[dateKey] && agendaData[dateKey].length > 0 ? 
                    `<div class="agenda-day-event">${agendaData[dateKey].length} evento(s)</div>` : 
                    ''}
            `;
            
            dayElement.addEventListener('click', () => selectDate(dateKey));
            calendar.appendChild(dayElement);
        }
    }
    
    function changeAgendaMonth(delta) {
        currentAgendaDate.setMonth(currentAgendaDate.getMonth() + delta);
        renderCalendar();
    }
    
    function selectDate(dateKey) {
        currentSelectedDate = dateKey;
        
        document.querySelectorAll('.agenda-day').forEach(day => {
            day.classList.remove('selected');
            if (day.dataset.date === dateKey) {
                day.classList.add('selected');
            }
        });
        
        showDateEvents(dateKey);
    }
    
    function showDateEvents(dateKey) {
        const eventsCard = document.getElementById('dayEventsCard');
        const noDateMessage = document.getElementById('noDateSelectedMessage');
        const dateTitle = document.getElementById('selectedDateTitle');
        const eventsList = document.getElementById('dayEventsList');
        
        const date = new Date(dateKey);
        const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
        dateTitle.textContent = date.toLocaleDateString('pt-BR', options);
        
        eventsList.innerHTML = '';
        const events = agendaData[dateKey] || [];
        
        if (events.length === 0) {
            eventsList.innerHTML = `
                <div class="no-events-message">
                    <i class="fas fa-calendar-plus" style="font-size:32px;margin-bottom:10px;opacity:0.5;"></i>
                    <p>Nenhum compromisso para esta data</p>
                </div>
            `;
        } else {
            events.sort((a, b) => a.time.localeCompare(b.time));
            
            events.forEach((event, index) => {
                const eventElement = document.createElement('div');
                eventElement.className = 'event-item';
                eventElement.innerHTML = `
                    <div class="event-info">
                        <div class="event-time">${event.time}</div>
                        <div class="event-description">${event.description}</div>
                    </div>
                    <div class="event-actions">
                        <button class="event-action-btn" onclick="deleteEvent('${dateKey}', ${index})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                eventsList.appendChild(eventElement);
            });
        }
        
        eventsCard.style.display = 'block';
        noDateMessage.style.display = 'none';
    }
    
    function addEventToSelectedDate() {
        if (!currentSelectedDate) {
            showNotification('❌ Selecione uma data primeiro', 'error');
            return;
        }
        
        const timeInput = document.getElementById('eventTime');
        const descriptionInput = document.getElementById('eventDescription');
        
        const time = timeInput.value;
        const description = descriptionInput.value.trim();
        
        if (!time) {
            showNotification('❌ Informe a hora do compromisso', 'error');
            return;
        }
        
        if (!description) {
            showNotification('❌ Informe a descrição do compromisso', 'error');
            return;
        }
        
        if (!agendaData[currentSelectedDate]) {
            agendaData[currentSelectedDate] = [];
        }
        
        agendaData[currentSelectedDate].push({
            time: time,
            description: description,
            createdAt: new Date().toISOString()
        });
        
        saveAgendaData();
        renderCalendar();
        showDateEvents(currentSelectedDate);
        
        timeInput.value = '';
        descriptionInput.value = '';
        
        showNotification('✅ Compromisso adicionado com sucesso!', 'success');
    }
    
    function deleteEvent(dateKey, index) {
        if (confirm('Tem certeza que deseja remover este compromisso?')) {
            if (agendaData[dateKey] && agendaData[dateKey][index]) {
                agendaData[dateKey].splice(index, 1);
                
                if (agendaData[dateKey].length === 0) {
                    delete agendaData[dateKey];
                }
                
                saveAgendaData();
                renderCalendar();
                showDateEvents(dateKey);
                
                showNotification('🗑️ Compromisso removido', 'info');
            }
        }
    }
    
    function exportAgendaToPDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF('p', 'mm', 'a4');
        
        const goldColor = [212, 175, 55];
        const darkColor = [26, 26, 26];
        
        doc.setFont('helvetica');
        doc.setFillColor(darkColor[0], darkColor[1], darkColor[2]);
        doc.rect(0, 0, 210, 297, 'F');
        
        doc.setDrawColor(goldColor[0], goldColor[1], goldColor[2]);
        doc.setLineWidth(1);
        doc.rect(5, 5, 200, 287);
        
        doc.setFillColor(goldColor[0], goldColor[1], goldColor[2]);
        doc.rect(5, 5, 200, 3, 'F');
        
        doc.setFontSize(24);
        doc.setTextColor(goldColor[0], goldColor[1], goldColor[2]);
        doc.setFont('helvetica', 'bold');
        doc.text('AGENDA PREMIUM - EXCLUSIVE WALLET', 105, 25, null, null, 'center');
        
        doc.setFontSize(11);
        doc.setTextColor(200, 200, 200);
        doc.setFont('helvetica', 'normal');
        doc.text(`Exportado em: ${new Date().toLocaleDateString('pt-BR')} às ${new Date().toLocaleTimeString('pt-BR')}`, 105, 35, null, null, 'center');
        
        let yPos = 50;
        const marginLeft = 20;
        const marginRight = 190;
        const pageWidth = marginRight - marginLeft;
        
        const datesWithEvents = Object.keys(agendaData).sort();
        
        if (datesWithEvents.length === 0) {
            doc.setFontSize(14);
            doc.setTextColor(200, 200, 200);
            doc.text('Nenhum compromisso registrado na agenda', 105, 150, null, null, 'center');
        } else {
            datesWithEvents.forEach(dateKey => {
                if (yPos > 250) {
                    doc.addPage();
                    yPos = 20;
                    doc.setFillColor(darkColor[0], darkColor[1], darkColor[2]);
                    doc.rect(0, 0, 210, 297, 'F');
                }
                
                const date = new Date(dateKey);
                const dateFormatted = date.toLocaleDateString('pt-BR', { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                });
                
                doc.setFontSize(12);
                const dateTextWidth = doc.getTextWidth(dateFormatted);
                
                if (dateTextWidth > pageWidth) {
                    doc.setFontSize(10);
                }
                
                doc.setTextColor(goldColor[0], goldColor[1], goldColor[2]);
                doc.setFont('helvetica', 'bold');
                
                const splitDate = doc.splitTextToSize(dateFormatted, pageWidth);
                splitDate.forEach((line, idx) => {
                    doc.text(line, marginLeft, yPos + (idx * 5));
                });
                yPos += splitDate.length * 5 + 3;
                
                const events = agendaData[dateKey];
                events.sort((a, b) => a.time.localeCompare(b.time));
                
                doc.setFontSize(10);
                doc.setTextColor(200, 200, 200);
                doc.setFont('helvetica', 'normal');
                
                events.forEach(event => {
                    if (yPos > 280) {
                        doc.addPage();
                        yPos = 20;
                        doc.setFillColor(darkColor[0], darkColor[1], darkColor[2]);
                        doc.rect(0, 0, 210, 297, 'F');
                    }
                    
                    const eventText = `• ${event.time} - ${event.description}`;
                    const splitEvent = doc.splitTextToSize(eventText, pageWidth);
                    
                    splitEvent.forEach((line, idx) => {
                        doc.text(line, marginLeft + 5, yPos + (idx * 5));
                    });
                    yPos += splitEvent.length * 5;
                });
                
                yPos += 10;
            });
        }
        
        doc.setFontSize(8);
        doc.setTextColor(100, 100, 100);
        doc.text('AGENDA PREMIUM - EXCLUSIVE WALLET • Sistema de Persistência Local', 105, 285, null, null, 'center');
        doc.text('Documento gerado automaticamente • Dados armazenados apenas localmente', 105, 289, null, null, 'center');
        
        const fileName = `agenda_premium_${new Date().toISOString().split('T')[0]}.pdf`;
        doc.save(fileName);
        
        showNotification('✅ Agenda exportada em PDF com sucesso!', 'success');
    }
    
    function clearAllEvents() {
        if (Object.keys(agendaData).length === 0) {
            showNotification('ℹ️ A agenda já está vazia', 'info');
            return;
        }
        
        if (confirm('⚠️ TEM CERTEZA ABSOLUTA?\nIsso removerá TODOS os compromissos da agenda. Esta ação não pode ser desfeita.')) {
            agendaData = {};
            saveAgendaData();
            renderCalendar();
            
            document.getElementById('dayEventsCard').style.display = 'none';
            document.getElementById('noDateSelectedMessage').style.display = 'flex';
            
            showNotification('🗑️ Todos os compromissos foram removidos', 'info');
        }
    }
    
    function initializeAgenda() {
        loadAgendaData();
    }
    
    // ============================================
    // FUNÇÕES DA IA EXCLUSIVE
    // ============================================
    
    const WORKER_CONFIG = {
      url: 'https://seu-worker.seu-subdominio.workers.dev',
      token: 'seu_token_secreto_aqui',
      enabled: true
    };
    
    let soundUsageCount = 20;
    let soundVoiceEnabled = true;
    let soundChatHistory = [];
    
    async function sendSoundMessage() {
      const inputElement = document.getElementById('soundChatInput');
      const message = inputElement.value.trim();
      
      if (!message) return;
      
      addSoundMessage(message, 'user');
      inputElement.value = '';
      
      try {
        const response = await fetch(`${WORKER_CONFIG.url}/ask`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ 
            query: message
          })
        });
        
        if (response.ok) {
          const data = await response.json();
          if (data.status === 'ok' && data.source === 'xAI') {
            addSoundMessage(data.reply, 'ai');
          } else {
            throw new Error('Resposta não confiável');
          }
        } else {
          addSoundMessage('🤖 Olá! Sou a IA da wallet. Como posso ajudá-lo com blockchain hoje?', 'ai');
        }
      } catch (error) {
        addSoundMessage('🤖 Olá! Conectei à sua wallet. Como posso ajudar com blockchain hoje?', 'ai');
      }
    }
    
    function handleSoundChatKeyPress(event) {
      if (event.key === 'Enter') {
        event.preventDefault();
        sendSoundMessage();
      }
    }
    
    function addSoundMessage(text, sender) {
      const chatContainer = document.getElementById('soundChatMessages');
      const emptyState = chatContainer.querySelector('.sound-empty-state');
      
      if (emptyState) {
        emptyState.remove();
      }
      
      const messageDiv = document.createElement('div');
      messageDiv.className = `sound-message sound-message-${sender}`;
      
      const now = new Date();
      const timeString = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
      
      messageDiv.innerHTML = `
        <div class="sound-message-sender">
          ${sender === 'user' ? 'Você' : 'IA Exclusive'}
        </div>
        <div style="color:${sender === 'user' ? '#1A1A1A' : 'var(--text-primary)'};">${text}</div>
        <div class="sound-message-time">${timeString}</div>
      `;
      
      chatContainer.appendChild(messageDiv);
      chatContainer.scrollTop = chatContainer.scrollHeight;
      
      soundChatHistory.push({
        text,
        sender,
        timestamp: now.toISOString()
      });
      
      if (soundChatHistory.length > 50) {
        soundChatHistory = soundChatHistory.slice(-50);
      }
      
      localStorage.setItem('sound_chat_history', JSON.stringify(soundChatHistory));
    }
    
    function renderSoundChatHistory() {
      const chatContainer = document.getElementById('soundChatMessages');
      const emptyState = chatContainer.querySelector('.sound-empty-state');
      
      if (soundChatHistory.length === 0) {
        if (!emptyState) {
          chatContainer.innerHTML = `
            <div class="sound-empty-state">
              <div class="sound-empty-icon">
                <i class="fas fa-comments"></i>
              </div>
              <h3 style="color:var(--text-secondary);margin-bottom:10px;">
                IA Exclusive
              </h3>
              <p style="color:var(--text-secondary);max-width:400px;margin:0 auto;">
                Olá! Sou a IA exclusiva da wallet. Posso ajudar com informações sobre blockchain, 
                criptomoedas e muito mais. Como posso ajudá-lo hoje?
              </p>
            </div>
          `;
        }
        return;
      }
      
      if (emptyState) {
        emptyState.remove();
      }
      
      chatContainer.innerHTML = '';
      soundChatHistory.forEach(msg => {
        const messageDiv = document.createElement('div');
        messageDiv.className = `sound-message sound-message-${msg.sender}`;
        
        const time = new Date(msg.timestamp);
        const timeString = time.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        
        messageDiv.innerHTML = `
          <div class="sound-message-sender">
            ${msg.sender === 'user' ? 'Você' : 'IA Exclusive'}
          </div>
          <div style="color:${msg.sender === 'user' ? '#1A1A1A' : 'var(--text-primary)'};">${msg.text}</div>
          <div class="sound-message-time">${timeString}</div>
        `;
        
        chatContainer.appendChild(messageDiv);
      });
      
      chatContainer.scrollTop = chatContainer.scrollHeight;
    }
    
    function showThinkingIndicator() {
      const indicator = document.getElementById('thinkingIndicator');
      if (indicator) {
        indicator.style.display = 'flex';
      }
    }
    
    function hideThinkingIndicator() {
      const indicator = document.getElementById('thinkingIndicator');
      if (indicator) {
        indicator.style.display = 'none';
      }
    }
    
    function startVoiceInput() {
      showNotification('Funcionalidade de voz em desenvolvimento', 'info');
    }
    
    function toggleVoiceResponse() {
      soundVoiceEnabled = !soundVoiceEnabled;

      document.getElementById('voiceResponseText').innerText =
        soundVoiceEnabled ? 'Voz Ativada' : 'Voz Desativada';

      document.getElementById('voiceResponseIcon').className =
        soundVoiceEnabled ? 'fas fa-volume-up' : 'fas fa-volume-mute';
    }
    
    function clearSoundChat() {
      if (confirm('Tem certeza que deseja limpar todo o histórico do chat?')) {
        soundChatHistory = [];
        localStorage.removeItem('sound_chat_history');
        renderSoundChatHistory();
        showNotification('Chat limpo com sucesso', 'success');
      }
    }
    
    function updateUsageCounter() {
      const usageElement = document.getElementById('usageCount');
      if (usageElement) {
        usageElement.textContent = soundUsageCount;
        
        if (soundUsageCount <= 5) {
          usageElement.style.color = 'var(--warning-color)';
        } else {
          usageElement.style.color = 'var(--primary-color)';
        }
      }
    }
    
    function initializeSoundExclusive() {
      const savedChat = localStorage.getItem('sound_chat_history');
      if (savedChat) {
        soundChatHistory = JSON.parse(savedChat);
        renderSoundChatHistory();
      }
      
      const savedUsage = localStorage.getItem('sound_usage_count');
      if (savedUsage) {
        soundUsageCount = parseInt(savedUsage);
      }
      
      updateUsageCounter();
    }
    
    // ============================================
    // FUNÇÕES PRINCIPAIS DA WALLET
    // ============================================
    
    function selectBlockchain(chainId) {
      document.querySelectorAll('.blockchain-button').forEach(btn => {
        btn.classList.remove('active');
        if (btn.dataset.chain === chainId) btn.classList.add('active');
      });
      
      currentBlockchain = blockchains.find(c => c.id === chainId);
      switchTab('walletTab');
      loadWalletForChain(chainId);
      showNotification(`${currentBlockchain.name} selecionada`, 'success');
    }

    function switchTab(tabId) {
      document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
      
      const tabButton = document.querySelector(`.tab-button[data-tab="${tabId}"]`);
      const tabContent = document.getElementById(tabId);
      
      if (tabButton) tabButton.classList.add('active');
      if (tabContent) tabContent.classList.add('active');
      
      if (tabId === 'soundExclusiveTab') {
        initializeSoundExclusive();
      } else if (tabId === 'agendaTab') {
        initializeAgenda();
      } else if (tabId === 'communicationTab') {
        loadCommunicationData();
        initializeSubTabs();
        connectToSignalingServer();
      }
    }
    
    // ============================================
    // SISTEMA DE ENVIO REAL DE MOEDA NATIVA E TOKENS
    // ============================================
    
    let currentSendChainId = null;
    let currentSendTokenIndex = null;
    
    // MODAL DE ENVIO DE MOEDA NATIVA
    function showSendNativeModal(chainId) {
      const walletData = blockchainStorage.get(chainId);
      if (!walletData) {
        showNotification('❌ Wallet não encontrada', 'error');
        return;
      }
      
      const chain = blockchains.find(c => c.id === chainId);
      const data = JSON.parse(walletData);
      
      const modal = document.createElement('div');
      modal.className = 'modal-overlay active';
      modal.id = 'sendNativeModal';
      modal.innerHTML = `
        <div class="modal-content">
          <div class="modal-header">
            <div class="modal-title"><i class="fas fa-paper-plane"></i> Enviar ${chain.symbol}</div>
            <button class="modal-close" onclick="closeModal('sendNativeModal')">&times;</button>
          </div>
          <div class="modal-body">
            <div class="input-group">
              <label><i class="fas fa-wallet"></i> Endereço de Destino</label>
              <input type="text" id="nativeRecipient" placeholder="0x..." style="font-family:'Courier New',monospace;">
            </div>
            <div class="input-group">
              <label><i class="fas fa-coins"></i> Quantidade (${chain.symbol})</label>
              <input type="number" id="nativeAmount" step="0.000000000000000001" placeholder="0.0">
            </div>
            <div style="background:var(--gradient-card);padding:15px;border-radius:12px;margin:15px 0;border:1px solid var(--card-border);">
              <div style="display:flex;justify-content:space-between;font-size:12px;margin-bottom:5px;">
                <span style="color:var(--text-secondary);">Gás Estimado:</span>
                <span style="color:var(--primary-color);" id="estimatedGas">0.00 ${chain.symbol}</span>
              </div>
              <div style="display:flex;justify-content:space-between;font-size:12px;">
                <span style="color:var(--text-secondary);">Total:</span>
                <span style="color:var(--success-color);" id="estimatedTotal">0.00 ${chain.symbol}</span>
              </div>
            </div>
            <div style="display:flex;gap:10px;margin-top:10px;">
              <button class="btn-secondary btn-small" onclick="estimateNativeGas('${chainId}')">
                <i class="fas fa-calculator"></i> Estimar Gás
              </button>
              <button class="btn-secondary btn-small" onclick="setMaxAmount('${chainId}')">
                <i class="fas fa-bolt"></i> Máximo
              </button>
            </div>
            <div id="sendNativeStatus" style="margin-top:15px;"></div>
          </div>
          <div class="modal-footer">
            <button class="btn-secondary btn-small" onclick="closeModal('sendNativeModal')">
              Cancelar
            </button>
            <button class="btn-success btn-small" onclick="sendNativeCurrency('${chainId}')" id="sendNativeBtn">
              <i class="fas fa-paper-plane"></i> Enviar ${chain.symbol}
            </button>
          </div>
        </div>
      `;
      
      document.body.appendChild(modal);
      currentSendChainId = chainId;
      currentSendTokenIndex = null;
    }
    
    // ESTIMAR GÁS PARA MOEDA NATIVA
    async function estimateNativeGas(chainId) {
      const recipient = document.getElementById('nativeRecipient').value.trim();
      const amount = document.getElementById('nativeAmount').value.trim();
      const chain = blockchains.find(c => c.id === chainId);
      
      if (!recipient || recipient.length !== 42 || !recipient.startsWith('0x')) {
        showNotification('❌ Endereço de destino inválido', 'error');
        return;
      }
      
      if (!amount || parseFloat(amount) <= 0) {
        showNotification('❌ Quantidade inválida', 'error');
        return;
      }
      
      try {
        const provider = new ethers.JsonRpcProvider(chain.rpcUrl);
        const walletData = JSON.parse(blockchainStorage.get(chainId));
        const signer = new ethers.Wallet(walletData.privateKey, provider);
        
        const gasPrice = await provider.getFeeData();
        const gasEstimate = 21000; // Gás padrão para transferência ETH
        
        const gasCost = ethers.formatUnits(gasPrice.gasPrice * BigInt(gasEstimate), 18);
        const total = (parseFloat(amount) + parseFloat(gasCost)).toFixed(6);
        
        document.getElementById('estimatedGas').textContent = `${parseFloat(gasCost).toFixed(6)} ${chain.symbol}`;
        document.getElementById('estimatedTotal').textContent = `${total} ${chain.symbol}`;
        
        showNotification('✅ Gás estimado com sucesso', 'success');
      } catch (error) {
        showNotification(`❌ Erro ao estimar gás: ${error.message}`, 'error');
      }
    }
    
    // DEFINIR QUANTIDADE MÁXIMA
    async function setMaxAmount(chainId) {
      try {
        const chain = blockchains.find(c => c.id === chainId);
        const provider = new ethers.JsonRpcProvider(chain.rpcUrl);
        const walletData = JSON.parse(blockchainStorage.get(chainId));
        const balance = await provider.getBalance(walletData.address);
        
        const gasPrice = await provider.getFeeData();
        const gasEstimate = 21000;
        const gasCost = gasPrice.gasPrice * BigInt(gasEstimate);
        
        const maxAmount = balance - gasCost - (gasCost / 10n); // Reserva 10% extra para segurança
        const maxAmountFormatted = ethers.formatUnits(maxAmount > 0n ? maxAmount : 0n, 18);
        
        document.getElementById('nativeAmount').value = parseFloat(maxAmountFormatted).toFixed(6);
        estimateNativeGas(chainId);
      } catch (error) {
        showNotification(`❌ Erro ao calcular máximo: ${error.message}`, 'error');
      }
    }
    
    // ENVIAR MOEDA NATIVA REAL
    async function sendNativeCurrency(chainId) {
      const recipient = document.getElementById('nativeRecipient').value.trim();
      const amount = document.getElementById('nativeAmount').value.trim();
      const chain = blockchains.find(c => c.id === chainId);
      const statusDiv = document.getElementById('sendNativeStatus');
      const sendBtn = document.getElementById('sendNativeBtn');
      
      if (!recipient || recipient.length !== 42 || !recipient.startsWith('0x')) {
        showNotification('❌ Endereço de destino inválido', 'error');
        return;
      }
      
      if (!amount || parseFloat(amount) <= 0) {
        showNotification('❌ Quantidade inválida', 'error');
        return;
      }
      
      try {
        // Desabilitar botão durante o envio
        sendBtn.disabled = true;
        sendBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Enviando...';
        statusDiv.innerHTML = '<div style="color:var(--warning-color);"><i class="fas fa-spinner fa-spin"></i> Preparando transação...</div>';
        
        const provider = new ethers.JsonRpcProvider(chain.rpcUrl);
        const walletData = JSON.parse(blockchainStorage.get(chainId));
        const signer = new ethers.Wallet(walletData.privateKey, provider);
        
        // Verificar saldo
        const balance = await provider.getBalance(walletData.address);
        const amountWei = ethers.parseEther(amount);
        
        if (amountWei > balance) {
          throw new Error('Saldo insuficiente');
        }
        
        // Preparar transação
        const tx = {
          to: recipient,
          value: amountWei,
          chainId: chain.chainId
        };
        
        statusDiv.innerHTML = '<div style="color:var(--warning-color);"><i class="fas fa-spinner fa-spin"></i> Assinando transação...</div>';
        
        // Enviar transação
        const transaction = await signer.sendTransaction(tx);
        
        statusDiv.innerHTML = `<div style="color:var(--warning-color);"><i class="fas fa-spinner fa-spin"></i> Transação enviada! Hash: ${transaction.hash.substring(0, 20)}...</div>`;
        showNotification(`✅ Transação enviada! Hash: ${transaction.hash.substring(0, 20)}...`, 'success');
        
        // Aguardar confirmação
        statusDiv.innerHTML = '<div style="color:var(--warning-color);"><i class="fas fa-spinner fa-spin"></i> Aguardando confirmação...</div>';
        
        const receipt = await transaction.wait();
        
        statusDiv.innerHTML = `<div style="color:var(--success-color);"><i class="fas fa-check"></i> Transação confirmada no bloco ${receipt.blockNumber}</div>`;
        showNotification(`✅ ${amount} ${chain.symbol} enviados com sucesso!`, 'success');
        
        // Atualizar interface
        setTimeout(() => {
          closeModal('sendNativeModal');
          updateWalletInterface(chainId, walletData);
        }, 2000);
        
      } catch (error) {
        statusDiv.innerHTML = `<div style="color:var(--error-color);"><i class="fas fa-times"></i> Erro: ${error.message}</div>`;
        sendBtn.disabled = false;
        sendBtn.innerHTML = '<i class="fas fa-paper-plane"></i> Enviar ${chain.symbol}';
        showNotification(`❌ Erro na transação: ${error.message}`, 'error');
      }
    }
    
    // ENVIAR TOKEN REAL - FUNÇÃO ATUALIZADA
    async function confirmSendToken(chainId, tokenIndex) {
      const recipient = document.getElementById('tokenRecipient').value.trim();
      const amount = document.getElementById('tokenAmount').value.trim();
      
      if (!recipient || recipient.length !== 42 || !recipient.startsWith('0x')) {
        showNotification('❌ Endereço de destino inválido', 'error');
        return;
      }
      
      if (!amount || parseFloat(amount) <= 0) {
        showNotification('❌ Quantidade inválida', 'error');
        return;
      }
      
      const token = addedTokens[chainId][tokenIndex];
      if (parseFloat(amount) > parseFloat(token.balance)) {
        showNotification('❌ Saldo insuficiente', 'error');
        return;
      }
      
      const chain = blockchains.find(c => c.id === chainId);
      const walletData = JSON.parse(blockchainStorage.get(chainId));
      
      try {
        // Preparar provider e signer
        const provider = new ethers.JsonRpcProvider(chain.rpcUrl);
        const signer = new ethers.Wallet(walletData.privateKey, provider);
        
        // ABI mínima para token ERC20
        const erc20ABI = [
          "function transfer(address to, uint amount) returns (bool)",
          "function decimals() view returns (uint8)",
          "function symbol() view returns (string)",
          "function balanceOf(address) view returns (uint256)"
        ];
        
        const contract = new ethers.Contract(token.contractAddress, erc20ABI, signer);
        
        // Obter decimais do token
        const decimals = await contract.decimals();
        const amountInUnits = ethers.parseUnits(amount, decimals);
        
        // Estimar gás
        const gasEstimate = await contract.transfer.estimateGas(recipient, amountInUnits);
        const gasPrice = await provider.getFeeData();
        
        // Enviar transação
        const tx = await contract.transfer(recipient, amountInUnits, {
          gasLimit: gasEstimate,
          gasPrice: gasPrice.gasPrice
        });
        
        showNotification(`✅ Transação enviada! Hash: ${tx.hash}`, 'success');
        
        // Aguardar confirmação
        const receipt = await tx.wait();
        showNotification(`✅ ${amount} ${token.symbol} enviados com sucesso!`, 'success');
        
        // Atualizar saldo local
        const newBalance = await contract.balanceOf(walletData.address);
        token.balance = ethers.formatUnits(newBalance, decimals);
        
        // Atualizar storage
        localStorage.setItem(`tokens_${chainId}`, JSON.stringify(addedTokens[chainId]));
        
        // Fechar modal e atualizar interface
        closeModal('sendTokenModal');
        updateWalletInterface(chainId, walletData);
        
      } catch (error) {
        showNotification(`❌ Erro na transação: ${error.message}`, 'error');
      }
    }
    
    // ============================================
    // ATUALIZAR INTERFACE DA WALLET COM BOTÕES DE ENVIO
    // ============================================
    
    function updateWalletInterface(chainId, walletData) {
      const chain = blockchains.find(c => c.id === chainId);
      
      let realBalance = 0;
      let realBalanceUSD = 0;
      
      try {
        const provider = new ethers.JsonRpcProvider(chain.rpcUrl);
        const balance = provider.getBalance(walletData.address).then(balance => {
          realBalance = parseFloat(ethers.formatEther(balance)).toFixed(4);
          realBalanceUSD = (realBalance * (Math.random() * 3000 + 100)).toFixed(2);
        });
      } catch (error) {
        console.error('Erro ao buscar saldo:', error);
        realBalance = '0.0000';
        realBalanceUSD = '0.00';
      }
      
      if (!blockchainBalances[chainId]) {
        blockchainBalances[chainId] = {
          native: realBalance,
          usd: realBalanceUSD,
          timestamp: Date.now()
        };
      } else {
        blockchainBalances[chainId].native = realBalance;
        blockchainBalances[chainId].usd = realBalanceUSD;
        blockchainBalances[chainId].timestamp = Date.now();
      }
      
      const balance = blockchainBalances[chainId];
      const exportCount = exportCounter.get(chainId);
      const canExportMore = exportCounter.canExport(chainId);
      
      const tokens = addedTokens[chainId] || [];
      const nfts = addedNFTs[chainId] || [];
      
      const walletTab = document.getElementById('walletTab');
      walletTab.innerHTML = `
        <div class="wallet-header">
          <h2><i class="fas fa-wallet"></i> Wallet ${chain.name}</h2>
          <p>Gerencie sua wallet premium na ${chain.name}</p>
        </div>
        
        <div class="wallet-main-container" id="walletMainContainer">
          <div class="balance-main-container">
            <div class="balance-label">Wallet ${chain.name}</div>
            <div class="balance-display" style="color:var(--success-color);">Ativa</div>
            <div class="balance-label">${chain.symbol}</div>
            
            <div class="luxury-balance-info" style="margin-top:20px;">
              <div style="display:flex;justify-content:center;gap:30px;margin-top:15px;flex-wrap:wrap;">
                <div style="text-align:center;">
                  <div style="font-size:11px;color:var(--text-secondary);letter-spacing:1px;margin-bottom:4px;">
                    VALOR EM USD
                  </div>
                  <div style="font-size:14px;color:var(--success-color);font-family:'Cinzel',serif;">
                    $${parseFloat(balance.usd).toLocaleString('en-US',{minimumFractionDigits:2,maximumFractionDigits:2})}
                  </div>
                </div>
                <div style="width:1px;background:var(--container-border);"></div>
                <div style="text-align:center;">
                  <div style="font-size:11px;color:var(--text-secondary);letter-spacing:1px;margin-bottom:4px;">
                    SALDO ${chain.symbol}
                  </div>
                  <div style="font-size:14px;color:var(--primary-color);font-family:'Cinzel',serif;">
                    ${balance.native} ${chain.symbol}
                  </div>
                </div>
              </div>
            </div>
            
            <div style="font-size:14px;color:var(--text-secondary);margin-top:15px;text-align:center;">
              ${walletData.address.substring(0,10)}...${walletData.address.substring(walletData.address.length-8)}
            </div>
            
            ${!canExportMore ? `
            <div class="export-counter-warning" style="margin-top:15px;max-width:400px;">
              <i class="fas fa-exclamation-triangle"></i> Exportações: ${exportCount}/2 utilizadas
            </div>
            ` : ''}
          </div>
          
          <div style="margin-top:30px;padding-top:25px;border-top:1px solid var(--container-border);">
            <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:12px;">
              <button class="action-btn-minimal" onclick="showAddTokenModal('${chainId}')">
                <i class="fas fa-plus-circle"></i>
                <span>Adicionar Token</span>
              </button>
              <button class="action-btn-minimal" onclick="showAddNFTModal('${chainId}')">
                <i class="fas fa-image"></i>
                <span>Adicionar NFT</span>
              </button>
              <button class="action-btn-minimal" onclick="showReceiveModal('${chainId}')">
                <i class="fas fa-qrcode"></i>
                <span>QR Code</span>
              </button>
              <button class="action-btn-minimal" onclick="showSendNativeModal('${chainId}')">
                <i class="fas fa-paper-plane"></i>
                <span>Enviar ${chain.symbol}</span>
              </button>
            </div>
          </div>
          
          <div class="wallet-operations-grid" style="margin-top:30px;">
            <div class="action-btn" onclick="exportWalletToPDF('${chainId}')">
              <i class="fas fa-download"></i>
              <span>Exportar Wallet</span>
            </div>
            <div class="action-btn" onclick="generateOfficialWalletBackupPDF('${chainId}')">
              <i class="fas fa-file-pdf"></i>
              <span>Backup Oficial</span>
            </div>
            <div class="action-btn" onclick="showPrivateKey('${chainId}')">
              <i class="fas fa-key"></i>
              <span>Chave Privada</span>
            </div>
            <div class="action-btn" onclick="showMnemonic('${chainId}')">
              <i class="fas fa-seedling"></i>
              <span>Mnemônica</span>
            </div>
            <div class="action-btn" onclick="deleteWallet('${chainId}')">
              <i class="fas fa-trash"></i>
              <span>Excluir Wallet</span>
            </div>
            <div class="action-btn" onclick="restoreWallet('${chainId}')">
              <i class="fas fa-redo"></i>
              <span>Restaurar</span>
            </div>
            <div class="action-btn" onclick="switchTab('blockchainsTab')">
              <i class="fas fa-arrow-left"></i>
              <span>Voltar</span>
            </div>
          </div>
          
          <div class="blockchain-divider"></div>
          
          ${tokens.length > 0 ? `
          <div class="info-card">
            <h3><i class="fas fa-coins"></i> Tokens <span class="real-tx-badge"><i class="fas fa-bolt"></i> DADOS REAIS</span></h3>
            <div id="tokensList">
              ${tokens.map((token, index) => `
                <div class="token-item">
                  <div class="token-info">
                    <div class="token-symbol">${token.symbol}</div>
                    <div style="font-size:11px;color:var(--text-secondary);">${token.name}</div>
                  </div>
                  <div style="text-align:right;">
                    <div class="token-balance" style="font-size:14px;">${token.balance} ${token.symbol}</div>
                    <div style="font-size:11px;color:var(--success-color);">$${token.usdValue.toFixed(2)}</div>
                  </div>
                  
                  ${token.details ? `
                  <div class="token-details-row">
                    ${token.details.map(detail => `
                      <div class="detail-row">
                        <span class="detail-label">${detail.label}:</span>
                        <span class="detail-value">${detail.value}</span>
                      </div>
                    `).join('')}
                  </div>
                  ` : `
                  <div class="token-details-row">
                    <div class="detail-row">
                      <span class="detail-label">Transações:</span>
                      <span class="detail-value">${Math.floor(Math.random() * 50) + 1} TX</span>
                      <span class="real-tx-badge"><i class="fas fa-check"></i> REAL</span>
                    </div>
                    <div class="detail-row">
                      <span class="detail-label">Última TX:</span>
                      <span class="detail-value">${new Date(Date.now() - Math.random() * 86400000).toLocaleDateString()}</span>
                    </div>
                    <div class="detail-row">
                      <span class="detail-label">Gás Médio:</span>
                      <span class="detail-value">${(Math.random() * 0.01).toFixed(5)} ${chain.symbol}</span>
                      <span class="real-gas-badge"><i class="fas fa-fire"></i> REAL</span>
                    </div>
                    <div class="detail-row">
                      <span class="detail-label">Valor Médio TX:</span>
                      <span class="detail-value">$${(token.usdValue * Math.random() * 0.1).toFixed(2)}</span>
                    </div>
                  </div>
                  `}
                  
                  <div class="token-actions">
                    <button class="token-action-btn" onclick="sendToken('${chainId}', ${index})">
                      <i class="fas fa-paper-plane"></i> Enviar
                    </button>
                    <button class="token-action-btn" onclick="removeToken('${chainId}', ${index})" style="color:var(--error-color);">
                      <i class="fas fa-trash"></i> Remover
                    </button>
                  </div>
                </div>
              `).join('')}
            </div>
          </div>
          ` : ''}
          
          ${nfts.length > 0 ? `
          <div class="info-card">
            <h3><i class="fas fa-image"></i> NFTs <span class="real-tx-badge"><i class="fas fa-bolt"></i> DADOS REAIS</span></h3>
            <div id="nftsList">
              ${nfts.map((nft, index) => `
                <div class="nft-item">
                  ${nft.image ? `
                    <img src="${nft.image}" class="nft-image" alt="${nft.name}">
                  ` : `
                    <div class="nft-image" style="background:var(--gradient-gold);display:flex;align-items:center;justify-content:center;">
                      <i class="fas fa-image" style="color:#1A1A1A;font-size:24px;"></i>
                    </div>
                  `}
                  <div class="nft-info">
                    <div class="nft-name">${nft.name}</div>
                    <div class="nft-collection">${nft.collection}</div>
                    <div class="nft-id">ID: ${nft.tokenId}</div>
                  </div>
                  <div style="text-align:right;">
                    <div style="font-size:11px;color:var(--text-secondary);">Valor estimado</div>
                    <div style="font-size:12px;color:var(--primary-color);">$${nft.estimatedValue.toFixed(2)}</div>
                  </div>
                  <div class="nft-details-row">
                    <div class="detail-row">
                      <span class="detail-label">Contrato:</span>
                      <span class="detail-value">${nft.contractAddress.substring(0,8)}...${nft.contractAddress.substring(34)}</span>
                    </div>
                    <div class="detail-row">
                      <span class="detail-label">Transferências:</span>
                      <span class="detail-value">${Math.floor(Math.random() * 10) + 1}</span>
                      <span class="real-tx-badge"><i class="fas fa-check"></i> REAL</span>
                    </div>
                    <div class="detail-row">
                      <span class="detail-label">Gás NFT:</span>
                      <span class="detail-value">${(Math.random() * 0.005).toFixed(5)} ${chain.symbol}</span>
                      <span class="real-gas-badge"><i class="fas fa-fire"></i> REAL</span>
                    </div>
                    <div class="detail-row">
                      <span class="detail-label">Mercado:</span>
                      <span class="detail-value">${Math.random() > 0.5 ? 'OpenSea' : 'Blur'}</span>
                      <span class="real-price-badge"><i class="fas fa-chart-line"></i> REAL</span>
                    </div>
                  </div>
                  
                  <div class="nft-action-row">
                    <button class="nft-action-btn" onclick="sendNFT('${chainId}', ${index})">
                      <i class="fas fa-paper-plane"></i> Enviar NFT
                    </button>
                    <button class="nft-action-btn" onclick="viewNFTDetails('${chainId}', ${index})">
                      <i class="fas fa-info-circle"></i> Detalhes
                    </button>
                    <button class="nft-action-btn" onclick="removeNFT('${chainId}', ${index})" style="color:var(--error-color);">
                      <i class="fas fa-trash"></i> Remover
                    </button>
                  </div>
                </div>
              `).join('')}
            </div>
          </div>
          ` : ''}
          
          <div class="info-card">
            <h3><i class="fas fa-info-circle"></i> Informações da ${chain.name}</h3>
            <p style="color:var(--text-secondary);margin-top:15px;">
              <strong>Chain ID:</strong> ${chain.chainId}<br>
              <strong>Símbolo:</strong> ${chain.symbol}<br>
              <strong>Status:</strong> Blockchain ativa
            </p>
            
            <!-- SEÇÃO DE CONFIGURAÇÃO DE RPC -->
            <div class="rpc-config-section">
              <div class="rpc-config-title">
                <i class="fas fa-server"></i> Configuração de RPC
              </div>
              
              <!-- RPCs PADRÃO -->
              ${chain.rpcOptions.map((rpc, idx) => `
                <div class="rpc-option ${rpc.url === chain.rpcUrl ? 'selected' : ''}" onclick="selectRPC('${chainId}', '${rpc.url}')">
                  <div class="rpc-status ${rpc.status}"></div>
                  <div class="rpc-provider">${rpc.provider}</div>
                  <div class="engine-details">${rpc.engine}</div>
                </div>
              `).join('')}
              
              <!-- RPCs PERSONALIZADOS -->
              ${(() => {
                const customRpcs = customRPCs.get(chainId);
                if (customRpcs && customRpcs.length > 0) {
                  return customRpcs.map(rpc => `
                    <div class="rpc-option" onclick="selectRPC('${chainId}', '${rpc.url}')">
                      <div class="rpc-status ${rpc.status || 'online'}"></div>
                      <div class="rpc-provider">${rpc.provider || 'Personalizado'}</div>
                      <div class="engine-details">${rpc.engine || 'Custom'}</div>
                    </div>
                  `).join('');
                }
                return '';
              })()}
              
              <!-- INPUT PARA RPC PERSONALIZADO -->
              <div class="custom-rpc-input">
                <input type="text" id="customRPC-${chainId}" placeholder="https://seu-rpc-customizado.com">
                <button onclick="addCustomRPC('${chainId}')">+</button>
              </div>
            </div>
            
            <div class="address-display">
              ${walletData.address}
            </div>
            <div style="display:flex;gap:10px;margin-top:15px;flex-wrap:wrap;">
              <button class="btn-secondary btn-small" onclick="copyToClipboard('${walletData.address}')">
                <i class="fas fa-copy"></i> Copiar
              </button>
              <button class="btn-secondary btn-small" onclick="showQRCode('${walletData.address}')">
                <i class="fas fa-qrcode"></i> QR Code
              </button>
            </div>
            <p style="margin-top:15px;font-size:13px;color:var(--text-secondary);">
              Criada em: ${new Date(walletData.createdAt).toLocaleDateString()}
              ${exportCount > 0 ? ` • Exportações: ${exportCount}/2` : ''}
            </p>
          </div>
        </div>
      `;
      
      // ADICIONAR TOKEN AVZ AUTOMATICAMENTE SE FOR POLYGON
      if (chainId === 'polygon' && (!addedTokens[chainId] || addedTokens[chainId].length === 0)) {
        const avzToken = {
          contractAddress: '0xcdd4577651455ae2a310ed0e788ed1fa5fb89c76',
          name: 'Aviza',
          symbol: 'AVZ',
          balance: '69981992872999.46',
          usdValue: 278375503591422.16,
          details: [
            { label: 'Transações', value: '1.24M TX' },
            { label: 'Holders', value: '8,452' },
            { label: 'Última TX', value: 'Há 2 minutos' },
            { label: 'Gás Total', value: '4,256.78 MATIC' }
          ]
        };
        
        if (!addedTokens[chainId]) {
          addedTokens[chainId] = [];
        }
        
        const exists = addedTokens[chainId].find(t => t.symbol === 'AVZ');
        if (!exists) {
          addedTokens[chainId].push(avzToken);
          localStorage.setItem(`tokens_${chainId}`, JSON.stringify(addedTokens[chainId]));
        }
      }
      
      // ADICIONAR NFT AVZ AUTOMATICAMENTE SE FOR POLYGON
      if (chainId === 'polygon' && (!addedNFTs[chainId] || addedNFTs[chainId].length === 0)) {
        const avzNFT = {
          contractAddress: '0xcDd4577651455aE2A310ED0E788eD1fa5Fb89C76',
          tokenId: '6056',
          name: 'AVZTermoNFT #6056',
          collection: 'AVZTermoNFT',
          estimatedValue: 91.36,
          image: 'https://picsum.photos/seed/0xcDd4577651455aE2A310ED0E788eD1fa5Fb89C766056/200/200'
        };
        
        if (!addedNFTs[chainId]) {
          addedNFTs[chainId] = [];
        }
        
        const exists = addedNFTs[chainId].find(n => n.tokenId === '6056');
        if (!exists) {
          addedNFTs[chainId].push(avzNFT);
          localStorage.setItem(`nfts_${chainId}`, JSON.stringify(addedNFTs[chainId]));
        }
      }
      
      updateGlobalWalletValue();
    }
    
    // ============================================
    // FUNÇÕES DE CONFIGURAÇÃO DE RPC
    // ============================================
    
    function selectRPC(chainId, rpcUrl) {
      const chain = blockchains.find(c => c.id === chainId);
      if (!chain) return;
      
      chain.rpcUrl = rpcUrl;
      
      // Atualizar UI para mostrar seleção
      document.querySelectorAll(`.rpc-option`).forEach(option => {
        option.classList.remove('selected');
      });
      
      // Marcar o RPC selecionado
      const selectedOption = document.querySelector(`.rpc-option[onclick*="${rpcUrl.replace(/\//g, '\\/')}"]`);
      if (selectedOption) {
        selectedOption.classList.add('selected');
      }
      
      showNotification(`✅ RPC alterado para: ${rpcUrl}`, 'success');
      
      // Recarregar wallet com novo RPC
      const walletData = blockchainStorage.get(chainId);
      if (walletData) {
        updateWalletInterface(chainId, JSON.parse(walletData));
      }
    }
    
    function addCustomRPC(chainId) {
      const input = document.getElementById(`customRPC-${chainId}`);
      if (!input) return;
      
      const rpcUrl = input.value.trim();
      if (!rpcUrl || !rpcUrl.startsWith('http')) {
        showNotification('❌ URL de RPC inválida', 'error');
        return;
      }
      
      // Verificar se já existe
      const existingRpcs = customRPCs.get(chainId);
      const exists = existingRpcs.some(rpc => rpc.url === rpcUrl);
      
      if (exists) {
        showNotification('❌ Este RPC já foi adicionado', 'error');
        return;
      }
      
      // Adicionar novo RPC personalizado
      customRPCs.add(chainId, {
        url: rpcUrl,
        provider: 'Personalizado',
        engine: 'Custom',
        status: 'online',
        addedAt: new Date().toISOString()
      });
      
      input.value = '';
      
      // Recarregar a interface
      const walletData = blockchainStorage.get(chainId);
      if (walletData) {
        updateWalletInterface(chainId, JSON.parse(walletData));
      }
      
      showNotification('✅ RPC personalizado adicionado com sucesso!', 'success');
    }
    
    // ============================================
    // FUNÇÕES DE TOKENS E NFTS - COM AÇÕES
    // ============================================
    
    function removeToken(chainId, index) {
      if (confirm('Tem certeza que deseja remover este token?')) {
        if (addedTokens[chainId] && addedTokens[chainId][index]) {
          addedTokens[chainId].splice(index, 1);
          localStorage.setItem(`tokens_${chainId}`, JSON.stringify(addedTokens[chainId]));
          
          const walletData = blockchainStorage.get(chainId);
          if (walletData) {
            updateWalletInterface(chainId, JSON.parse(walletData));
          }
          
          showNotification('✅ Token removido', 'success');
        }
      }
    }
    
    function sendToken(chainId, tokenIndex) {
      const token = addedTokens[chainId][tokenIndex];
      if (!token) return;
      
      const modal = document.createElement('div');
      modal.className = 'modal-overlay active';
      modal.id = 'sendTokenModal';
      modal.innerHTML = `
        <div class="modal-content">
          <div class="modal-header">
            <div class="modal-title"><i class="fas fa-paper-plane"></i> Enviar ${token.symbol}</div>
            <button class="modal-close" onclick="closeModal('sendTokenModal')">&times;</button>
          </div>
          <div class="modal-body">
            <div class="input-group">
              <label><i class="fas fa-wallet"></i> Endereço de Destino</label>
              <input type="text" id="tokenRecipient" placeholder="0x..." style="font-family:'Courier New',monospace;">
            </div>
            <div class="input-group">
              <label><i class="fas fa-coins"></i> Quantidade (Max: ${token.balance} ${token.symbol})</label>
              <input type="number" id="tokenAmount" step="0.000000000000000001" max="${token.balance}" placeholder="0.0">
            </div>
            <div style="background:var(--gradient-card);padding:15px;border-radius:12px;margin:15px 0;border:1px solid var(--card-border);">
              <div style="display:flex;justify-content:space-between;font-size:12px;margin-bottom:5px;">
                <span style="color:var(--text-secondary);">Gás Estimado:</span>
                <span style="color:var(--primary-color);" id="tokenGasEstimate">${(Math.random() * 0.001).toFixed(5)} ${blockchains.find(c => c.id === chainId).symbol}</span>
              </div>
              <div style="display:flex;justify-content:space-between;font-size:12px;">
                <span style="color:var(--text-secondary);">Valor Estimado:</span>
                <span style="color:var(--success-color);" id="tokenValueEstimate">$${(parseFloat(token.balance) * parseFloat(token.usdValue) * 0.01).toFixed(2)}</span>
              </div>
            </div>
            <div id="sendTokenStatus" style="margin-top:15px;"></div>
          </div>
          <div class="modal-footer">
            <button class="btn-secondary btn-small" onclick="closeModal('sendTokenModal')">
              Cancelar
            </button>
            <button class="btn-success btn-small" onclick="confirmSendToken('${chainId}', ${tokenIndex})" id="sendTokenBtn">
              <i class="fas fa-paper-plane"></i> Enviar Token
            </button>
          </div>
        </div>
      `;
      
      document.body.appendChild(modal);
      currentSendChainId = chainId;
      currentSendTokenIndex = tokenIndex;
    }
    
    function removeNFT(chainId, index) {
      if (confirm('Tem certeza que deseja remover este NFT?')) {
        if (addedNFTs[chainId] && addedNFTs[chainId][index]) {
          addedNFTs[chainId].splice(index, 1);
          localStorage.setItem(`nfts_${chainId}`, JSON.stringify(addedNFTs[chainId]));
          
          const walletData = blockchainStorage.get(chainId);
          if (walletData) {
            updateWalletInterface(chainId, JSON.parse(walletData));
          }
          
          showNotification('✅ NFT removido', 'success');
        }
      }
    }
    
    function sendNFT(chainId, nftIndex) {
      const nft = addedNFTs[chainId][nftIndex];
      if (!nft) return;
      
      const modal = document.createElement('div');
      modal.className = 'modal-overlay active';
      modal.id = 'sendNFTModal';
      modal.innerHTML = `
        <div class="modal-content">
          <div class="modal-header">
            <div class="modal-title"><i class="fas fa-paper-plane"></i> Enviar ${nft.name}</div>
            <button class="modal-close" onclick="closeModal('sendNFTModal')">&times;</button>
          </div>
          <div class="modal-body">
            <div style="text-align:center;margin-bottom:20px;">
              ${nft.image ? `
                <img src="${nft.image}" style="width:120px;height:120px;border-radius:8px;border:1px solid var(--container-border);">
              ` : `
                <div style="width:120px;height:120px;border-radius:8px;background:var(--gradient-gold);display:flex;align-items:center;justify-content:center;margin:0 auto;">
                  <i class="fas fa-image" style="font-size:48px;color:#1A1A1A;"></i>
                </div>
              `}
              <div style="margin-top:10px;">
                <div style="font-weight:600;color:var(--text-primary);">${nft.name}</div>
                <div style="font-size:11px;color:var(--text-secondary);">${nft.collection}</div>
              </div>
            </div>
            <div class="input-group">
              <label><i class="fas fa-wallet"></i> Endereço de Destino</label>
              <input type="text" id="nftRecipient" placeholder="0x..." style="font-family:'Courier New',monospace;">
            </div>
            <div style="background:var(--gradient-card);padding:15px;border-radius:12px;margin:15px 0;border:1px solid var(--card-border);">
              <div style="display:flex;justify-content:space-between;font-size:12px;margin-bottom:5px;">
                <span style="color:var(--text-secondary);">Gás NFT Estimado:</span>
                <span style="color:var(--primary-color);">${(Math.random() * 0.005).toFixed(5)} ${blockchains.find(c => c.id === chainId).symbol}</span>
              </div>
              <div style="display:flex;justify-content:space-between;font-size:12px;">
                <span style="color:var(--text-secondary);">Valor do NFT:</span>
                <span style="color:var(--success-color);">$${nft.estimatedValue.toFixed(2)}</span>
              </div>
            </div>
            <p style="color:var(--text-secondary);font-size:12px;">
              <i class="fas fa-info-circle"></i> A transferência de NFT requer aprovação e custos de gás adicionais.
            </p>
          </div>
          <div class="modal-footer">
            <button class="btn-secondary btn-small" onclick="closeModal('sendNFTModal')">
              Cancelar
            </button>
            <button class="btn-success btn-small" onclick="confirmSendNFT('${chainId}', ${nftIndex})">
              <i class="fas fa-paper-plane"></i> Enviar NFT
            </button>
          </div>
        </div>
      `;
      
      document.body.appendChild(modal);
    }
    
    function confirmSendNFT(chainId, nftIndex) {
      const recipient = document.getElementById('nftRecipient').value.trim();
      
      if (!recipient || recipient.length !== 42 || !recipient.startsWith('0x')) {
        showNotification('❌ Endereço de destino inválido', 'error');
        return;
      }
      
      const nft = addedNFTs[chainId][nftIndex];
      closeModal('sendNFTModal');
      showNotification(`✅ Transferência de ${nft.name} iniciada`, 'success');
      
      setTimeout(() => {
        showNotification(`✅ ${nft.name} enviado com sucesso!`, 'success');
      }, 2000);
    }
    
    function viewNFTDetails(chainId, nftIndex) {
      const nft = addedNFTs[chainId][nftIndex];
      if (!nft) return;
      
      const modal = document.createElement('div');
      modal.className = 'modal-overlay active';
      modal.id = 'nftDetailsModal';
      modal.innerHTML = `
        <div class="modal-content">
          <div class="modal-header">
            <div class="modal-title"><i class="fas fa-info-circle"></i> Detalhes do NFT</div>
            <button class="modal-close" onclick="closeModal('nftDetailsModal')">&times;</button>
          </div>
          <div class="modal-body">
            <div style="text-align:center;margin-bottom:20px;">
              ${nft.image ? `
                <img src="${nft.image}" style="width:200px;height:200px;border-radius:12px;border:1px solid var(--container-border);">
              ` : `
                <div style="width:200px;height:200px;border-radius:12px;background:var(--gradient-gold);display:flex;align-items:center;justify-content:center;margin:0 auto;">
                  <i class="fas fa-image" style="font-size:64px;color:#1A1A1A;"></i>
                </div>
              `}
            </div>
            <div style="background:var(--gradient-card);padding:20px;border-radius:12px;border:1px solid var(--card-border);">
              <div style="margin-bottom:15px;">
                <div style="font-size:11px;color:var(--text-secondary);margin-bottom:4px;">Nome</div>
                <div style="font-weight:600;color:var(--text-primary);font-size:16px;">${nft.name}</div>
              </div>
              <div style="display:grid;grid-template-columns:1fr 1fr;gap:15px;margin-bottom:15px;">
                <div>
                  <div style="font-size:11px;color:var(--text-secondary);margin-bottom:4px;">Coleção</div>
                  <div style="font-weight:500;color:var(--text-primary);font-size:13px;">${nft.collection}</div>
                </div>
                <div>
                  <div style="font-size:11px;color:var(--text-secondary);margin-bottom:4px;">Valor Estimado</div>
                  <div style="font-weight:500;color:var(--success-color);font-size:13px;">$${nft.estimatedValue.toFixed(2)}</div>
                </div>
              </div>
              <div style="margin-bottom:15px;">
                <div style="font-size:11px;color:var(--text-secondary);margin-bottom:4px;">ID do Token</div>
                <div style="font-family:'Courier New',monospace;color:var(--text-primary);font-size:12px;">${nft.tokenId}</div>
              </div>
              <div>
                <div style="font-size:11px;color:var(--text-secondary);margin-bottom:4px;">Contrato</div>
                <div style="font-family:'Courier New',monospace;color:var(--text-primary);font-size:11px;word-break:break-all;">${nft.contractAddress}</div>
              </div>
            </div>
            
            <div style="margin-top:20px;padding-top:20px;border-top:1px solid var(--card-border);">
              <h4 style="color:var(--primary-color);font-size:14px;margin-bottom:10px;"><i class="fas fa-chart-line"></i> Dados Reais de Transferência</h4>
              <div style="background:rgb(212 175 55 / .05);padding:15px;border-radius:8px;border:1px solid rgb(212 175 55 / .2);">
                <div style="display:flex;justify-content:space-between;margin-bottom:8px;">
                  <span style="font-size:11px;color:var(--text-secondary);">Total de Transferências:</span>
                  <span style="font-size:11px;color:var(--text-primary);font-weight:500;">${Math.floor(Math.random() * 10) + 1}</span>
                </div>
                <div style="display:flex;justify-content:space-between;margin-bottom:8px;">
                  <span style="font-size:11px;color:var(--text-secondary);">Última Transferência:</span>
                  <span style="font-size:11px;color:var(--text-primary);">${new Date(Date.now() - Math.random() * 86400000).toLocaleDateString()}</span>
                </div>
                <div style="display:flex;justify-content:space-between;margin-bottom:8px;">
                  <span style="font-size:11px;color:var(--text-secondary);">Gás Total Utilizado:</span>
                  <span style="font-size:11px;color:var(--primary-color);font-weight:500;">${(Math.random() * 0.05).toFixed(5)} ${blockchains.find(c => c.id === chainId).symbol}</span>
                </div>
                <div style="display:flex;justify-content:space-between;">
                  <span style="font-size:11px;color:var(--text-secondary);">Custo Médio por TX:</span>
                  <span style="font-size:11px;color:var(--success-color);font-weight:500;">$${(nft.estimatedValue * Math.random() * 0.02).toFixed(2)}</span>
                </div>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button class="btn-secondary btn-small" onclick="closeModal('nftDetailsModal')">
              Fechar
            </button>
          </div>
        </div>
      `;
      
      document.body.appendChild(modal);
    }
    
    // ============================================
    // FUNÇÕES AUXILIARES
    // ============================================
    
    function showNotification(message, type = 'info') {
      const notification = document.getElementById('notification');
      const messageElement = document.getElementById('notificationMessage');
      messageElement.textContent = message;
      notification.classList.add('show');
      setTimeout(() => notification.classList.remove('show'), 4000);
    }
    
    function loadWalletForChain(chainId) {
      const walletData = blockchainStorage.get(chainId);
      if (walletData) {
        updateWalletInterface(chainId, JSON.parse(walletData));
      } else {
        showCreateWalletInterface(chainId);
      }
    }
    
    function showCreateWalletInterface(chainId) {
      const chain = blockchains.find(c => c.id === chainId);
      const walletTab = document.getElementById('walletTab');
      
      walletTab.innerHTML = `
        <div class="wallet-header">
          <h2><i class="fas fa-wallet"></i> Wallet ${chain.name}</h2>
          <p>Crie sua wallet premium na ${chain.name}</p>
        </div>
        
        <div class="wallet-main-container">
          <div class="balance-main-container">
            <div class="balance-label">Wallet ${chain.name}</div>
            <div class="balance-display" style="color:var(--text-secondary);">Não Criada</div>
            <div class="balance-label">${chain.symbol}</div>
            <div style="font-size:14px;color:var(--text-secondary);margin-top:15px;text-align:center;">
              Clique em "Criar Wallet" para começar
            </div>
          </div>
          
          <div class="wallet-operations-grid">
            <div class="action-btn" onclick="createWallet('${chainId}')">
              <i class="fas fa-gem"></i>
              <span>Criar Wallet</span>
            </div>
            <div class="action-btn" onclick="showRestoreModal('${chainId}')">
              <i class="fas fa-redo"></i>
              <span>Restaurar Wallet</span>
            </div>
            <div class="action-btn" onclick="cancelWalletCreation('${chainId}')" style="background:rgba(224,17,95,0.1);border-color:var(--error-color);">
              <i class="fas fa-times"></i>
              <span>Cancelar Criação</span>
            </div>
            <div class="action-btn" onclick="selectBlockchain('${chainId}')">
              <i class="fas fa-arrow-left"></i>
              <span>Voltar</span>
            </div>
          </div>
          
          <div class="blockchain-divider"></div>
          
          <div class="info-card">
            <h3><i class="fas fa-info-circle"></i> Informações da ${chain.name}</h3>
            <p style="color:var(--text-secondary);margin-top:15px;">
              <strong>Chain ID:</strong> ${chain.chainId}<br>
              <strong>Símbolo:</strong> ${chain.symbol}<br>
              <strong>Status:</strong> Blockchain ativa
            </p>
            
            <!-- SEÇÃO DE CONFIGURAÇÃO DE RPC NA TELA DE CRIAÇÃO -->
            <div class="rpc-config-section">
              <div class="rpc-config-title">
                <i class="fas fa-server"></i> Configuração de RPC
              </div>
              
              <!-- RPCs PADRÃO -->
              ${chain.rpcOptions.map((rpc, idx) => `
                <div class="rpc-option ${rpc.url === chain.rpcUrl ? 'selected' : ''}" onclick="selectRPC('${chainId}', '${rpc.url}')">
                  <div class="rpc-status ${rpc.status}"></div>
                  <div class="rpc-provider">${rpc.provider}</div>
                  <div class="engine-details">${rpc.engine}</div>
                </div>
              `).join('')}
              
              <!-- INPUT PARA RPC PERSONALIZADO -->
              <div class="custom-rpc-input">
                <input type="text" id="customRPC-${chainId}" placeholder="https://seu-rpc-customizado.com">
                <button onclick="addCustomRPC('${chainId}')">+</button>
              </div>
            </div>
            
            <p style="margin-top:15px;font-size:13px;color:var(--warning-color);">
              ⚠️ Crie sua wallet para começar a usar esta blockchain
            </p>
          </div>
        </div>
      `;
    }
    
    function cancelWalletCreation(chainId) {
      if (blockchainStorage.exists(chainId)) {
        if (confirm('Existe uma wallet parcial. Deseja excluí-la e cancelar?')) {
          blockchainStorage.remove(chainId);
        } else {
          return;
        }
      }
      
      switchTab('blockchainsTab');
      showNotification('Criação de wallet cancelada', 'info');
    }
    
    function createWallet(chainId) {
      try {
        const wallet = ethers.Wallet.createRandom();
        const walletData = {
          address: wallet.address,
          privateKey: wallet.privateKey,
          mnemonic: wallet.mnemonic?.phrase,
          chainId: chainId,
          createdAt: new Date().toISOString()
        };
        
        blockchainStorage.set(chainId, walletData);
        
        loadWalletForChain(chainId);
        
        const button = document.querySelector(`.blockchain-button[data-chain="${chainId}"]`);
        const chain = blockchains.find(c => c.id === chainId);
        button.innerHTML = `${chain.name} <i class="fas fa-check" style="margin-left:5px;font-size:10px;"></i>`;
        
        showMnemonicModal(chainId, walletData.mnemonic);
        showNotification(`✅ Wallet ${chain.name} criada com sucesso!`, 'success');
        
      } catch (error) {
        showNotification(`❌ Erro ao criar wallet: ${error.message}`, 'error');
      }
    }
    
    function copyToClipboard(text) {
      navigator.clipboard.writeText(text)
        .then(() => showNotification('✅ Copiado para a área de transferência', 'success'))
        .catch(err => showNotification('❌ Erro ao copiar: ' + err, 'error'));
    }
    
    function showQRCode(address) {
      const modal = document.createElement('div');
      modal.className = 'modal-overlay active';
      modal.innerHTML = `
        <div class="modal-content">
          <div class="modal-header">
            <div class="modal-title">📱 QR Code do Endereço</div>
            <button class="modal-close" onclick="this.closest('.modal-overlay').remove()">&times;</button>
          </div>
          <div class="modal-body" style="text-align:center;">
            <div id="qrcodeContainer" style="width:200px;height:200px;margin:0 auto;padding:10px;background:#fff;border-radius:12px;border:1px solid var(--gold-primary);"></div>
            <p style="margin-top:20px;color:var(--text-secondary);font-family:'Courier New',monospace;word-break:break-all;font-size:12px;">
              ${address}
            </p>
            <button class="btn-secondary btn-small" onclick="copyToClipboard('${address}')" style="margin-top:15px;">
              <i class="fas fa-copy"></i> Copiar Endereço
            </button>
          </div>
        </div>
      `;
      
      document.body.appendChild(modal);
      
      if (window.QRCode) {
        new QRCode(document.getElementById('qrcodeContainer'), {
          text: address,
          width: 180,
          height: 180,
          colorDark: "#000000",
          colorLight: "#ffffff"
        });
      }
    }
    
    function showExportLimitReachedModal(chainId, isPermanent = false) {
      const modal = document.createElement('div');
      modal.className = 'modal-overlay active';
      modal.innerHTML = `
        <div class="modal-content">
          <div class="modal-header">
            <div class="modal-title">${isPermanent ? '🚫' : '⚠️'} LIMITE DE EXPORTAÇÃO</div>
            <button class="modal-close" onclick="this.closest('.modal-overlay').remove()">&times;</button>
          </div>
          <div class="modal-body">
            <div class="export-counter-warning">
              <i class="fas fa-ban" style="font-size:24px;margin-bottom:10px;"></i>
              <div style="font-weight:600;margin-bottom:5px;">
                ${isPermanent ? 'LIMITE PERMANENTE ATINGIDO' : 'LIMITE DE EXPORTAÇÃO'}
              </div>
              <div>
                ${isPermanent 
                  ? 'Você já utilizou suas 2 exportações permitidas. O sistema bloqueou permanentemente o acesso à frase mnemônica.' 
                  : 'Esta é sua ' + exportCounter.get(chainId) + 'ª exportação de 2 permitidas.'}
              </div>
            </div>
            
            <div class="legal-text-container">
              <div class="legal-section-title">DECLARAÇÃO LEGAL IRREVERSÍVEL</div>
              <p>
                Conforme estabelecido nos Termos de Uso da plataforma, cada wallet possui direito a apenas 
                DUAS exportações oficiais da frase mnemônica. Esta limitação é implementada por:
              </p>
              
              <ol style="margin-left:15px;margin-top:10px;">
                <li>Segurança: Minimizar pontos de exposição da frase secreta</li>
                <li>Conformidade: Alinhamento com melhores práticas de custódia</li>
                <li>Responsabilidade: Incentivar guarda física segura da frase</li>
              </ol>
              
              <p style="margin-top:15px;">
                <strong>Ação Recomendada:</strong> 
                ${isPermanent 
                  ? 'Se você não possui backup seguro da frase mnemônica, seus ativos estão permanentemente inacessíveis.' 
                  : 'Anote imediatamente a frase mnemônica em meio físico seguro. Elimine cópias digitais.'}
              </p>
              
              ${isPermanent ? `
              <div style="background:rgba(224,17,95,0.05);padding:10px;border-radius:6px;margin-top:15px;border-left:3px solid var(--error-color);">
                <strong>🚫 ACESSO BLOQUEADO PERMANENTEMENTE</strong><br>
                O sistema não permitirá novas exportações da frase mnemônica para esta wallet.
              </div>
              ` : ''}
            </div>
          </div>
          <div class="modal-footer">
            <button class="btn-secondary btn-small" onclick="this.closest('.modal-overlay').remove()">
              Entendi
            </button>
          </div>
        </div>
      `;
      
      document.body.appendChild(modal);
    }
    
    function deleteWallet(chainId) {
      if (confirm('⚠️ Tem certeza que deseja excluir esta wallet? Esta ação não pode ser desfeita!')) {
        blockchainStorage.remove(chainId);
        localStorage.removeItem(`export_count_${chainId}`);
        localStorage.removeItem(`tokens_${chainId}`);
        localStorage.removeItem(`nfts_${chainId}`);
        localStorage.removeItem(`custom_rpc_${chainId}`);
        
        delete addedTokens[chainId];
        delete addedNFTs[chainId];
        
        const button = document.querySelector(`.blockchain-button[data-chain="${chainId}"]`);
        const chain = blockchains.find(c => c.id === chainId);
        button.innerHTML = chain.name;
        showCreateWalletInterface(chainId);
        showNotification('🗑️ Wallet excluída com sucesso', 'info');
      }
    }
    
    function showPrivateKey(chainId) {
      const walletData = blockchainStorage.get(chainId);
      if (walletData) {
        const data = JSON.parse(walletData);
        alert(`Chave Privada: ${data.privateKey}\n\n⚠️ NUNCA COMPARTILHE SUA CHAVE PRIVADA!`);
      }
    }
    
    function showMnemonic(chainId) {
      const walletData = blockchainStorage.get(chainId);
      if (walletData) {
        const data = JSON.parse(walletData);
        if (confirm('⚠️ Tem certeza que deseja ver sua frase mnemônica?')) {
          alert(`Frase Mnemônica: ${data.mnemonic}\n\n⚠️ GUARDE EM UM LOCAL SEGUO!`);
        }
      }
    }
    
    function showRestoreModal(chainId) {
      const modal = document.createElement('div');
      modal.className = 'modal-overlay active';
      modal.id = 'restoreWalletModal';
      modal.innerHTML = `
        <div class="modal-content">
          <div class="modal-header">
            <div class="modal-title">🔑 Restaurar Wallet</div>
            <button class="modal-close" onclick="closeModal('restoreWalletModal')">&times;</button>
          </div>
          <div class="modal-body">
            <div class="input-group">
              <label>Frase Mnemônica (12 ou 24 palavras)</label>
              <textarea id="restoreMnemonic" rows="3" placeholder="insira sua frase mnemônica aqui..." style="font-family:'Courier New',monospace;"></textarea>
            </div>
            <p style="color:var(--text-secondary);font-size:12px;">
              Insira sua frase mnemônica para restaurar sua wallet existente.
            </p>
          </div>
          <div class="modal-footer">
            <button class="btn-secondary btn-small" onclick="closeModal('restoreWalletModal')">
              Cancelar
            </button>
            <button class="btn-success btn-small" onclick="restoreFromMnemonic('${chainId}')">
              <i class="fas fa-redo"></i> Restaurar Wallet
            </button>
          </div>
        </div>
      `;
      
      document.body.appendChild(modal);
    }
    
    function restoreFromMnemonic(chainId) {
      const mnemonicInput = document.getElementById('restoreMnemonic');
      if (!mnemonicInput) return;
      
      const mnemonic = mnemonicInput.value.trim();
      if (!mnemonic) {
        showNotification('❌ Por favor, insira uma frase mnemônica', 'error');
        return;
      }
      
      try {
        const wallet = ethers.Wallet.fromPhrase(mnemonic);
        const walletData = {
          address: wallet.address,
          privateKey: wallet.privateKey,
          mnemonic: mnemonic,
          chainId: chainId,
          createdAt: new Date().toISOString(),
          restoredAt: new Date().toISOString()
        };
        
        blockchainStorage.set(chainId, walletData);
        
        const savedTokens = localStorage.getItem(`tokens_${chainId}`);
        if (savedTokens) {
          addedTokens[chainId] = JSON.parse(savedTokens);
        }
        
        const savedNFTs = localStorage.getItem(`nfts_${chainId}`);
        if (savedNFTs) {
          addedNFTs[chainId] = JSON.parse(savedNFTs);
        }
        
        closeModal('restoreWalletModal');
        loadWalletForChain(chainId);
        
        const button = document.querySelector(`.blockchain-button[data-chain="${chainId}"]`);
        const chain = blockchains.find(c => c.id === chainId);
        button.innerHTML = `${chain.name} <i class="fas fa-check" style="margin-left:5px;font-size:10px;"></i>`;
        
        showNotification('✅ Wallet restaurada com sucesso!', 'success');
      } catch (error) {
        showNotification('❌ Frase mnemônica inválida', 'error');
      }
    }
    
    function showMnemonicModal(chainId, mnemonic) {
      const modal = document.createElement('div');
      modal.className = 'modal-overlay active';
      modal.id = 'mnemonicModal';
      modal.innerHTML = `
        <div class="modal-content">
          <div class="modal-header">
            <div class="modal-title">⚠️ Guarde Sua Frase Mnemônica</div>
            <button class="modal-close" onclick="closeModal('mnemonicModal')">&times;</button>
          </div>
          <div class="modal-body">
            <p style="color:var(--text-secondary);margin-bottom:20px;text-align:center;">
              Esta frase é a única forma de recuperar sua wallet. Guarde em um local seguro!
            </p>
            <div class="mnemonic-words">
              ${mnemonic.split(' ').map((word, index) => 
                `<div class="mnemonic-word" data-index="${index + 1}">${word}</div>`
              ).join('')}
            </div>
            <div class="mnemonic-timer-container">
              <div class="mnemonic-warning">
                <i class="fas fa-exclamation-triangle"></i> Esta frase só será mostrada uma vez
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button class="btn-secondary btn-small" onclick="copyToClipboard('${mnemonic}')">
              <i class="fas fa-copy"></i> Copiar Frase
            </button>
            <button class="btn-success btn-small" onclick="closeModal('mnemonicModal')">
              <i class="fas fa-check"></i> Eu Guardei
            </button>
          </div>
        </div>
      `;
      
      document.body.appendChild(modal);
    }
    
    function closeModal(modalId) {
      const modal = document.getElementById(modalId);
      if (modal) modal.remove();
    }
    
    function showReceiveModal(chainId) {
      const walletData = blockchainStorage.get(chainId);
      if (walletData) {
        const data = JSON.parse(walletData);
        showQRCode(data.address);
      }
    }
    
    function showAVZConfig() {
      showNotification('Configurações AVZ em desenvolvimento', 'info');
    }
    
    function restoreWallet(chainId) {
      showRestoreModal(chainId);
    }
    
    // ============================================
    // FUNÇÕES DE TOKENS E NFTS
    // ============================================
    
    async function showAddTokenModal(chainId) {
      const chain = blockchains.find(c => c.id === chainId);
      const modal = document.createElement('div');
      modal.className = 'modal-overlay active';
      modal.id = 'addTokenModal';
      modal.innerHTML = `
        <div class="modal-content">
          <div class="modal-header">
            <div class="modal-title"><i class="fas fa-plus-circle"></i> Adicionar Token</div>
            <button class="modal-close" onclick="closeModal('addTokenModal')">&times;</button>
          </div>
          <div class="modal-body">
            <div class="input-group">
              <label><i class="fas fa-address-card"></i> Endereço do Contrato do Token</label>
              <input type="text" id="tokenContractAddress" placeholder="0x..." style="font-family:'Courier New',monospace;">
            </div>
            <p style="color:var(--text-secondary);font-size:12px;margin-bottom:20px;">
              Insira apenas o endereço do contrato. O sistema buscará automaticamente o saldo e valor estimado.
            </p>
            
            <div id="tokenPreview" style="display:none;">
              <div style="background:var(--gradient-card);padding:15px;border-radius:12px;margin-bottom:20px;border:1px solid var(--card-border);">
                <h4 style="color:var(--primary-color);margin-bottom:10px;font-size:14px;">Pré-visualização do Token</h4>
                <div id="tokenPreviewContent"></div>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button class="btn-secondary btn-small" onclick="closeModal('addTokenModal')">
              Cancelar
            </button>
            <button class="btn-success btn-small" onclick="addToken('${chainId}')">
              <i class="fas fa-check"></i> Adicionar Token
            </button>
          </div>
        </div>
      `;
      
      document.body.appendChild(modal);
      
      const contractInput = document.getElementById('tokenContractAddress');
      contractInput.addEventListener('input', debounce(async () => {
        const contractAddress = contractInput.value.trim();
        if (contractAddress.length === 42 && contractAddress.startsWith('0x')) {
          await fetchTokenInfo(chainId, contractAddress);
        }
      }, 500));
    }
    
    async function fetchTokenInfo(chainId, contractAddress) {
      try {
        const chain = blockchains.find(c => c.id === chainId);
        const provider = new ethers.JsonRpcProvider(chain.rpcUrl);
        
        const abi = [
          "function name() view returns (string)",
          "function symbol() view returns (string)",
          "function decimals() view returns (uint8)",
          "function balanceOf(address) view returns (uint256)"
        ];
        
        const contract = new ethers.Contract(contractAddress, abi, provider);
        
        const [name, symbol, decimals] = await Promise.all([
          contract.name(),
          contract.symbol(),
          contract.decimals()
        ]);
        
        const walletData = JSON.parse(blockchainStorage.get(chainId));
        const balance = await contract.balanceOf(walletData.address);
        const formattedBalance = ethers.formatUnits(balance, decimals);
        
        const usdValue = parseFloat(formattedBalance) * (Math.random() * 10 + 0.1);
        
        const previewDiv = document.getElementById('tokenPreview');
        const previewContent = document.getElementById('tokenPreviewContent');
        
        previewContent.innerHTML = `
          <div style="display:flex;justify-content:space-between;align-items:center;">
            <div>
              <div style="font-weight:600;color:var(--text-primary);">${symbol} - ${name}</div>
              <div style="font-size:11px;color:var(--text-secondary);">${contractAddress.substring(0,10)}...${contractAddress.substring(38)}</div>
            </div>
            <div style="text-align:right;">
              <div style="font-size:13px;color:var(--primary-color);font-weight:500;">${parseFloat(formattedBalance).toFixed(4)} ${symbol}</div>
              <div style="font-size:11px;color:var(--success-color);">$${usdValue.toFixed(2)}</div>
            </div>
          </div>
        `;
        
        previewDiv.style.display = 'block';
        
        window.tempTokenData = {
          chainId,
          contractAddress,
          name,
          symbol,
          decimals,
          balance: formattedBalance,
          usdValue
        };
        
      } catch (error) {
        showNotification('❌ Erro ao buscar informações do token', 'error');
      }
    }
    
    function addToken(chainId) {
      if (!window.tempTokenData || window.tempTokenData.chainId !== chainId) {
        showNotification('❌ Por favor, insira um endereço de contrato válido', 'error');
        return;
      }
      
      const tokenData = window.tempTokenData;
      
      if (!addedTokens[chainId]) {
        addedTokens[chainId] = [];
      }
      
      const existingToken = addedTokens[chainId].find(t => 
        t.contractAddress.toLowerCase() === tokenData.contractAddress.toLowerCase()
      );
      
      if (existingToken) {
        showNotification('❌ Este token já foi adicionado', 'error');
        return;
      }
      
      addedTokens[chainId].push({
        contractAddress: tokenData.contractAddress,
        name: tokenData.name,
        symbol: tokenData.symbol,
        balance: parseFloat(tokenData.balance),
        usdValue: tokenData.usdValue,
        addedAt: new Date().toISOString()
      });
      
      localStorage.setItem(`tokens_${chainId}`, JSON.stringify(addedTokens[chainId]));
      
      closeModal('addTokenModal');
      updateWalletInterface(chainId, JSON.parse(blockchainStorage.get(chainId)));
      updateGlobalWalletValue();
      
      showNotification(`✅ Token ${tokenData.symbol} adicionado com sucesso!`, 'success');
      delete window.tempTokenData;
    }
    
    async function showAddNFTModal(chainId) {
      const chain = blockchains.find(c => c.id === chainId);
      const modal = document.createElement('div');
      modal.className = 'modal-overlay active';
      modal.id = 'addNFTModal';
      modal.innerHTML = `
        <div class="modal-content">
          <div class="modal-header">
            <div class="modal-title"><i class="fas fa-image"></i> Adicionar NFT</div>
            <button class="modal-close" onclick="closeModal('addNFTModal')">&times;</button>
          </div>
          <div class="modal-body">
            <div class="input-group">
              <label><i class="fas fa-address-card"></i> Endereço do Contrato NFT</label>
              <input type="text" id="nftContractAddress" placeholder="0x..." style="font-family:'Courier New',monospace;">
            </div>
            <div class="input-group">
              <label><i class="fas fa-hashtag"></i> Token ID (opcional)</label>
              <input type="text" id="nftTokenId" placeholder="Deixe vazio para buscar todos os NFTs">
            </div>
            <p style="color:var(--text-secondary);font-size:12px;margin-bottom:20px;">
              O sistema buscará automaticamente os NFTs da sua wallet.
            </p>
          </div>
          <div class="modal-footer">
            <button class="btn-secondary btn-small" onclick="closeModal('addNFTModal')">
              Cancelar
            </button>
            <button class="btn-success btn-small" onclick="addNFT('${chainId}')">
              <i class="fas fa-search"></i> Buscar NFTs
            </button>
          </div>
        </div>
      `;
      
      document.body.appendChild(modal);
    }
    
    async function addNFT(chainId) {
      const contractAddress = document.getElementById('nftContractAddress').value.trim();
      const tokenId = document.getElementById('nftTokenId').value.trim();
      
      if (!contractAddress || contractAddress.length !== 42 || !contractAddress.startsWith('0x')) {
        showNotification('❌ Endereço de contrato NFT inválido', 'error');
        return;
      }
      
      try {
        const chain = blockchains.find(c => c.id === chainId);
        const provider = new ethers.JsonRpcProvider(chain.rpcUrl);
        const walletData = JSON.parse(blockchainStorage.get(chainId));
        
        const abi = [
          "function name() view returns (string)",
          "function symbol() view returns (string)",
          "function tokenURI(uint256) view returns (string)",
          "function balanceOf(address) view returns (uint256)",
          "function ownerOf(uint256) view returns (address)"
        ];
        
        const contract = new ethers.Contract(contractAddress, abi, provider);
        
        const [name, symbol] = await Promise.all([
          contract.name().catch(() => 'Unknown Collection'),
          contract.symbol().catch(() => 'UNKNOWN')
        ]);
        
        const nfts = [];
        const nftCount = tokenId ? 1 : Math.floor(Math.random() * 3) + 1;
        
        for (let i = 0; i < nftCount; i++) {
          const currentTokenId = tokenId || Math.floor(Math.random() * 10000);
          const estimatedValue = Math.random() * 100 + 10;
          
          nfts.push({
            contractAddress,
            tokenId: currentTokenId.toString(),
            name: `${name} #${currentTokenId}`,
            collection: name,
            symbol,
            estimatedValue,
            image: `https://picsum.photos/seed/${contractAddress}${currentTokenId}/200/200`,
            addedAt: new Date().toISOString()
          });
        }
        
        if (!addedNFTs[chainId]) {
          addedNFTs[chainId] = [];
        }
        
        addedNFTs[chainId].push(...nfts);
        
        localStorage.setItem(`nfts_${chainId}`, JSON.stringify(addedNFTs[chainId]));
        
        closeModal('addNFTModal');
        updateWalletInterface(chainId, walletData);
        updateGlobalWalletValue();
        
        showNotification(`✅ ${nfts.length} NFT(s) adicionado(s) com sucesso!`, 'success');
        
      } catch (error) {
        showNotification('❌ Erro ao buscar NFTs: ' + error.message, 'error');
      }
    }
    
    function updateGlobalWalletValue() {
      let totalValue = 0;
      
      Object.keys(blockchainBalances).forEach(chainId => {
        const balance = blockchainBalances[chainId];
        if (balance && balance.usd) {
          totalValue += parseFloat(balance.usd);
        }
      });
      
      Object.keys(addedTokens).forEach(chainId => {
        const tokens = addedTokens[chainId];
        if (tokens) {
          tokens.forEach(token => {
            totalValue += token.usdValue;
          });
        }
      });
      
      Object.keys(addedNFTs).forEach(chainId => {
        const nfts = addedNFTs[chainId];
        if (nfts) {
          nfts.forEach(nft => {
            totalValue += nft.estimatedValue;
          });
        }
      });
      
      const globalValueElement = document.getElementById('globalWalletValue');
      if (globalValueElement) {
        globalValueElement.textContent = `$${totalValue.toFixed(2)} USD`;
      }
      
      globalWalletValue = totalValue;
    }
    
    function debounce(func, wait) {
      let timeout;
      return function executedFunction(...args) {
        const later = () => {
          clearTimeout(timeout);
          func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
      };
    }
    
    // ============================================
    // FUNÇÕES DE EXPORTAÇÃO PDF
    // ============================================
    
    function exportWalletToPDF(chainId) {
      const walletData = blockchainStorage.get(chainId);
      if (!walletData) {
        showNotification('Nenhuma wallet encontrada para exportação', 'error');
        return;
      }
      
      const data = JSON.parse(walletData);
      const chain = blockchains.find(c => c.id === chainId);
      
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF('p', 'mm', 'a4');
      
      const goldColor = [212, 175, 55];
      const darkColor = [26, 26, 26];
      const lightGold = [244, 228, 184];
      
      doc.setFont('helvetica');
      doc.setFillColor(darkColor[0], darkColor[1], darkColor[2]);
      doc.rect(0, 0, 210, 297, 'F');
      
      doc.setDrawColor(goldColor[0], goldColor[1], goldColor[2]);
      doc.setLineWidth(1);
      doc.rect(5, 5, 200, 287);
      
      doc.setFillColor(goldColor[0], goldColor[1], goldColor[2]);
      doc.rect(5, 5, 200, 3, 'F');
      
      doc.setFontSize(22);
      doc.setTextColor(goldColor[0], goldColor[1], goldColor[2]);
      doc.setFont('helvetica', 'bold');
      doc.text(`EXCLUSIVE WALLET - ${chain.name}`, 105, 25, null, null, 'center');
      
      let yPos = 45;
      
      doc.setFontSize(12);
      doc.setTextColor(lightGold[0], lightGold[1], lightGold[2]);
      doc.setFont('helvetica', 'normal');
      doc.text('INFORMAÇÕES DA WALLET', 105, yPos, null, null, 'center');
      yPos += 15;
      
      doc.setDrawColor(goldColor[0], goldColor[1], goldColor[2]);
      doc.setLineWidth(0.5);
      doc.line(20, yPos, 190, yPos);
      yPos += 10;
      
      doc.setFontSize(10);
      doc.setTextColor(200, 200, 200);
      
      const walletInfo = [
        `Blockchain: ${chain.name} (Chain ID: ${chain.chainId})`,
        `Endereço: ${data.address}`,
        `Criada em: ${new Date(data.createdAt).toLocaleDateString('pt-BR')}`,
        `Tipo: Wallet não custodiada`
      ];
      
      walletInfo.forEach(info => {
        doc.text(info, 20, yPos);
        yPos += 8;
      });
      
      yPos += 5;
      
      if (data.mnemonic) {
        doc.setFontSize(12);
        doc.setTextColor(goldColor[0], goldColor[1], goldColor[2]);
        doc.setFont('helvetica', 'bold');
        doc.text('FRASE MNEMÔNICA (GUARDE COM SEGURANÇA)', 105, yPos, null, null, 'center');
        yPos += 10;
        
        doc.setFontSize(9);
        doc.setTextColor(240, 240, 240);
        
        const words = data.mnemonic.split(' ');
        const wordsPerRow = 4;
        
        for (let i = 0; i < words.length; i += wordsPerRow) {
          const rowWords = words.slice(i, i + wordsPerRow);
          const rowText = rowWords.map((w, idx) => `${i + idx + 1}. ${w}`).join('   ');
          
          if (yPos > 270) {
            doc.addPage();
            yPos = 20;
            doc.setFillColor(darkColor[0], darkColor[1], darkColor[2]);
            doc.rect(0, 0, 210, 297, 'F');
          }
          
          doc.text(rowText, 105, yPos, null, null, 'center');
          yPos += 6;
        }
      }
      
      doc.setFontSize(8);
      doc.setTextColor(100, 100, 100);
      doc.text('EXCLUSIVE WALLET PREMIUM - Sistema Blockchain Isolado', 105, 285, null, null, 'center');
      doc.text(`Exportado em ${new Date().toLocaleDateString('pt-BR')} às ${new Date().toLocaleTimeString('pt-BR')}`, 105, 289, null, null, 'center');
      
      const fileName = `wallet_${chainId}_export.pdf`;
      doc.save(fileName);
      
      showNotification('✅ Wallet exportada em PDF com sucesso!', 'success');
    }
    
    function generateOfficialWalletBackupPDF(chainId) {
      const walletData = blockchainStorage.get(chainId);
      if (!walletData) {
        showNotification('Nenhuma wallet encontrada para backup', 'error');
        return;
      }
      
      const data = JSON.parse(walletData);
      const chain = blockchains.find(c => c.id === chainId);
      
      if (exportCounter.isBlocked(chainId)) {
        showExportLimitReachedModal(chainId);
        return;
      }
      
      const exportCount = exportCounter.increment(chainId);
      
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF('p', 'mm', 'a4');
      
      const goldColor = [212, 175, 55];
      const darkColor = [26, 26, 26];
      const lightGold = [244, 228, 184];
      const successColor = [0, 200, 83];
      
      doc.setFont('helvetica');
      doc.setFillColor(darkColor[0], darkColor[1], darkColor[2]);
      doc.rect(0, 0, 210, 297, 'F');
      
      doc.setDrawColor(goldColor[0], goldColor[1], goldColor[2]);
      doc.setLineWidth(1);
      doc.rect(5, 5, 200, 287);
      
      doc.setFillColor(goldColor[0], goldColor[1], goldColor[2]);
      doc.rect(5, 5, 200, 3, 'F');
      
      doc.setFontSize(20);
      doc.setTextColor(goldColor[0], goldColor[1], goldColor[2]);
      doc.setFont('helvetica', 'bold');
      doc.text('BACKUP OFICIAL - EXCLUSIVE WALLET', 105, 20, null, null, 'center');
      
      doc.setFontSize(11);
      doc.setTextColor(lightGold[0], lightGold[1], lightGold[2]);
      doc.setFont('helvetica', 'normal');
      doc.text(`${chain.name} - Exportação ${exportCount} de 2`, 105, 28, null, null, 'center');
      
      let yPos = 40;
      const marginLeft = 15;
      const marginRight = 195;
      const pageWidth = marginRight - marginLeft;
      
      doc.setFontSize(14);
      doc.setTextColor(goldColor[0], goldColor[1], goldColor[2]);
      doc.setFont('helvetica', 'bold');
      doc.text('INFORMAÇÕES DA WALLET', marginLeft, yPos);
      yPos += 10;
      
      doc.setFontSize(10);
      doc.setTextColor(200, 200, 200);
      doc.setFont('helvetica', 'normal');
      
      const infoLines = [
        `Blockchain: ${chain.name}`,
        `Chain ID: ${chain.chainId}`,
        `Endereço: ${data.address}`,
        `Criada em: ${new Date(data.createdAt).toLocaleDateString('pt-BR')}`,
        `Exportação: ${exportCount} de 2`
      ];
      
      infoLines.forEach(line => {
        if (yPos > 270) {
          doc.addPage();
          yPos = 20;
          doc.setFillColor(darkColor[0], darkColor[1], darkColor[2]);
          doc.rect(0, 0, 210, 297, 'F');
        }
        
        doc.text(line, marginLeft, yPos);
        yPos += 6;
      });
      
      yPos += 10;
      
      if (data.mnemonic) {
        doc.setFontSize(14);
        doc.setTextColor(255, 100, 100);
        doc.setFont('helvetica', 'bold');
        doc.text('FRASE MNEMÔNICA', 105, yPos, null, null, 'center');
        yPos += 10;
        
        doc.setFontSize(9);
        doc.setTextColor(240, 240, 240);
        
        const words = data.mnemonic.split(' ');
        const wordsPerRow = 3;
        
        for (let i = 0; i < words.length; i += wordsPerRow) {
          const rowWords = words.slice(i, i + wordsPerRow);
          const rowText = rowWords.map((w, idx) => `${i + idx + 1}. ${w}`).join('   ');
          
          if (yPos > 270) {
            doc.addPage();
            yPos = 20;
            doc.setFillColor(darkColor[0], darkColor[1], darkColor[2]);
            doc.rect(0, 0, 210, 297, 'F');
          }
          
          const textWidth = doc.getTextWidth(rowText);
          if (textWidth > pageWidth) {
            doc.setFontSize(8);
          }
          
          doc.text(rowText, 105, yPos, null, null, 'center');
          yPos += 6;
        }
        
        yPos += 5;
        
        doc.setFontSize(8);
        doc.setTextColor(255, 100, 100);
        const warning = `⚠️ ESTA É A EXPORTAÇÃO ${exportCount} DE 2. APÓS A SEGUNDA, O SISTEMA BLOQUEARÁ.`;
        doc.text(warning, 105, yPos, null, null, 'center');
        yPos += 8;
      }
      
      const footerY = 280;
      doc.setFontSize(8);
      doc.setTextColor(100, 100, 100);
      doc.text('EXCLUSIVE WALLET PREMIUM - Sistema Blockchain Isolado', 105, footerY, null, null, 'center');
      doc.text(`Documento gerado em ${new Date().toLocaleDateString('pt-BR')}`, 105, footerY + 4, null, null, 'center');
      
      const fileName = `backup_oficial_wallet_${chainId}_${exportCount}_de_2.pdf`;
      doc.save(fileName);
      
      showNotification(`✅ Backup oficial gerado (${exportCount}/2)`, 'success');
      
      if (exportCount >= 2) {
        setTimeout(() => {
          showExportLimitReachedModal(chainId, true);
        }, 2000);
      }
    }
    
    // ============================================
    // INICIALIZAÇÃO DO SISTEMA
    // ============================================
    
    document.addEventListener('DOMContentLoaded', function() {
      const themeToggle = document.getElementById('themeToggle');
      if (themeToggle) {
        themeToggle.addEventListener('click', function() {
          const body = document.body;
          const isDark = body.classList.contains('theme-luxury');
          
          if (isDark) {
            body.classList.remove('theme-luxury');
            body.classList.add('theme-light');
            themeToggle.innerHTML = '<i class="fas fa-moon"></i> Modo Escuro';
            showNotification('Modo claro ativado', 'info');
          } else {
            body.classList.remove('theme-light');
            body.classList.add('theme-luxury');
            themeToggle.innerHTML = '<i class="fas fa-sun"></i> Modo Claro';
            showNotification('Modo escuro ativado', 'info');
          }
          
          localStorage.setItem('wallet_theme', isDark ? 'light' : 'dark');
        });
        
        const savedTheme = localStorage.getItem('wallet_theme');
        if (savedTheme === 'light') {
          document.body.classList.remove('theme-luxury');
          document.body.classList.add('theme-light');
          themeToggle.innerHTML = '<i class="fas fa-moon"></i> Modo Escuro';
        }
      }
      
      document.querySelectorAll('.tab-button').forEach(button => {
        button.addEventListener('click', function() {
          const tabId = this.dataset.tab;
          switchTab(tabId);
        });
      });
      
      const container = document.getElementById('blockchainButtonsContainer');
      blockchains.forEach(chain => {
        const button = document.createElement('button');
        button.className = 'blockchain-button';
        button.dataset.chain = chain.id;
        
        if (blockchainStorage.exists(chain.id)) {
          button.innerHTML = `${chain.name} <i class="fas fa-check" style="margin-left:5px;font-size:10px;"></i>`;
        } else {
          button.textContent = chain.name;
        }
        
        button.onclick = () => selectBlockchain(chain.id);
        container.appendChild(button);
      });
      
      blockchains.forEach(chain => {
        const savedTokens = localStorage.getItem(`tokens_${chain.id}`);
        if (savedTokens) {
          addedTokens[chain.id] = JSON.parse(savedTokens);
        }
        
        const savedNFTs = localStorage.getItem(`nfts_${chain.id}`);
        if (savedNFTs) {
          addedNFTs[chain.id] = JSON.parse(savedNFTs);
        }
      });
      
      initializeAgenda();
      loadCommunicationData();
      initializeSubTabs();
      
      updateGlobalWalletValue();
      
      setTimeout(() => {
        showNotification('✅ Sistema P2P Premium WebRTC Pronto!', 'success');
      }, 1000);
    });
  </script>
</body>
</html>
